{
  "version": 3,
  "sources": ["..\\src\\db\\connection.ts", "..\\src\\services\\jwt.ts", "..\\src\\services\\auth.ts", "..\\src\\services\\permissions.ts", "..\\src\\config\\auth.ts", "..\\src\\middleware\\auth.ts", "..\\src\\adapters\\websocket.ts", "..\\src\\db\\migrations.ts", "..\\src\\scripts\\seed.ts", "..\\src\\adapters\\hono.ts", "..\\src\\adapters\\express.ts", "..\\src\\scripts\\dev.ts", "..\\src\\index.ts"],
  "sourcesContent": [
    "// src/db/connection.ts\nimport { Database } from \"bun:sqlite\";\n\n/**\n * Instancia global de la base de datos SQLite\n */\nlet db: Database|null;\n\n/**\n * Inicializa la conexi√≥n a la base de datos SQLite\n * @param dbPath Ruta al archivo de base de datos SQLite\n * @returns Instancia de la base de datos\n */\nexport function initDatabase(dbPath: string = \"./auth.db\"): Database {\n  if (!db) {\n    try {\n      // Crear conexi√≥n a SQLite usando Bun Database\n      db = new Database(dbPath);\n      \n      // Configure SQLite for better concurrency and performance\n      db.exec(\"PRAGMA journal_mode = WAL;\");\n      db.exec(\"PRAGMA synchronous = NORMAL;\");\n      db.exec(\"PRAGMA cache_size = 1000;\");\n      db.exec(\"PRAGMA temp_store = memory;\");\n      db.exec(\"PRAGMA busy_timeout = 5000;\");\n      \n      console.log(`‚úÖ Base de datos SQLite inicializada: ${dbPath}`);\n    } catch (error:any) {\n      console.error(`‚ùå Error al inicializar la base de datos: ${error}`);\n      throw new Error(`Failed to initialize database: ${error}`);\n    }\n  }\n  return db;\n}\n\n/**\n * Obtiene la instancia actual de la base de datos\n * @returns Instancia de la base de datos\n * @throws Error si la base de datos no ha sido inicializada\n */\nexport function getDatabase(dbPath?: string): Database {\n  if (!db) {\n    console.log(\"‚ö†Ô∏è Database not initialized, auto-initializing with auth.db\");\n    initDatabase(dbPath);\n  }\n  \n  // Check if database is still open, if not reinitialize\n  try {\n    // Test if database is still accessible\n    if (!db) {\n      throw new Error(\"Database not initialized\");\n    }\n    db.query(\"SELECT 1\").get();\n\n  } catch (error: any) {\n    if (error.message && error.message.includes('closed database')) {\n      console.log(\"‚ö†Ô∏è Database connection closed, reinitializing...\");\n      db = null as any;\n      initDatabase(dbPath);\n    } else {\n      throw error;\n    }\n  }\n  \n  if (!db) {\n    throw new Error(\"Failed to initialize database\");\n  }\n  \n  return db;\n}\n\nexport function forceReinitDatabase(dbPath?: string): Database {\n  console.log(\"üîÑ Force reinitializing database...\");\n  db = null;\n  initDatabase(dbPath);\n  if (!db) {\n    throw new Error(\"Failed to reinitialize database\");\n  }\n  return db;\n}\n\n/**\n * Cierra la conexi√≥n a la base de datos\n */\nexport async function closeDatabase(): Promise<void> {\n  if (db) {\n    try {\n      // Cerrar la conexi√≥n de la base de datos\n      db.close();\n      db = null as any;\n      console.log(\"‚úÖ Conexi√≥n a la base de datos cerrada\");\n    } catch (error:any) {\n      console.error(`‚ùå Error al cerrar la base de datos: ${error}`);\n      throw error;\n    }\n  }\n}\n\n/**\n * Verifica si la base de datos est√° inicializada\n * @returns true si la base de datos est√° inicializada\n */\nexport function isDatabaseInitialized(): boolean {\n  return db !== undefined && db !== null;\n}\n\n/**\n * Ejecuta una consulta de prueba para verificar la conexi√≥n\n * @returns Promise que resuelve si la conexi√≥n es exitosa\n */\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const db = getDatabase();\n    db.query(\"SELECT 1 as test\").get();\n    console.log(\"‚úÖ Conexi√≥n a la base de datos verificada\");\n    return true;\n  } catch (error:any) {\n    console.error(`‚ùå Error en la conexi√≥n a la base de datos: ${error}`);\n    return false;\n  }\n}\n\n/**\n * Habilita las claves for√°neas en SQLite\n * Debe llamarse despu√©s de inicializar la base de datos\n */\nexport async function enableForeignKeys(): Promise<void> {\n  try {\n    const db = getDatabase();\n    db.exec(\"PRAGMA foreign_keys = ON\");\n    console.log(\"‚úÖ Claves for√°neas habilitadas\");\n  } catch (error:any) {\n    console.error(`‚ùå Error al habilitar claves for√°neas: ${error}`);\n    throw error;\n  }\n}\n\n/**\n * Configura optimizaciones para SQLite\n */\nexport async function optimizeDatabase(): Promise<void> {\n  try {\n    const db = getDatabase();\n    // Configuraciones de rendimiento para SQLite\n    db.exec(\"PRAGMA journal_mode = WAL\"); // Write-Ahead Logging para mejor concurrencia\n    db.exec(\"PRAGMA synchronous = NORMAL\"); // Balance entre seguridad y rendimiento\n    db.exec(\"PRAGMA cache_size = 10000\"); // Cache de 10MB aproximadamente\n    db.exec(\"PRAGMA temp_store = memory\"); // Usar memoria para tablas temporales\n    db.exec(\"PRAGMA mmap_size = 268435456\"); // 256MB de memory-mapped I/O\n    \n    console.log(\"‚úÖ Optimizaciones de base de datos aplicadas\");\n  } catch (error:any) {\n    console.error(`‚ùå Error al aplicar optimizaciones: ${error}`);\n    throw error;\n  }\n}\n\n/**\n * Obtiene informaci√≥n sobre la base de datos\n * @returns Informaci√≥n de la base de datos\n */\nexport async function getDatabaseInfo(): Promise<{\n  version: string;\n  pageSize: number;\n  encoding: string;\n  journalMode: string;\n}> {\n  try {\n    const db = getDatabase();\n    const versionResult = db.query(\"PRAGMA user_version\").get() as { user_version: number } | undefined;\n    const pageSizeResult = db.query(\"PRAGMA page_size\").get() as { page_size: number } | undefined;\n    const encodingResult = db.query(\"PRAGMA encoding\").get() as { encoding: string } | undefined;\n    const journalModeResult = db.query(\"PRAGMA journal_mode\").get() as { journal_mode: string } | undefined;\n    \n    return {\n      version: (versionResult?.user_version || 0).toString(),\n      pageSize: pageSizeResult?.page_size || 0,\n      encoding: encodingResult?.encoding || 'unknown',\n      journalMode: journalModeResult?.journal_mode || 'unknown'\n    };\n  } catch (error:any) {\n    console.error(`‚ùå Error al obtener informaci√≥n de la base de datos: ${error}`);\n    throw error;\n  }\n}\n\n/**\n * Ejecuta VACUUM para optimizar el archivo de base de datos\n */\nexport async function vacuumDatabase(): Promise<void> {\n  try {\n    const db = getDatabase();\n    db.exec(\"VACUUM\");\n    console.log(\"‚úÖ VACUUM ejecutado exitosamente\");\n  } catch (error:any) {\n    console.error(`‚ùå Error al ejecutar VACUUM: ${error}`);\n    throw error;\n  }\n}\n\n/**\n * Verifica la integridad de la base de datos\n * @returns true si la base de datos est√° √≠ntegra\n */\nexport async function checkIntegrity(): Promise<boolean> {\n  try {\n    const db = getDatabase();\n    const result = db.query(\"PRAGMA integrity_check\").all() as { integrity_check: string }[];\n    const isOk = result.length === 1 && result[0].integrity_check === 'ok';\n    \n    if (isOk) {\n      console.log(\"‚úÖ Integridad de la base de datos verificada\");\n    } else {\n      console.warn(\"‚ö†Ô∏è Problemas de integridad detectados:\", result);\n    }\n    \n    return isOk;\n  } catch (error:any) {\n    console.error(`‚ùå Error al verificar integridad: ${error}`);\n    return false;\n  }\n}",
    "// src/services/jwt.ts\nimport type { JWTPayload, User } from '../types/auth';\n\n/**\n * Servicio para manejar operaciones JWT\n * Utiliza Web Crypto API nativo para firmas HMAC\n * Nota: Bun.password.hash es para hashing de contrase√±as, no para JWT\n */\nexport class JWTService {\n  private secret: string;\n  private expiresIn: string;\n\n  constructor(secret: string, expiresIn: string = '24h') {\n    if (!secret) {\n      throw new Error('JWT secret is required');\n    }\n    this.secret = secret;\n    this.expiresIn = expiresIn;\n  }\n\n  /**\n   * Genera un token JWT para un usuario\n   * @param user Usuario para el cual generar el token\n   * @returns Token JWT\n   */\n  async generateToken(user: User): Promise<string> {\n    try {\n      const now = Math.floor(Date.now() / 1000);\n      const expirationTime = this.parseExpirationTime(this.expiresIn);\n      \n      const payload: JWTPayload = {\n        userId: user.id,\n        email: user.email,\n        roles: user.roles.map(role => role.name),\n        iat: now,\n        exp: now + expirationTime\n      };\n\n      // Implementar JWT usando Web Crypto API nativo\n      const header = {\n        alg: 'HS256',\n        typ: 'JWT'\n      };\n\n      const encodedHeader = this.base64UrlEncode(JSON.stringify(header));\n      const encodedPayload = this.base64UrlEncode(JSON.stringify(payload));\n      \n      const signature = await this.createSignature(`${encodedHeader}.${encodedPayload}`);\n      \n      return `${encodedHeader}.${encodedPayload}.${signature}`;\n    } catch (error:any) {\n      console.error('Error generating JWT token:', error);\n      throw new Error('Failed to generate token');\n    }\n  }\n\n  /**\n   * Verifica y decodifica un token JWT\n   * @param token Token JWT a verificar\n   * @returns Payload del token si es v√°lido\n   * @throws Error si el token es inv√°lido\n   */\n  async verifyToken(token: string): Promise<JWTPayload> {\n    return Promise.resolve().then(async () => {\n      if (!token) {\n        throw new Error('Token is required');\n      }\n\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        throw new Error('Invalid token format');\n      }\n\n      const [encodedHeader, encodedPayload, signature] = parts;\n      \n      // Verificar la firma\n      const expectedSignature = await this.createSignature(`${encodedHeader}.${encodedPayload}`);\n      if (signature !== expectedSignature) {\n        throw new Error('Invalid token signature');\n      }\n\n      // Decodificar el payload\n      const payload: JWTPayload = JSON.parse(this.base64UrlDecode(encodedPayload));\n      \n      // Verificar expiraci√≥n\n      const now = Math.floor(Date.now() / 1000);\n      if (payload.exp && payload.exp < now) {\n        throw new Error('Token has expired');\n      }\n\n      return payload;\n    }).catch((error: any) => {\n      console.error('Error verifying JWT token:', error);\n      throw new Error(`Invalid token: ${error.message}`);\n    });\n  }\n\n  /**\n   * Extrae el token del header Authorization\n   * @param authHeader Header de autorizaci√≥n\n   * @returns Token JWT o null si no se encuentra\n   */\n  extractTokenFromHeader(authHeader: string): string | null {\n    if (!authHeader) {\n      return null;\n    }\n\n    const parts = authHeader.trim().split(' ');\n    if (parts.length !== 2 || parts[0].toLowerCase() !== 'bearer') {\n      return null;\n    }\n\n    return parts[1];\n  }\n\n  /**\n   * Verifica si un token est√° expirado sin verificar la firma\n   * @param token Token JWT\n   * @returns true si est√° expirado\n   */\n  isTokenExpired(token: string): boolean {\n    try {\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        return true;\n      }\n\n      const payload: JWTPayload = JSON.parse(this.base64UrlDecode(parts[1]));\n      const now = Math.floor(Date.now() / 1000);\n      \n      return payload.exp ? payload.exp < now : false;\n    } catch (error:any) {\n      return true;\n    }\n  }\n\n  /**\n   * Obtiene el tiempo restante de un token en segundos\n   * @param token Token JWT\n   * @returns Segundos restantes o 0 si est√° expirado\n   */\n  getTokenRemainingTime(token: string): number {\n    try {\n      const parts = token.split('.');\n      if (parts.length !== 3) {\n        return 0;\n      }\n\n      const payload: JWTPayload = JSON.parse(this.base64UrlDecode(parts[1]));\n      const now = Math.floor(Date.now() / 1000);\n      \n      if (!payload.exp) {\n        return Infinity;\n      }\n\n      const remaining = payload.exp - now;\n      return Math.max(0, remaining);\n    } catch (error:any) {\n      return 0;\n    }\n  }\n\n  /**\n   * Refresca un token si est√° pr√≥ximo a expirar\n   * @param token Token actual\n   * @param user Usuario asociado al token\n   * @param refreshThreshold Umbral en segundos para refrescar (default: 1 hora)\n   * @returns Nuevo token o el mismo si no necesita refresh\n   */\n  async refreshTokenIfNeeded(\n    token: string, \n    user: User, \n    refreshThreshold: number = 3600\n  ): Promise<string> {\n    const remainingTime = this.getTokenRemainingTime(token);\n    \n    if (remainingTime <= refreshThreshold) {\n      return await this.generateToken(user);\n    }\n    \n    return token;\n  }\n\n  /**\n   * Codifica en Base64 URL-safe\n   * @param str String a codificar\n   * @returns String codificado\n   */\n  private base64UrlEncode(str: string): string {\n    const base64 = Buffer.from(str).toString('base64');\n    return base64\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=/g, '');\n  }\n\n  /**\n   * Decodifica de Base64 URL-safe\n   * @param str String a decodificar\n   * @returns String decodificado\n   */\n  private base64UrlDecode(str: string): string {\n    // Agregar padding si es necesario\n    let padded = str;\n    while (padded.length % 4) {\n      padded += '=';\n    }\n    \n    const base64 = padded\n      .replace(/-/g, '+')\n      .replace(/_/g, '/');\n    \n    return Buffer.from(base64, 'base64').toString('utf-8');\n  }\n\n  /**\n   * Crea una firma HMAC SHA-256\n   * @param data Datos a firmar\n   * @returns Firma en base64 URL-safe\n   */\n  private async createSignature(data: string): Promise<string> {\n    const encoder = new TextEncoder();\n    const keyData = encoder.encode(this.secret);\n    const messageData = encoder.encode(data);\n    \n    // Importar la clave\n    const key = await crypto.subtle.importKey(\n      'raw',\n      keyData,\n      { name: 'HMAC', hash: 'SHA-256' },\n      false,\n      ['sign']\n    );\n    \n    // Crear la firma\n    const signature = await crypto.subtle.sign('HMAC', key, messageData);\n    const signatureArray = new Uint8Array(signature);\n    \n    // Convertir a base64 URL-safe\n    const base64 = Buffer.from(signatureArray).toString('base64');\n    return base64\n      .replace(/\\+/g, '-')\n      .replace(/\\//g, '_')\n      .replace(/=/g, '');\n  }\n\n  /**\n   * Parsea el tiempo de expiraci√≥n a segundos\n   * @param expiresIn String de tiempo (ej: '24h', '7d', '30m')\n   * @returns Segundos\n   */\n  private parseExpirationTime(expiresIn: string): number {\n    const units: Record<string, number> = {\n      's': 1,\n      'm': 60,\n      'h': 3600,\n      'd': 86400,\n      'w': 604800\n    };\n\n    const match = expiresIn.match(/^(-?\\d+)([smhdw])$/);\n    if (!match) {\n      throw new Error(`Invalid expiration format: ${expiresIn}`);\n    }\n\n    const [, value, unit] = match;\n    const multiplier = units[unit];\n    \n    if (!multiplier) {\n      throw new Error(`Invalid time unit: ${unit}`);\n    }\n\n    return parseInt(value) * multiplier;\n  }\n\n  /**\n   * Genera un token de refresh\n   * @param userId ID del usuario\n   * @returns Token de refresh\n   */\n  async generateRefreshToken(userId: number): Promise<string> {\n    const payload = {\n      userId,\n      type: 'refresh',\n      iat: Math.floor(Date.now() / 1000),\n      exp: Math.floor(Date.now() / 1000) + (30 * 24 * 60 * 60) // 30 d√≠as\n    };\n\n    const encodedPayload = this.base64UrlEncode(JSON.stringify(payload));\n    const signature = await this.createSignature(encodedPayload);\n    \n    return `${encodedPayload}.${signature}`;\n  }\n\n  /**\n   * Verifica un token de refresh\n   * @param refreshToken Token de refresh\n   * @returns User ID si es v√°lido\n   */\n  async verifyRefreshToken(refreshToken: string): Promise<number> {\n    try {\n      const parts = refreshToken.split('.');\n      if (parts.length !== 2) {\n        throw new Error('Invalid refresh token format');\n      }\n\n      const [encodedPayload, signature] = parts;\n      \n      // Verificar la firma\n      const expectedSignature = await this.createSignature(encodedPayload);\n      if (signature !== expectedSignature) {\n        throw new Error('Invalid refresh token signature');\n      }\n\n      const payload = JSON.parse(this.base64UrlDecode(encodedPayload));\n      \n      // Verificar tipo y expiraci√≥n\n      if (payload.type !== 'refresh') {\n        throw new Error('Invalid token type');\n      }\n\n      const now = Math.floor(Date.now() / 1000);\n      if (payload.exp && payload.exp < now) {\n        throw new Error('Refresh token has expired');\n      }\n\n      return payload.userId;\n    } catch (error:any) {\n      throw new Error(`Invalid refresh token: ${error.message}`);\n    }\n  }\n}\n\n/**\n * Instancia singleton del servicio JWT\n */\nlet jwtServiceInstance: JWTService | null = null;\n\n/**\n * Inicializa el servicio JWT\n * @param secret Secreto para firmar tokens\n * @param expiresIn Tiempo de expiraci√≥n\n * @returns Instancia del servicio JWT\n */\nexport function initJWTService(secret: string, expiresIn?: string): JWTService {\n  jwtServiceInstance = new JWTService(secret, expiresIn);\n  return jwtServiceInstance;\n}\n\n/**\n * Obtiene la instancia del servicio JWT\n * @returns Instancia del servicio JWT\n * @throws Error si no ha sido inicializado\n */\nexport function getJWTService(): JWTService {\n  if (!jwtServiceInstance) {\n    throw new Error('JWT Service not initialized. Call initJWTService() first.');\n  }\n  return jwtServiceInstance;\n}",
    "// src/services/auth.ts\nimport { getDatabase } from '../db/connection';\nimport { getJWTService } from './jwt';\nimport type { \n  User, \n  RegisterData, \n  LoginData, \n  AuthResult, \n  UserQueryOptions,\n  UpdateUserData,\n  AuthError,\n  AuthErrorType,\n  Role,\n  Permission \n} from '../types/auth';\n\n/**\n * Servicio de autenticaci√≥n\n * Maneja registro, login y operaciones de usuario\n */\nexport class AuthService {\n  /**\n   * Registra un nuevo usuario\n   * @param data Datos de registro\n   * @returns Usuario creado y token\n   */\n  async register(data: RegisterData): Promise<AuthResult> {\n    try {\n      const db = getDatabase();\n      const jwtService = getJWTService();\n\n      // Validar datos de entrada\n      try {\n        this.validateRegisterData(data);\n      } catch (validationError: any) {\n        return {\n          success: false,\n          error: {\n            type: validationError.type || 'VALIDATION_ERROR' as AuthErrorType,\n            message: validationError.message\n          }\n        };\n      }\n\n      // Verificar si el usuario ya existe\n      const existingUser = await this.findUserByEmail(data.email);\n      if (existingUser) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: 'User already exists with this email'\n          }\n        };\n      }\n\n      // Hash de la contrase√±a usando Bun\n      const passwordHash = await Bun.password.hash(data.password, {\n        algorithm: 'bcrypt',\n        cost: 12\n      });\n\n      // Crear usuario en la base de datos\n      const userId = crypto.randomUUID();\n      const isActive = data.isActive !== undefined ? data.isActive : true;\n      const insertQuery = db.query(`\n        INSERT INTO users (id, email, password_hash, first_name, last_name, created_at, updated_at, is_active)\n        VALUES (?, ?, ?, ?, ?, datetime('now'), datetime('now'), ?)\n      `);\n      insertQuery.run(userId, data.email.toLowerCase(), passwordHash, data.firstName || null, data.lastName || null, isActive ? 1 : 0);\n\n      // Asignar rol por defecto (user)\n      await this.assignDefaultRole(userId);\n\n      // Obtener el usuario completo con roles\n      const user = await this.findUserById(userId, { includeRoles: true, includePermissions: true });\n      if (!user) {\n        throw new Error('Failed to create user');\n      }\n\n      // Update lastLoginAt\n      const updateLoginQuery = db.query(\n        \"UPDATE users SET last_login_at = datetime('now') WHERE id = ?\"\n      );\n      updateLoginQuery.run(user.id);\n\n      // Generar token JWT\n      const token = await jwtService.generateToken(user);\n      const refreshToken = await jwtService.generateRefreshToken(Number(user.id));\n\n      // Get updated user with lastLoginAt\n      const updatedUser = await this.findUserById(user.id, { includeRoles: true, includePermissions: true });\n\n      return { \n        success: true, \n        user: updatedUser || user, \n        token, \n        refreshToken \n      };\n    } catch (error:any) {\n      console.error('Error registering user:', error);\n      return {\n        success: false,\n        error: {\n          type: (error.type as AuthErrorType) || 'SERVER_ERROR' as AuthErrorType,\n          message: error.message || 'Registration failed'\n        }\n      };\n    }\n  }\n\n  /**\n   * Autentica un usuario\n   * @param data Datos de login\n   * @returns Usuario y token si la autenticaci√≥n es exitosa\n   */\n  async login(data: LoginData): Promise<AuthResult> {\n    try {\n      const db = getDatabase();\n      const jwtService = getJWTService();\n\n      // Validar datos de entrada\n      this.validateLoginData(data);\n\n      // Buscar usuario por email\n      const user = await this.findUserByEmail(data.email, { \n        includeRoles: true, \n        includePermissions: true \n      });\n\n      if (!user) {\n        return {\n          success: false,\n          error: {\n            type: 'AUTHENTICATION_ERROR' as AuthErrorType,\n            message: 'Invalid credentials'\n          }\n        };\n      }\n\n      // Verificar si el usuario est√° activo\n      if (!user.is_active) {\n        return {\n          success: false,\n          error: {\n            type: 'AUTHENTICATION_ERROR' as AuthErrorType,\n            message: 'Account is inactive'\n          }\n        };\n      }\n\n      // Verificar contrase√±a\n      const isValidPassword = await Bun.password.verify(data.password, user.password_hash);\n      if (!isValidPassword) {\n        return {\n          success: false,\n          error: {\n            type: 'AUTHENTICATION_ERROR' as AuthErrorType,\n            message: 'Invalid credentials'\n          }\n        };\n      }\n\n      // Actualizar √∫ltima actividad y last_login_at\n      const updateQuery = db.query(\n        \"UPDATE users SET updated_at = datetime('now'), last_login_at = datetime('now') WHERE id = ?\"\n      );\n      updateQuery.run(user.id);\n\n      // Obtener usuario actualizado con lastLoginAt\n      const updatedUser = await this.findUserById(user.id, { includeRoles: true, includePermissions: true });\n      if (!updatedUser) {\n        return {\n          success: false,\n          error: {\n            type: 'DATABASE_ERROR' as AuthErrorType,\n            message: 'User not found after update'\n          }\n        };\n      }\n\n      // Generar token JWT\n      const token = await jwtService.generateToken(updatedUser);\n      const refreshToken = await jwtService.generateRefreshToken(Number(updatedUser.id));\n\n      console.log(`‚úÖ Usuario autenticado: ${updatedUser.email}`);\n\n      return { \n        success: true, \n        user: updatedUser, \n        token, \n        refreshToken \n      };\n    } catch (error:any) {\n      console.error('Error during login:', error);\n      return {\n        success: false,\n        error: {\n          type: (error.type as AuthErrorType) || 'AUTHENTICATION_ERROR' as AuthErrorType,\n          message: error.message || 'Login failed'\n        }\n      };\n    }\n  }\n\n  /**\n   * Busca un usuario por ID\n   * @param id ID del usuario\n   * @param options Opciones de consulta\n   * @returns Usuario o null si no se encuentra\n   */\n  async findUserById(id: string, options: UserQueryOptions = {}): Promise<User | null> {\n    try {\n      const db = getDatabase();\n\n      // Consulta base del usuario\n      const activeCondition = options.activeOnly ? ' AND is_active = 1' : '';\n      const query = db.query(`\n        SELECT id, email, password_hash, first_name, last_name, created_at, updated_at, is_active, last_login_at\n        FROM users\n        WHERE id = ?${activeCondition}\n      `);\n      const userResult = query.all(id) as Array<{\n        id: string;\n        email: string;\n        password_hash: string;\n        first_name?: string;\n        last_name?: string;\n        created_at: string;\n        updated_at: string;\n        is_active: number;\n        last_login_at?: string;\n      }>;\n\n      if (userResult.length === 0) {\n        return null;\n      }\n\n      const userData = userResult[0];\n      const user = this.mapDatabaseUserToUser(userData);\n\n      // Incluir roles si se solicita\n      if (options.includeRoles) {\n        user.roles = await this.getUserRoles(id, options.includePermissions);\n      }\n\n      return user;\n    } catch (error:any) {\n      console.error('Error finding user by ID:', error);\n      throw new Error(`Failed to find user: ${error.message}`);\n    }\n  }\n\n  /**\n   * Busca un usuario por email\n   * @param email Email del usuario\n   * @param options Opciones de consulta\n   * @returns Usuario o null si no se encuentra\n   */\n  async findUserByEmail(email: string, options: UserQueryOptions = {}): Promise<User | null> {\n    try {\n      const db = getDatabase();\n      \n      let query = `\n        SELECT id, email, password_hash, first_name, last_name, created_at, updated_at, is_active, last_login_at\n        FROM users\n        WHERE email = ?\n      `;\n      \n      const params = [email.toLowerCase()];\n      \n      if (options.activeOnly) {\n        query += ` AND is_active = 1`;\n      }\n\n      const userResult = db.query(query).all(...params) as Array<{\n        id: string;\n        email: string;\n        password_hash: string;\n        first_name?: string;\n        last_name?: string;\n        created_at: string;\n        updated_at: string;\n        is_active: number;\n        last_login_at?: string;\n      }>;\n\n      if (userResult.length === 0) {\n        return null;\n      }\n\n      const userData = userResult[0];\n      const user = this.mapDatabaseUserToUser(userData);\n\n      // Incluir roles si se solicita\n      if (options.includeRoles) {\n        user.roles = await this.getUserRoles(userData.id, options.includePermissions);\n      }\n\n      return user;\n    } catch (error:any) {\n      console.error('Error finding user by email:', error);\n      throw new Error(`Failed to find user: ${error.message}`);\n    }\n  }\n\n  /**\n   * Obtiene los roles de un usuario\n   * @param userId ID del usuario\n   * @param includePermissions Si incluir permisos de los roles\n   * @returns Array de roles\n   */\n  async getUserRoles(userId: string, includePermissions: boolean = false): Promise<Role[]> {\n    try {\n      const db = getDatabase();\n\n      const rolesQuery = db.query(`\n        SELECT r.id, r.name, r.created_at, r.is_active\n        FROM roles r\n        INNER JOIN user_roles ur ON r.id = ur.role_id\n        WHERE ur.user_id = ?\n        ORDER BY r.name\n      `);\n      const rolesResult = rolesQuery.all(userId) as Array<{\n        id: string;\n        name: string;\n        created_at: string;\n        is_active: number;\n      }>;\n\n      const roles: Role[] = [];\n      for (const roleData of rolesResult) {\n        const role: Role = {\n          id: roleData.id,\n          name: roleData.name,\n          created_at: new Date(roleData.created_at),\n          isActive: Boolean(roleData.is_active),\n          permissions: [] as Permission[]\n        };\n\n        // Incluir permisos si se solicita\n        if (includePermissions) {\n          const permissionsQuery = db.query(`\n            SELECT p.id, p.name, p.resource, p.action, p.created_at\n            FROM permissions p\n            INNER JOIN role_permissions rp ON p.id = rp.permission_id\n            WHERE rp.role_id = ?\n            ORDER BY p.resource, p.action\n          `);\n          const permissionsResult = permissionsQuery.all(role.id) as Array<{\n            id: string;\n            name: string;\n            resource: string;\n            action: string;\n            created_at: string;\n          }>;\n\n          role.permissions = permissionsResult.map((permData): Permission => ({\n            id: permData.id,\n            name: permData.name,\n            resource: permData.resource,\n            action: permData.action,\n            created_at: new Date(permData.created_at)\n          }));\n        }\n\n        roles.push(role);\n      }\n\n      return roles;\n    } catch (error:any) {\n      console.error('Error getting user roles:', error);\n      throw new Error(`Failed to get user roles: ${error.message}`);\n    }\n  }\n\n  /**\n   * Asigna un rol espec√≠fico a un usuario\n   * @param userId ID del usuario\n   * @param roleName Nombre del rol a asignar\n   */\n  async assignRole(userId: string, roleName: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el usuario existe\n      const user = await this.findUserById(userId);\n      if (!user) {\n        return {\n          success: false,\n          error: {\n            type: 'USER_NOT_FOUND' as AuthErrorType,\n            message: 'User not found'\n          }\n        };\n      }\n\n      // Buscar el rol por nombre\n      const findRoleQuery = db.query(\"SELECT id FROM roles WHERE name = ?\");\n      const roleResult = findRoleQuery.get(roleName) as { id: string } | null;\n\n      if (!roleResult) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: `Role '${roleName}' not found`\n          }\n        };\n      }\n\n      // Verificar si el usuario ya tiene este rol\n      const existingQuery = db.query(\n        \"SELECT id FROM user_roles WHERE user_id = ? AND role_id = ?\"\n      );\n      const existing = existingQuery.get(userId, roleResult.id);\n\n      if (existing) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: 'User already has this role'\n          }\n        };\n      }\n\n      // Asignar rol al usuario\n      const assignRoleQuery = db.query(\n        \"INSERT INTO user_roles (id, user_id, role_id, created_at) VALUES (?, ?, ?, datetime('now'))\"\n      );\n      assignRoleQuery.run(crypto.randomUUID(), userId, roleResult.id);\n\n      console.log(`‚úÖ Rol ${roleName} asignado al usuario: ${userId}`);\n      return { success: true };\n    } catch (error: any) {\n      console.error('Error assigning role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: error.message || 'Failed to assign role'\n        }\n      };\n    }\n  }\n\n  /**\n   * Asigna el rol por defecto a un usuario\n   * @param userId ID del usuario\n   */\n  private async assignDefaultRole(userId: string): Promise<void> {\n    try {\n      const db = getDatabase();\n\n      // Buscar o crear el rol 'user'\n      const findRoleQuery = db.query(\"SELECT id FROM roles WHERE name = 'user'\");\n      let userRole = findRoleQuery.all() as { id: string }[];\n\n      if (userRole.length === 0) {\n        // Crear rol 'user' si no existe\n        const roleId = crypto.randomUUID();\n        const createRoleQuery = db.query(\n          \"INSERT INTO roles (id, name, created_at) VALUES (?, ?, datetime('now'))\"\n        );\n        createRoleQuery.run(roleId, 'user');\n        userRole = [{ id: roleId }];\n      }\n\n      // Asignar rol al usuario\n      const assignRoleQuery = db.query(\n        \"INSERT INTO user_roles (id, user_id, role_id, created_at) VALUES (?, ?, ?, datetime('now'))\"\n      );\n      assignRoleQuery.run(crypto.randomUUID(), userId, userRole[0].id);\n    } catch (error:any) {\n      console.error('Error assigning default role:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Valida los datos de registro\n   * @param data Datos de registro\n   */\n  private validateRegisterData(data: RegisterData): void {\n    if (!data.email || !data.password) {\n      const error = new Error('Email and password are required');\n      (error as any).type = 'VALIDATION_ERROR';\n      throw error;\n    }\n\n    // Validar formato de email\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(data.email)) {\n      const error = new Error('Invalid email format');\n      (error as any).type = 'VALIDATION_ERROR';\n      throw error;\n    }\n\n    // Validar contrase√±a\n    if (data.password.length < 8) {\n      const error = new Error('Invalid password strength');\n      (error as any).type = 'VALIDATION_ERROR';\n      throw error;\n    }\n\n    if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/.test(data.password)) {\n      const error = new Error('Password must contain at least one uppercase letter, one lowercase letter, and one number');\n      (error as any).type = 'VALIDATION_ERROR';\n      throw error;\n    }\n  }\n\n  /**\n   * Valida los datos de login\n   * @param data Datos de login\n   */\n  private validateLoginData(data: LoginData): void {\n    if (!data.email || !data.password) {\n      throw new Error('Email and password are required');\n    }\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(data.email)) {\n      throw new Error('Invalid email format');\n    }\n  }\n\n  /**\n   * Actualiza la contrase√±a de un usuario\n   * @param userId ID del usuario\n   * @param newPassword Nueva contrase√±a\n   */\n  async updatePassword(userId: string, newPassword: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      // Validar nueva contrase√±a\n      if (newPassword.length < 8) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: 'Password must be at least 8 characters long'\n          }\n        };\n      }\n\n      // Hash de la nueva contrase√±a\n      const passwordHash = await Bun.password.hash(newPassword, {\n        algorithm: 'bcrypt',\n        cost: 12\n      });\n\n      // Actualizar en la base de datos\n      const updatePasswordQuery = db.query(\n        \"UPDATE users SET password_hash = ?, updated_at = datetime('now') WHERE id = ?\"\n      );\n      updatePasswordQuery.run(passwordHash, userId);\n\n      console.log(`‚úÖ Contrase√±a actualizada para usuario: ${userId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error updating password:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to update password: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Actualiza los datos de un usuario\n   * @param userId ID del usuario\n   * @param data Datos de actualizaci√≥n\n   */\n  async updateUser(userId: string, data: UpdateUserData): Promise<{ success: boolean; user?: User; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el usuario existe\n      const existingUser = await this.findUserById(userId);\n      if (!existingUser) {\n        return {\n          success: false,\n          error: {\n            type: 'USER_NOT_FOUND' as AuthErrorType,\n            message: 'User not found'\n          }\n        };\n      }\n\n      // Verificar que el email no est√© en uso por otro usuario\n      if (data.email && data.email !== existingUser.email) {\n        const existingByEmail = await this.findUserByEmail(data.email);\n        if (existingByEmail && existingByEmail.id !== userId) {\n          return {\n            success: false,\n            error: {\n              type: 'VALIDATION_ERROR' as AuthErrorType,\n              message: 'Email already exists'\n            }\n          };\n        }\n      }\n\n      // Update lastLoginAt if provided\n      let updateFields = [];\n      let updateValues = [];\n      \n      if (data.email) {\n        updateFields.push('email = ?');\n        updateValues.push(data.email);\n      }\n      if (data.firstName !== undefined) {\n        updateFields.push('first_name = ?');\n        updateValues.push(data.firstName);\n      }\n      if (data.lastName !== undefined) {\n        updateFields.push('last_name = ?');\n        updateValues.push(data.lastName);\n      }\n      if (data.is_active !== undefined || data.isActive !== undefined) {\n        updateFields.push('is_active = ?');\n        const activeValue = data.is_active !== undefined ? data.is_active : data.isActive;\n        updateValues.push(activeValue ? 1 : 0);\n      }\n      if (data.password) {\n        const passwordHash = await Bun.password.hash(data.password, {\n          algorithm: 'bcrypt',\n          cost: 12\n        });\n        updateFields.push('password_hash = ?');\n        updateValues.push(passwordHash);\n      }\n      \n      updateFields.push(\"updated_at = datetime('now')\");\n      updateValues.push(userId);\n\n      // Actualizar en la base de datos\n      const updateQuery = db.query(\n        `UPDATE users SET ${updateFields.join(', ')} WHERE id = ?`\n      );\n      updateQuery.run(...updateValues);\n\n      // Update lastLoginAt if this is a login update\n      if (data.lastLoginAt) {\n        const loginUpdateQuery = db.query(\n          \"UPDATE users SET last_login_at = datetime('now') WHERE id = ?\"\n        );\n        loginUpdateQuery.run(userId);\n      }\n\n      // Obtener el usuario actualizado\n      const updatedUser = await this.findUserById(userId, { includeRoles: true, includePermissions: true });\n      if (!updatedUser) {\n        return {\n          success: false,\n          error: {\n            type: 'DATABASE_ERROR' as AuthErrorType,\n            message: 'Failed to retrieve updated user'\n          }\n        };\n      }\n\n      console.log(`‚úÖ Usuario actualizado: ${updatedUser.email}`);\n      return { success: true, user: updatedUser };\n    } catch (error:any) {\n      console.error('Error updating user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: error.message || 'Failed to update user'\n        }\n      };\n    }\n  }\n\n  /**\n   * Desactiva un usuario\n   * @param userId ID del usuario\n   */\n  async deactivateUser(userId: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      const deactivateQuery = db.query(\n        \"UPDATE users SET is_active = 0, updated_at = datetime('now') WHERE id = ?\"\n      );\n      deactivateQuery.run(userId);\n\n      console.log(`‚úÖ Usuario desactivado: ${userId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error deactivating user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to deactivate user: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Activa un usuario\n   * @param userId ID del usuario\n   */\n  async activateUser(userId: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      const activateQuery = db.query(\n        \"UPDATE users SET is_active = 1, updated_at = datetime('now') WHERE id = ?\"\n      );\n      activateQuery.run(userId);\n\n      console.log(`‚úÖ Usuario activado: ${userId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error activating user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to activate user: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Elimina un usuario\n   * @param userId ID del usuario\n   */\n  async deleteUser(userId: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el usuario existe\n      const existingUser = await this.findUserById(userId);\n      if (!existingUser) {\n        return {\n          success: false,\n          error: {\n            type: 'USER_NOT_FOUND' as AuthErrorType,\n            message: 'User not found'\n          }\n        };\n      }\n\n      // Eliminar roles del usuario\n      const deleteUserRolesQuery = db.query(\n        \"DELETE FROM user_roles WHERE user_id = ?\"\n      );\n      deleteUserRolesQuery.run(userId);\n\n      // Eliminar usuario\n      const deleteUserQuery = db.query(\n        \"DELETE FROM users WHERE id = ?\"\n      );\n      deleteUserQuery.run(userId);\n\n      console.log(`‚úÖ Usuario eliminado: ${userId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error deleting user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: error.message || 'Failed to delete user'\n        }\n      };\n    }\n  }\n\n  /**\n   * Remueve un rol de un usuario\n   * @param userId ID del usuario\n   * @param roleName Nombre del rol\n   */\n  async removeRole(userId: string, roleName: string): Promise<{ success: boolean; error?: { type: AuthErrorType; message: string } }> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el usuario existe\n      const existingUser = await this.findUserById(userId);\n      if (!existingUser) {\n        return {\n          success: false,\n          error: {\n            type: 'USER_NOT_FOUND' as AuthErrorType,\n            message: 'User not found'\n          }\n        };\n      }\n\n      // Verificar que el rol existe\n      const roleQuery = db.query(\"SELECT id FROM roles WHERE name = ?\");\n      const role = roleQuery.get(roleName) as { id: string } | undefined;\n      if (!role) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Role not found'\n          }\n        };\n      }\n\n      // Verificar que el usuario tiene el rol\n      const userRoleQuery = db.query(\n        \"SELECT id FROM user_roles WHERE user_id = ? AND role_id = ?\"\n      );\n      const userRole = userRoleQuery.get(userId, role.id);\n      if (!userRole) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'User does not have this role'\n          }\n        };\n      }\n\n      // Remover el rol\n      const removeRoleQuery = db.query(\n        \"DELETE FROM user_roles WHERE user_id = ? AND role_id = ?\"\n      );\n      removeRoleQuery.run(userId, role.id);\n\n      console.log(`‚úÖ Rol ${roleName} removido del usuario: ${userId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error removing role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: error.message || 'Failed to remove role'\n        }\n      };\n    }\n  }\n\n  /**\n   * Obtiene todos los usuarios con paginaci√≥n\n   * @param page P√°gina (empezando en 1)\n   * @param limit L√≠mite por p√°gina\n   * @param options Opciones de consulta\n   * @returns Array de usuarios y total\n   */\n  async getUsers(\n    page: number = 1, \n    limit: number = 10, \n    options: UserQueryOptions = {}\n  ): Promise<{ users: User[], total: number }> {\n    try {\n      const db = getDatabase();\n      const offset = (page - 1) * limit;\n\n      // Build WHERE conditions\n      let whereConditions = [];\n      let queryParams = [];\n      \n      if (options.activeOnly) {\n        whereConditions.push('is_active = ?');\n        queryParams.push(1);\n      }\n      \n      if (options.isActive !== undefined) {\n        whereConditions.push('is_active = ?');\n        queryParams.push(options.isActive ? 1 : 0);\n      }\n      \n      if (options.search) {\n        whereConditions.push('(email LIKE ? OR first_name LIKE ? OR last_name LIKE ?)');\n        const searchTerm = `%${options.search}%`;\n        queryParams.push(searchTerm, searchTerm, searchTerm);\n      }\n      \n      const whereClause = whereConditions.length > 0 ? `WHERE ${whereConditions.join(' AND ')}` : '';\n      \n      // Build ORDER BY clause\n      let orderBy = 'ORDER BY created_at DESC';\n      if (options.sortBy) {\n        const sortDirection = options.sortOrder === 'asc' ? 'ASC' : 'DESC';\n        switch (options.sortBy) {\n          case 'email':\n            orderBy = `ORDER BY email ${sortDirection}`;\n            break;\n          case 'created_at':\n            orderBy = `ORDER BY created_at ${sortDirection}`;\n            break;\n          case 'name':\n            orderBy = `ORDER BY first_name ${sortDirection}, last_name ${sortDirection}`;\n            break;\n          default:\n            orderBy = 'ORDER BY created_at DESC';\n        }\n      }\n\n      // Contar total de usuarios\n      const countQuery = db.query(`SELECT COUNT(*) as total FROM users ${whereClause}`);\n      const countResult = countQuery.get(...queryParams) as { total: number } | { 'COUNT(*)': number } | undefined;\n      const total = (countResult as any)?.total || (countResult as any)?.[\"COUNT(*)\"] || 0;\n\n      // Obtener usuarios con paginaci√≥n\n      const usersQuery = db.query(\n        `SELECT id, email, password_hash, first_name, last_name, created_at, updated_at, is_active, last_login_at FROM users ${whereClause} ${orderBy} LIMIT ? OFFSET ?`\n      );\n      const usersResult = usersQuery.all(...queryParams, limit, offset) as Array<{\n        id: string;\n        email: string;\n        password_hash: string;\n        first_name?: string;\n        last_name?: string;\n        created_at: string;\n        updated_at: string;\n        is_active: number;\n        last_login_at?: string;\n      }>;\n\n      const users: User[] = [];\n      for (const userData of usersResult) {\n        const user = this.mapDatabaseUserToUser(userData);\n\n        // Incluir roles si se solicita\n        if (options.includeRoles) {\n          user.roles = await this.getUserRoles(userData.id, options.includePermissions);\n        }\n\n        users.push(user);\n      }\n\n      return { users, total };\n    } catch (error:any) {\n      console.error('Error getting users:', error);\n      throw new Error(`Failed to get users: ${error.message}`);\n    }\n  }\n\n  /**\n   * Maps database user object to User interface with proper camelCase properties\n   * @param userData Raw user data from database\n   * @returns User object with proper property names\n   */\n  private mapDatabaseUserToUser(userData: {\n    id: string;\n    email: string;\n    password_hash: string;\n    first_name?: string;\n    last_name?: string;\n    created_at: string;\n    updated_at: string;\n    is_active: number;\n    last_login_at?: string;\n  }): User {\n    const createdAt = new Date(userData.created_at);\n    const updatedAt = new Date(userData.updated_at);\n    \n    return {\n      id: userData.id,\n      email: userData.email,\n      password_hash: userData.password_hash,\n      firstName: userData.first_name,\n      lastName: userData.last_name,\n      created_at: createdAt,\n      updated_at: updatedAt,\n      createdAt: createdAt,\n      updatedAt: updatedAt,\n      is_active: Boolean(userData.is_active),\n      isActive: Boolean(userData.is_active),\n      lastLoginAt: userData.last_login_at ? new Date(userData.last_login_at) : undefined,\n      roles: [] as Role[]\n    };\n  }\n}\n\n/**\n * Instancia singleton del servicio de autenticaci√≥n\n */\nlet authServiceInstance: AuthService | null = null;\n\n/**\n * Inicializa el servicio de autenticaci√≥n\n * @returns Instancia del servicio de autenticaci√≥n\n */\nexport function initAuthService(): AuthService {\n  authServiceInstance = new AuthService();\n  return authServiceInstance;\n}\n\n/**\n * Obtiene la instancia del servicio de autenticaci√≥n\n * @returns Instancia del servicio de autenticaci√≥n\n * @throws Error si no ha sido inicializado\n */\nexport function getAuthService(): AuthService {\n  if (!authServiceInstance) {\n    throw new Error('Auth Service not initialized. Call initAuthService() first.');\n  }\n  return authServiceInstance;\n}",
    "// src/services/permissions.ts\nimport { getDatabase } from '../db/connection';\nimport type { \n  Role, \n  Permission, \n  CreateRoleData, \n  CreatePermissionData, \n  UpdatePermissionData,\n  UpdateRoleData,\n  AssignRoleData, \n  PermissionOptions,\n  PermissionResult,\n  RoleResult,\n  AuthErrorType\n} from '../types/auth';\n\n/**\n * Servicio de permisos y gesti√≥n de roles\n * Maneja la creaci√≥n, asignaci√≥n y verificaci√≥n de roles y permisos\n */\nexport class PermissionService {\n  /**\n   * Crea un nuevo permiso\n   * @param data Datos del permiso\n   * @returns Resultado de la operaci√≥n\n   */\n  async createPermission(data: CreatePermissionData): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      // Validar datos\n      const validation = this.validatePermissionData(data);\n      if (!validation.isValid) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: validation.error!\n          }\n        };\n      }\n\n      // Verificar si el permiso ya existe\n      const existingPermission = await this.findPermissionByName(data.name);\n      if (existingPermission) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: `Permission '${data.name}' already exists`\n          }\n        };\n      }\n\n      // Crear permiso\n      const permissionId = crypto.randomUUID();\n      const query = db.query(\n        \"INSERT INTO permissions (id, name, resource, action, description, created_at) VALUES (?, ?, ?, ?, ?, datetime('now'))\"\n      );\n      query.run(permissionId, data.name, data.resource || 'default', data.action || 'read', data.description || null);\n\n      // Obtener el permiso creado\n      const permission = await this.findPermissionById(permissionId);\n      if (!permission) {\n        return {\n          success: false,\n          error: {\n            type: 'DATABASE_ERROR' as AuthErrorType,\n            message: 'Failed to create permission'\n          }\n        };\n      }\n\n      return {\n        success: true,\n        permission\n      };\n    } catch (error:any) {\n      console.error('Error creating permission:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to create permission: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Crea un nuevo rol\n   * @param data Datos del rol\n   * @returns Resultado de la operaci√≥n\n   */\n  async createRole(data: CreateRoleData): Promise<RoleResult> {\n    try {\n      const db = getDatabase();\n\n      // Validar datos\n      const validation = this.validateRoleData(data);\n      if (!validation.isValid) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: validation.error!\n          }\n        };\n      }\n\n      // Verificar si el rol ya existe\n      const existingRole = await this.findRoleByName(data.name);\n      if (existingRole) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: `Role '${data.name}' already exists`\n          }\n        };\n      }\n\n      // Crear rol\n      const roleId = crypto.randomUUID();\n      const query = db.query(\n        \"INSERT INTO roles (id, name, description, is_active, created_at) VALUES (?, ?, ?, ?, datetime('now'))\"\n      );\n      query.run(roleId, data.name, data.description || null, 1);\n\n      // Asignar permisos si se proporcionan\n      if (data.permissionIds && data.permissionIds.length > 0) {\n        const assignResult = await this.assignPermissionsToRole(roleId, data.permissionIds);\n        if (!assignResult.success) {\n          return assignResult;\n        }\n      }\n\n      // Obtener el rol creado con permisos\n      const role = await this.findRoleById(roleId, true);\n      if (!role) {\n        return {\n          success: false,\n          error: {\n            type: 'DATABASE_ERROR' as AuthErrorType,\n            message: 'Failed to create role'\n          }\n        };\n      }\n\n      return {\n        success: true,\n        role\n      };\n    } catch (error:any) {\n      console.error('Error creating role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to create role: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Asigna un rol a un usuario\n   * @param data Datos de asignaci√≥n\n   */\n  async assignRoleToUser(data: AssignRoleData): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el usuario y el rol existen\n      const userExists = await this.checkUserExists(data.userId);\n      if (!userExists) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'User not found'\n          }\n        };\n      }\n\n      const roleExists = await this.checkRoleExists(data.roleId);\n      if (!roleExists) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Role not found'\n          }\n        };\n      }\n\n      // Verificar si la asignaci√≥n ya existe\n      const existingQuery = db.query(\n        \"SELECT id FROM user_roles WHERE user_id = ? AND role_id = ?\"\n      );\n      const existingAssignment = existingQuery.all(data.userId, data.roleId) as any[];\n\n      if (existingAssignment.length > 0) {\n        return {\n          success: false,\n          error: {\n            type: 'VALIDATION_ERROR' as AuthErrorType,\n            message: 'User already has this role'\n          }\n        };\n      }\n\n      // Crear asignaci√≥n\n      const insertQuery = db.query(\n        \"INSERT INTO user_roles (id, user_id, role_id, created_at) VALUES (?, ?, ?, datetime('now'))\"\n      );\n      insertQuery.run(crypto.randomUUID(), data.userId, data.roleId);\n\n      console.log(`‚úÖ Rol asignado al usuario: ${data.userId} -> ${data.roleId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error assigning role to user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to assign role: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Remueve un rol de un usuario\n   * @param userId ID del usuario\n   * @param roleId ID del rol\n   */\n  async removeRoleFromUser(userId: string, roleId: string): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(\n        \"DELETE FROM user_roles WHERE user_id = ? AND role_id = ?\"\n      );\n      query.run(userId, roleId);\n\n      console.log(`‚úÖ Rol removido del usuario: ${userId} -> ${roleId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error removing role from user:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to remove role: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Asigna permisos a un rol\n   * @param roleId ID del rol\n   * @param permissionIds Array de IDs de permisos\n   */\n  async assignPermissionsToRole(roleId: string, permissionIds: string[]): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el rol existe\n      const roleExists = await this.checkRoleExists(roleId);\n      if (!roleExists) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Role not found'\n          }\n        };\n      }\n\n      // Verificar que todos los permisos existen\n      for (const permissionId of permissionIds) {\n        const permissionExists = await this.checkPermissionExists(permissionId);\n        if (!permissionExists) {\n          return {\n            success: false,\n            error: {\n              type: 'NOT_FOUND_ERROR' as AuthErrorType,\n              message: `Permission not found: ${permissionId}`\n            }\n          };\n        }\n      }\n\n      // Verificar duplicados y asignar permisos\n      for (const permissionId of permissionIds) {\n        // Verificar si ya existe la asignaci√≥n\n        const existingQuery = db.query(\n          \"SELECT id FROM role_permissions WHERE role_id = ? AND permission_id = ?\"\n        );\n        const existing = existingQuery.get(roleId, permissionId) as any;\n        \n        if (existing) {\n          return {\n            success: false,\n            error: {\n              type: 'VALIDATION_ERROR' as AuthErrorType,\n              message: `Permission ${permissionId} is already assigned to role ${roleId}`\n            }\n          };\n        }\n        \n        // Insertar nueva asignaci√≥n\n        const insertQuery = db.query(\n          \"INSERT INTO role_permissions (id, role_id, permission_id, created_at) VALUES (?, ?, ?, datetime('now'))\"\n        );\n        insertQuery.run(crypto.randomUUID(), roleId, permissionId);\n      }\n\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error assigning permissions to role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to assign permissions: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Asigna un permiso espec√≠fico a un rol (m√©todo individual)\n   * @param roleId ID del rol\n   * @param permissionId ID del permiso\n   */\n  async assignPermissionToRole(roleId: string, permissionId: string): Promise<PermissionResult> {\n    return this.assignPermissionsToRole(roleId, [permissionId]);\n  }\n\n  /**\n   * Remueve permisos de un rol\n   * @param roleId ID del rol\n   * @param permissionIds Array de IDs de permisos\n   */\n  async removePermissionsFromRole(roleId: string, permissionIds: string[]): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      for (const permissionId of permissionIds) {\n        const query = db.query(\n          \"DELETE FROM role_permissions WHERE role_id = ? AND permission_id = ?\"\n        );\n        query.run(roleId, permissionId);\n      }\n\n      console.log(`‚úÖ Permisos removidos del rol: ${roleId}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error removing permissions from role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to remove permissions: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Actualiza un permiso existente\n   * @param id ID del permiso\n   * @param data Datos de actualizaci√≥n\n   */\n  async updatePermission(id: string, data: UpdatePermissionData): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el permiso existe\n      const existingPermission = await this.findPermissionById(id);\n      if (!existingPermission) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Permission not found'\n          }\n        };\n      }\n\n      // Verificar que el nombre no est√© en uso por otro permiso\n      if (data.name && data.name !== existingPermission.name) {\n        const existingByName = await this.findPermissionByName(data.name);\n        if (existingByName && existingByName.id !== id) {\n          return {\n            success: false,\n            error: {\n              type: 'VALIDATION_ERROR' as AuthErrorType,\n              message: 'Permission name already exists'\n            }\n          };\n        }\n      }\n\n      const query = db.query(\n        \"UPDATE permissions SET name = ?, resource = ?, action = ?, description = ? WHERE id = ?\"\n      );\n      query.run(\n        data.name || existingPermission.name,\n        data.resource || existingPermission.resource,\n        data.action || existingPermission.action,\n        data.description !== undefined ? data.description : (existingPermission.description || null),\n        id\n      );\n\n      const updatedPermission = await this.findPermissionById(id);\n      console.log(`‚úÖ Permiso actualizado: ${updatedPermission?.name}`);\n      \n      return {\n        success: true,\n        permission: updatedPermission as Permission\n      };\n    } catch (error:any) {\n      console.error('Error updating permission:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to update permission: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Elimina un permiso\n   * @param id ID del permiso\n   */\n  async deletePermission(id: string): Promise<PermissionResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el permiso existe\n      const existingPermission = await this.findPermissionById(id);\n      if (!existingPermission) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Permission not found'\n          }\n        };\n      }\n\n      // Eliminar relaciones primero\n      const deleteRelationsQuery = db.query(\n        \"DELETE FROM role_permissions WHERE permission_id = ?\"\n      );\n      deleteRelationsQuery.run(id);\n\n      // Eliminar el permiso\n      const deletePermissionQuery = db.query(\n        \"DELETE FROM permissions WHERE id = ?\"\n      );\n      deletePermissionQuery.run(id);\n\n      console.log(`‚úÖ Permiso eliminado: ${existingPermission.name}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error deleting permission:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to delete permission: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Actualiza un rol existente\n   * @param id ID del rol\n   * @param data Datos de actualizaci√≥n\n   */\n  async updateRole(id: string, data: UpdateRoleData): Promise<RoleResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el rol existe\n      const existingRole = await this.findRoleById(id);\n      if (!existingRole) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Role not found'\n          }\n        };\n      }\n\n      // Verificar que el nombre no est√© en uso por otro rol\n      if (data.name && data.name !== existingRole.name) {\n        const existingByName = await this.findRoleByName(data.name);\n        if (existingByName && existingByName.id !== id) {\n          return {\n            success: false,\n            error: {\n              type: 'VALIDATION_ERROR' as AuthErrorType,\n              message: 'Role name already exists'\n            }\n          };\n        }\n      }\n\n      const query = db.query(\n        \"UPDATE roles SET name = ?, description = ?, is_active = ? WHERE id = ?\"\n      );\n      query.run(\n        data.name || existingRole.name,\n        data.description !== undefined ? data.description : (existingRole.description || null),\n        data.isActive !== undefined ? (data.isActive ? 1 : 0) : (existingRole.isActive ? 1 : 0),\n        id\n      );\n\n      const updatedRole = await this.findRoleById(id);\n      console.log(`‚úÖ Rol actualizado: ${updatedRole?.name}`);\n      \n      return {\n        success: true,\n        role: updatedRole || undefined\n      };\n    } catch (error:any) {\n      console.error('Error updating role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to update role: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Elimina un rol\n   * @param id ID del rol\n   */\n  async deleteRole(id: string): Promise<RoleResult> {\n    try {\n      const db = getDatabase();\n\n      // Verificar que el rol existe\n      const existingRole = await this.findRoleById(id);\n      if (!existingRole) {\n        return {\n          success: false,\n          error: {\n            type: 'NOT_FOUND_ERROR' as AuthErrorType,\n            message: 'Role not found'\n          }\n        };\n      }\n\n      // Eliminar relaciones con usuarios\n      const deleteUserRolesQuery = db.query(\n        \"DELETE FROM user_roles WHERE role_id = ?\"\n      );\n      deleteUserRolesQuery.run(id);\n\n      // Eliminar relaciones con permisos\n      const deleteRolePermissionsQuery = db.query(\n        \"DELETE FROM role_permissions WHERE role_id = ?\"\n      );\n      deleteRolePermissionsQuery.run(id);\n\n      // Eliminar el rol\n      const deleteRoleQuery = db.query(\n        \"DELETE FROM roles WHERE id = ?\"\n      );\n      deleteRoleQuery.run(id);\n\n      console.log(`‚úÖ Rol eliminado: ${existingRole.name}`);\n      return { success: true };\n    } catch (error:any) {\n      console.error('Error deleting role:', error);\n      return {\n        success: false,\n        error: {\n          type: 'DATABASE_ERROR' as AuthErrorType,\n          message: `Failed to delete role: ${error.message}`\n        }\n      };\n    }\n  }\n\n  /**\n   * Remueve un permiso espec√≠fico de un rol\n   * @param roleId ID del rol\n   * @param permissionId ID del permiso\n   */\n  async removePermissionFromRole(roleId: string, permissionId: string): Promise<PermissionResult> {\n    return this.removePermissionsFromRole(roleId, [permissionId]);\n  }\n\n  /**\n   * Verifica si un usuario tiene un permiso espec√≠fico\n   * @param userId ID del usuario\n   * @param permissionName Nombre del permiso\n   * @param options Opciones de verificaci√≥n\n   * @returns true si el usuario tiene el permiso\n   */\n  async userHasPermission(\n    userId: string, \n    permissionName: string, \n    options: PermissionOptions = {}\n  ): Promise<boolean> {\n    try {\n      const db = getDatabase();\n\n      // First check if user is active\n      const userQuery = db.query(`\n        SELECT is_active\n        FROM users\n        WHERE id = ?\n      `);\n      const userResult = userQuery.get(userId) as { is_active: number } | undefined;\n      \n      if (!userResult || !userResult.is_active) {\n        return false;\n      }\n\n      // Verificar permiso exacto\n      const exactQuery = db.query(`\n        SELECT COUNT(*) as count\n        FROM permissions p\n        INNER JOIN role_permissions rp ON p.id = rp.permission_id\n        INNER JOIN user_roles ur ON rp.role_id = ur.role_id\n        WHERE ur.user_id = ? AND p.name = ?\n      `);\n      const exactResult = exactQuery.get(userId, permissionName) as { count: number };\n\n      if (exactResult?.count > 0) {\n        return true;\n      }\n\n      // Verificar permisos wildcard\n      const wildcardQuery = db.query(`\n        SELECT COUNT(*) as count\n        FROM permissions p\n        INNER JOIN role_permissions rp ON p.id = rp.permission_id\n        INNER JOIN user_roles ur ON rp.role_id = ur.role_id\n        WHERE ur.user_id = ? AND (p.name = '*:*' OR p.name = 'admin:*' OR p.resource = '*' OR p.action = '*')\n      `);\n      const wildcardResult = wildcardQuery.get(userId) as { count: number };\n\n      return wildcardResult?.count > 0;\n    } catch (error:any) {\n      console.error('Error checking user permission:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene un rol espec√≠fico\n   * @param userId ID del usuario\n   * @param roleName Nombre del rol\n   * @returns true si el usuario tiene el rol\n   */\n  async userHasRole(userId: string, roleName: string): Promise<boolean> {\n    try {\n      const db = getDatabase();\n      \n      const query = db.query(`\n        SELECT COUNT(*) as count\n        FROM user_roles ur\n        INNER JOIN roles r ON ur.role_id = r.id\n        WHERE ur.user_id = ? AND r.name = ?\n      `);\n      \n      const result = query.get(userId, roleName) as { count: number };\n      \n      return result?.count > 0;\n    } catch (error:any) {\n      console.error('Error checking user role:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene todos los roles especificados\n   * @param userId ID del usuario\n   * @param roleNames Array de nombres de roles\n   * @returns true si el usuario tiene todos los roles\n   */\n  async userHasAllRoles(userId: string, roleNames: string[]): Promise<boolean> {\n    try {\n      for (const roleName of roleNames) {\n        const hasRole = await this.userHasRole(userId, roleName);\n        if (!hasRole) {\n          return false;\n        }\n      }\n      return true;\n    } catch (error: any) {\n      console.error('Error checking user roles:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene al menos uno de los roles especificados\n   * @param userId ID del usuario\n   * @param roleNames Array de nombres de roles\n   * @returns true si el usuario tiene al menos uno de los roles\n   */\n  async userHasAnyRole(userId: string, roleNames: string[]): Promise<boolean> {\n    try {\n      for (const roleName of roleNames) {\n        const hasRole = await this.userHasRole(userId, roleName);\n        if (hasRole) {\n          return true;\n        }\n      }\n      return false;\n    } catch (error: any) {\n      console.error('Error checking user roles:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene todos los permisos especificados\n   * @param userId ID del usuario\n   * @param permissionNames Array de nombres de permisos\n   * @returns true si el usuario tiene todos los permisos\n   */\n  async userHasAllPermissions(userId: string, permissionNames: string[]): Promise<boolean> {\n    try {\n      for (const permissionName of permissionNames) {\n        const hasPermission = await this.userHasPermission(userId, permissionName);\n        if (!hasPermission) {\n          return false;\n        }\n      }\n      return true;\n    } catch (error:any) {\n      console.error('Error checking user permissions:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene al menos uno de los permisos especificados\n   * @param userId ID del usuario\n   * @param permissionNames Array de nombres de permisos\n   * @returns true si el usuario tiene al menos uno de los permisos\n   */\n  async userHasAnyPermission(userId: string, permissionNames: string[]): Promise<boolean> {\n    try {\n      for (const permissionName of permissionNames) {\n        const hasPermission = await this.userHasPermission(userId, permissionName);\n        if (hasPermission) {\n          return true;\n        }\n      }\n      return false;\n    } catch (error:any) {\n      console.error('Error checking user permissions:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario puede acceder a un recurso espec√≠fico\n   * @param userId ID del usuario\n   * @param resource Nombre del recurso\n   * @param action Acci√≥n a realizar (read, write, delete, etc.)\n   * @returns true si el usuario puede acceder al recurso\n   */\n  async userCanAccessResource(userId: string, resource: string, action: string): Promise<boolean> {\n    try {\n      const db = getDatabase();\n\n      // Verificar permiso exacto\n      const exactPermissionName = `${resource}:${action}`;\n      const hasExactPermission = await this.userHasPermission(userId, exactPermissionName);\n      \n      if (hasExactPermission) {\n        return true;\n      }\n\n      // Verificar permisos wildcard espec√≠ficos para el recurso y acci√≥n\n      const wildcardQuery = db.query(`\n        SELECT COUNT(*) as count\n        FROM permissions p\n        INNER JOIN role_permissions rp ON p.id = rp.permission_id\n        INNER JOIN user_roles ur ON rp.role_id = ur.role_id\n        WHERE ur.user_id = ? AND (\n          p.name = '*:*' OR \n          p.name = 'admin:*' OR \n          p.name = ? OR \n          p.name = ? OR \n          (p.resource = '*' AND p.action = '*') OR\n          (p.resource = ? AND p.action = '*') OR\n          (p.resource = '*' AND p.action = ?)\n        )\n      `);\n      \n      const wildcardResult = wildcardQuery.get(\n        userId, \n        `${resource}:*`, \n        `*:${action}`, \n        resource, \n        action\n      ) as { count: number };\n\n      return wildcardResult?.count > 0;\n    } catch (error:any) {\n      console.error('Error checking resource access:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Verifica si un usuario tiene m√∫ltiples permisos\n   * @param userId ID del usuario\n   * @param permissionNames Array de nombres de permisos\n   * @param options Opciones de verificaci√≥n\n   * @returns true si cumple con los criterios\n   */\n  async userHasPermissions(\n    userId: string, \n    permissionNames: string[], \n    options: PermissionOptions = {}\n  ): Promise<boolean> {\n    try {\n      if (permissionNames.length === 0) {\n        return true;\n      }\n\n      const results = await Promise.all(\n        permissionNames.map(permission => \n          this.userHasPermission(userId, permission, options)\n        )\n      );\n\n      // Si requireAll es true, todos los permisos deben estar presentes\n      if (options.requireAll) {\n        return results.every(result => result);\n      }\n\n      // Por defecto, solo se requiere uno (OR)\n      return results.some(result => result);\n    } catch (error:any) {\n      console.error('Error checking user permissions:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Obtiene todos los permisos de un usuario\n   * @param userId ID del usuario\n   * @returns Array de permisos\n   */\n  async getUserPermissions(userId: string): Promise<Permission[]> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(`\n        SELECT DISTINCT p.id, p.name, p.resource, p.action, p.description, p.created_at\n        FROM permissions p\n        INNER JOIN role_permissions rp ON p.id = rp.permission_id\n        INNER JOIN user_roles ur ON rp.role_id = ur.role_id\n        WHERE ur.user_id = ?\n        ORDER BY p.resource, p.action\n      `);\n      const result = query.all(userId) as any[];\n\n      return result.map((row: any) => ({\n        id: row.id,\n        name: row.name,\n        resource: row.resource,\n        action: row.action,\n        description: row.description,\n        created_at: new Date(row.created_at)\n      }));\n    } catch (error:any) {\n      console.error('Error getting user permissions:', error);\n      throw new Error(`Failed to get user permissions: ${error.message}`);\n    }\n  }\n\n  /**\n   * Busca un permiso por ID\n   * @param id ID del permiso\n   * @returns Permiso o null\n   */\n  async findPermissionById(id: string): Promise<Permission | null> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(\n        \"SELECT id, name, resource, action, description, created_at FROM permissions WHERE id = ?\"\n      );\n      const result = query.get(id) as any;\n\n      if (!result) {\n        return null;\n      }\n\n      return {\n        id: result.id,\n        name: result.name,\n        resource: result.resource,\n        action: result.action,\n        description: result.description,\n        created_at: new Date(result.created_at)\n      };\n    } catch (error:any) {\n      console.error('Error finding permission by ID:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Busca un permiso por nombre\n   * @param name Nombre del permiso\n   * @returns Permiso o null\n   */\n  async findPermissionByName(name: string): Promise<Permission | null> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(\n        \"SELECT id, name, resource, action, description, created_at FROM permissions WHERE name = ?\"\n      );\n      const result = query.get(name) as any;\n\n      if (!result) {\n        return null;\n      }\n\n      return {\n        id: result.id,\n        name: result.name,\n        resource: result.resource,\n        action: result.action,\n        description: result.description,\n        created_at: new Date(result.created_at)\n      };\n    } catch (error:any) {\n      console.error('Error finding permission by name:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Busca un rol por ID\n   * @param id ID del rol\n   * @param includePermissions Si incluir permisos\n   * @returns Rol o null\n   */\n  async findRoleById(id: string, includePermissions: boolean = false): Promise<Role | null> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(\n        \"SELECT id, name, description, created_at, is_active FROM roles WHERE id = ?\"\n      );\n      const result = query.get(id) as any;\n\n      if (!result) {\n        return null;\n      }\n\n      const role: Role = {\n        id: result.id,\n        name: result.name,\n        description: result.description,\n        created_at: new Date(result.created_at),\n        isActive: Boolean(result.is_active),\n        permissions: []\n      };\n\n      if (includePermissions) {\n        role.permissions = await this.getRolePermissions(id);\n      }\n\n      return role;\n    } catch (error:any) {\n      console.error('Error finding role by ID:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Busca un rol por nombre\n   * @param name Nombre del rol\n   * @param includePermissions Si incluir permisos\n   * @returns Rol o null\n   */\n  async findRoleByName(name: string, includePermissions: boolean = false): Promise<Role | null> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(\n        \"SELECT id, name, description, created_at, is_active FROM roles WHERE name = ?\"\n      );\n      const result = query.get(name) as any;\n\n      if (!result) {\n        return null;\n      }\n\n      const role: Role = {\n        id: result.id,\n        name: result.name,\n        description: result.description,\n        created_at: new Date(result.created_at),\n        isActive: Boolean(result.is_active),\n        permissions: []\n      };\n\n      if (includePermissions) {\n        role.permissions = await this.getRolePermissions(result.id);\n      }\n\n      return role;\n    } catch (error:any) {\n      console.error('Error finding role by name:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Obtiene los permisos de un rol\n   * @param roleId ID del rol\n   * @returns Array de permisos\n   */\n  async getRolePermissions(roleId: string): Promise<Permission[]> {\n    try {\n      const db = getDatabase();\n\n      const result = db.query(`\n        SELECT p.id, p.name, p.resource, p.action, p.description, p.created_at\n        FROM permissions p\n        INNER JOIN role_permissions rp ON p.id = rp.permission_id\n        WHERE rp.role_id = ?\n        ORDER BY p.resource, p.action\n      `).all(roleId);\n\n      return result.map((row: any) => ({\n        id: row.id,\n        name: row.name,\n        resource: row.resource,\n        action: row.action,\n        description: row.description,\n        created_at: new Date(row.created_at)\n      }));\n    } catch (error:any) {\n      console.error('Error getting role permissions:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Obtiene todos los roles\n   * @param includePermissions Si incluir permisos\n   * @returns Array de roles\n   */\n  async getAllRoles(includePermissions: boolean = false): Promise<Role[]> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(`\n        SELECT id, name, description, created_at, is_active\n        FROM roles\n        ORDER BY name\n      `);\n      const result = query.all() as any[];\n\n      const roles = [];\n      for (const row of result as any[]) {\n        const role: Role = {\n          id: row.id,\n          name: row.name,\n          description: row.description,\n          created_at: new Date(row.created_at),\n          isActive: Boolean(row.is_active),\n          permissions: []\n        };\n\n        if (includePermissions) {\n          role.permissions = await this.getRolePermissions(row.id);\n        }\n\n        roles.push(role);\n      }\n\n      return roles;\n    } catch (error:any) {\n      console.error('Error getting all roles:', error);\n      throw new Error(`Failed to get roles: ${error.message}`);\n    }\n  }\n\n  /**\n   * Obtiene todos los permisos\n   * @returns Array de permisos\n   */\n  async getAllPermissions(): Promise<Permission[]> {\n    try {\n      const db = getDatabase();\n\n      const query = db.query(`\n        SELECT id, name, resource, action, description, created_at\n        FROM permissions\n        ORDER BY resource, action\n      `);\n      const result = query.all() as any[];\n\n      return result.map((row: any) => ({\n        id: row.id,\n        name: row.name,\n        resource: row.resource,\n        action: row.action,\n        description: row.description,\n        created_at: new Date(row.created_at)\n      }));\n    } catch (error:any) {\n      console.error('Error getting all permissions:', error);\n      throw new Error(`Failed to get permissions: ${error.message}`);\n    }\n  }\n\n  // M√©todos de validaci√≥n y utilidad privados\n\n  private validatePermissionData(data: CreatePermissionData): { isValid: boolean; error?: string } {\n    if (!data.name || !data.resource || !data.action) {\n      return {\n        isValid: false,\n        error: 'Name, resource, and action are required'\n      };\n    }\n\n    if (data.name.length < 3) {\n      return {\n        isValid: false,\n        error: 'Permission name must be at least 3 characters long'\n      };\n    }\n\n    return { isValid: true };\n  }\n\n  private validateRoleData(data: CreateRoleData): { isValid: boolean; error?: string } {\n    if (!data.name) {\n      return {\n        isValid: false,\n        error: 'Role name is required'\n      };\n    }\n\n    if (data.name.length < 3) {\n      return {\n        isValid: false,\n        error: 'Role name must be at least 3 characters long'\n      };\n    }\n\n    return { isValid: true };\n  }\n\n  private async checkUserExists(userId: string): Promise<boolean> {\n    try {\n      const db = getDatabase();\n      const query = db.query(\"SELECT id FROM users WHERE id = ?\");\n      const result = query.get(userId) as any;\n      return !!result;\n    } catch (error:any) {\n      console.error('Error checking user existence:', error);\n      return false;\n    }\n  }\n\n  private async checkRoleExists(roleId: string): Promise<boolean> {\n    try {\n      const db = getDatabase();\n      const query = db.query(\"SELECT id FROM roles WHERE id = ?\");\n      const result = query.get(roleId) as any;\n      return !!result;\n    } catch (error:any) {\n      console.error('Error checking role existence:', error);\n      return false;\n    }\n  }\n\n  private async checkPermissionExists(permissionId: string): Promise<boolean> {\n    try {\n      const db = getDatabase();\n      const query = db.query(\"SELECT id FROM permissions WHERE id = ?\");\n      const result = query.get(permissionId) as any;\n      return !!result;\n    } catch (error:any) {\n      console.error('Error checking permission existence:', error);\n      return false;\n    }\n  }\n}\n\n/**\n * Instancia singleton del servicio de permisos\n */\nlet permissionServiceInstance: PermissionService | null = null;\n\n/**\n * Inicializa el servicio de permisos\n * @returns Instancia del servicio de permisos\n */\nexport function initPermissionService(): PermissionService {\n  permissionServiceInstance = new PermissionService();\n  return permissionServiceInstance;\n}\n\n/**\n * Obtiene la instancia del servicio de permisos\n * @returns Instancia del servicio de permisos\n * @throws Error si no ha sido inicializado\n */\nexport function getPermissionService(): PermissionService {\n  if (!permissionServiceInstance) {\n    throw new Error('Permission Service not initialized. Call initPermissionService() first.');\n  }\n  return permissionServiceInstance;\n}",
    "// src/config/auth.ts\nimport type { AuthConfig, SecurityConfig } from '../types/auth';\n\n/**\n * Configuraci√≥n por defecto para la librer√≠a de autenticaci√≥n\n */\nexport const DEFAULT_AUTH_CONFIG: AuthConfig = {\n  jwtSecret: process.env.JWT_SECRET || 'change-this-secret-in-production',\n  jwtExpiration: process.env.JWT_EXPIRATION || '1h',\n  refreshTokenExpiration: process.env.REFRESH_TOKEN_EXPIRATION || '7d',\n  \n  // Configuraci√≥n de base de datos\n  database: {\n    path: process.env.DATABASE_PATH || './data/auth.db',\n    enableWAL: process.env.DATABASE_WAL === 'true',\n    enableForeignKeys: true,\n    busyTimeout: 5000\n  },\n  \n  // Configuraci√≥n de seguridad\n  security: {\n    bcryptRounds: parseInt(process.env.BCRYPT_ROUNDS || '12'),\n    maxLoginAttempts: parseInt(process.env.MAX_LOGIN_ATTEMPTS || '5'),\n    lockoutDuration: parseInt(process.env.LOCKOUT_DURATION || '900000'), // 15 minutos\n    sessionTimeout: parseInt(process.env.SESSION_TIMEOUT || '3600000'), // 1 hora\n    requireEmailVerification: process.env.REQUIRE_EMAIL_VERIFICATION === 'true',\n    allowMultipleSessions: process.env.ALLOW_MULTIPLE_SESSIONS !== 'false',\n    passwordMinLength: parseInt(process.env.PASSWORD_MIN_LENGTH || '8'),\n    passwordRequireUppercase: process.env.PASSWORD_REQUIRE_UPPERCASE !== 'false',\n    passwordRequireLowercase: process.env.PASSWORD_REQUIRE_LOWERCASE !== 'false',\n    passwordRequireNumbers: process.env.PASSWORD_REQUIRE_NUMBERS !== 'false',\n    passwordRequireSymbols: process.env.PASSWORD_REQUIRE_SYMBOLS !== 'false'\n  },\n  \n  // Configuraci√≥n de CORS\n  cors: {\n    origins: process.env.CORS_ORIGINS?.split(',') || ['http://localhost:3000'],\n    credentials: true,\n    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],\n    headers: ['Content-Type', 'Authorization']\n  },\n  \n  // Configuraci√≥n de rate limiting\n  rateLimit: {\n    windowMs: parseInt(process.env.RATE_LIMIT_WINDOW || '900000'), // 15 minutos\n    maxRequests: parseInt(process.env.RATE_LIMIT_MAX || '100'),\n    skipSuccessfulRequests: false,\n    skipFailedRequests: false\n  },\n  \n  // Configuraci√≥n de logging\n  logging: {\n    level: (process.env.LOG_LEVEL as 'debug' | 'info' | 'warn' | 'error') || 'info',\n    enableConsole: process.env.LOG_CONSOLE !== 'false',\n    enableFile: process.env.LOG_FILE === 'true',\n    filePath: process.env.LOG_FILE_PATH || './logs/auth.log',\n    enableDatabase: process.env.LOG_DATABASE === 'true'\n  }\n};\n\n/**\n * Configuraci√≥n de seguridad avanzada\n */\nexport const SECURITY_CONFIG: SecurityConfig = {\n  // Configuraci√≥n de headers de seguridad\n  securityHeaders: {\n    'X-Content-Type-Options': 'nosniff',\n    'X-Frame-Options': 'DENY',\n    'X-XSS-Protection': '1; mode=block',\n    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',\n    'Referrer-Policy': 'strict-origin-when-cross-origin'\n  },\n  \n  // Configuraci√≥n de cookies\n  cookies: {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict' as const,\n    maxAge: 24 * 60 * 60 * 1000 // 24 horas\n  },\n  \n  // Configuraci√≥n de validaci√≥n de entrada\n  validation: {\n    maxEmailLength: 254,\n    maxNameLength: 100,\n    maxPasswordLength: 128,\n    allowedEmailDomains: process.env.ALLOWED_EMAIL_DOMAINS?.split(','),\n    blockedEmailDomains: process.env.BLOCKED_EMAIL_DOMAINS?.split(',') || [\n      'tempmail.org',\n      '10minutemail.com',\n      'guerrillamail.com'\n    ]\n  },\n  \n  // Configuraci√≥n de IP y geolocalizaci√≥n\n  ipSecurity: {\n    enableGeoBlocking: process.env.ENABLE_GEO_BLOCKING === 'true',\n    blockedCountries: process.env.BLOCKED_COUNTRIES?.split(',') || [],\n    enableIPWhitelist: process.env.ENABLE_IP_WHITELIST === 'true',\n    ipWhitelist: process.env.IP_WHITELIST?.split(',') || [],\n    enableIPBlacklist: process.env.ENABLE_IP_BLACKLIST === 'true',\n    ipBlacklist: process.env.IP_BLACKLIST?.split(',') || []\n  }\n};\n\n/**\n * Configuraci√≥n de desarrollo\n */\nexport const DEV_CONFIG: Partial<AuthConfig> = {\n  jwtSecret: 'dev-secret-key-not-for-production',\n  jwtExpiration: '24h',\n  refreshTokenExpiration: '30d',\n  \n  security: {\n    bcryptRounds: 4, // M√°s r√°pido para desarrollo\n    maxLoginAttempts: 10,\n    lockoutDuration: 60000, // 1 minuto\n    sessionTimeout: 24 * 60 * 60 * 1000, // 24 horas\n    requireEmailVerification: false,\n    allowMultipleSessions: true,\n    passwordMinLength: 6,\n    passwordRequireUppercase: false,\n    passwordRequireLowercase: false,\n    passwordRequireNumbers: false,\n    passwordRequireSymbols: false\n  },\n  \n  logging: {\n    level: 'debug',\n    enableConsole: true,\n    enableFile: false,\n    filePath: './logs/auth.log',\n    enableDatabase: false\n  }\n};\n\n/**\n * Configuraci√≥n de producci√≥n\n */\nexport const PROD_CONFIG: Partial<AuthConfig> = {\n  security: {\n    bcryptRounds: 14, // M√°s seguro para producci√≥n\n    maxLoginAttempts: 3,\n    lockoutDuration: 30 * 60 * 1000, // 30 minutos\n    sessionTimeout: 60 * 60 * 1000, // 1 hora\n    requireEmailVerification: true,\n    allowMultipleSessions: false,\n    passwordMinLength: 12,\n    passwordRequireUppercase: true,\n    passwordRequireLowercase: true,\n    passwordRequireNumbers: true,\n    passwordRequireSymbols: true\n  },\n  \n  logging: {\n    level: 'warn',\n    enableConsole: false,\n    enableFile: true,\n    filePath: './logs/auth.log',\n    enableDatabase: true\n  }\n};\n\n/**\n * Funci√≥n para obtener la configuraci√≥n seg√∫n el entorno\n */\nexport function getAuthConfig(environment?: string): AuthConfig {\n  const env = environment || process.env.NODE_ENV || 'development';\n  \n  let config = { ...DEFAULT_AUTH_CONFIG };\n  \n  switch (env) {\n    case 'development':\n      config = mergeConfig(config, DEV_CONFIG);\n      break;\n    case 'production':\n      config = mergeConfig(config, PROD_CONFIG);\n      break;\n    case 'test':\n      config = mergeConfig(config, {\n        database: { \n          path: ':memory:',\n          enableWAL: false,\n          enableForeignKeys: true,\n          busyTimeout: 5000\n        },\n        logging: { \n          level: 'error', \n          enableConsole: false,\n          enableFile: false,\n          filePath: './logs/auth.log',\n          enableDatabase: false\n        }\n      });\n      break;\n  }\n  \n  return config;\n}\n\n/**\n * Funci√≥n para validar la configuraci√≥n\n */\nexport function validateAuthConfig(config: AuthConfig): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  \n  // Validar JWT secret\n  if (!config.jwtSecret || config.jwtSecret === 'change-this-secret-in-production') {\n    if (process.env.NODE_ENV === 'production') {\n      errors.push('JWT secret debe ser configurado en producci√≥n');\n    }\n  }\n  \n  if (config.jwtSecret && config.jwtSecret.length < 32) {\n    errors.push('JWT secret debe tener al menos 32 caracteres');\n  }\n  \n  // Validar configuraci√≥n de base de datos\n  if (!config.database?.path) {\n    errors.push('Ruta de base de datos es requerida');\n  }\n  \n  // Validar configuraci√≥n de seguridad\n  if (config.security) {\n    if (config.security.bcryptRounds < 4 || config.security.bcryptRounds > 20) {\n      errors.push('bcryptRounds debe estar entre 4 y 20');\n    }\n    \n    if (config.security.passwordMinLength < 6) {\n      errors.push('passwordMinLength debe ser al menos 6');\n    }\n    \n    if (config.security.maxLoginAttempts < 1) {\n      errors.push('maxLoginAttempts debe ser al menos 1');\n    }\n  }\n  \n  // Validar CORS\n  if (config.cors?.origins && config.cors.origins.length === 0) {\n    errors.push('Al menos un origen CORS debe ser especificado');\n  }\n  \n  return {\n    valid: errors.length === 0,\n    errors\n  };\n}\n\n/**\n * Funci√≥n para obtener variables de entorno requeridas\n */\nexport function getRequiredEnvVars(): { [key: string]: string | undefined } {\n  return {\n    JWT_SECRET: process.env.JWT_SECRET,\n    DATABASE_PATH: process.env.DATABASE_PATH,\n    NODE_ENV: process.env.NODE_ENV,\n    BCRYPT_ROUNDS: process.env.BCRYPT_ROUNDS,\n    MAX_LOGIN_ATTEMPTS: process.env.MAX_LOGIN_ATTEMPTS,\n    CORS_ORIGINS: process.env.CORS_ORIGINS\n  };\n}\n\n/**\n * Funci√≥n para generar un archivo .env de ejemplo\n */\nexport function generateEnvExample(): string {\n  return `# Configuraci√≥n de Autenticaci√≥n\n\n# JWT Configuration\nJWT_SECRET=your-super-secret-jwt-key-change-this-in-production\nJWT_EXPIRATION=1h\nREFRESH_TOKEN_EXPIRATION=7d\n\n# Database Configuration\nDATABASE_PATH=./data/auth.db\nDATABASE_WAL=true\n\n# Security Configuration\nBCRYPT_ROUNDS=12\nMAX_LOGIN_ATTEMPTS=5\nLOCKOUT_DURATION=900000\nSESSION_TIMEOUT=3600000\nREQUIRE_EMAIL_VERIFICATION=false\nALLOW_MULTIPLE_SESSIONS=true\n\n# Password Policy\nPASSWORD_MIN_LENGTH=8\nPASSWORD_REQUIRE_UPPERCASE=true\nPASSWORD_REQUIRE_LOWERCASE=true\nPASSWORD_REQUIRE_NUMBERS=true\nPASSWORD_REQUIRE_SYMBOLS=true\n\n# CORS Configuration\nCORS_ORIGINS=http://localhost:3000,http://localhost:3001\n\n# Rate Limiting\nRATE_LIMIT_WINDOW=900000\nRATE_LIMIT_MAX=100\n\n# Logging\nLOG_LEVEL=info\nLOG_CONSOLE=true\nLOG_FILE=false\nLOG_FILE_PATH=./logs/auth.log\nLOG_DATABASE=false\n\n# Email Validation\nALLOWED_EMAIL_DOMAINS=\nBLOCKED_EMAIL_DOMAINS=tempmail.org,10minutemail.com\n\n# IP Security\nENABLE_GEO_BLOCKING=false\nBLOCKED_COUNTRIES=\nENABLE_IP_WHITELIST=false\nIP_WHITELIST=\nENABLE_IP_BLACKLIST=false\nIP_BLACKLIST=\n\n# Environment\nNODE_ENV=development\n`;\n}\n\n/**\n * Funci√≥n helper para mergear configuraciones\n */\nfunction mergeConfig(base: AuthConfig, override: Partial<AuthConfig>): AuthConfig {\n  const result = { ...base };\n  \n  Object.keys(override).forEach(key => {\n    const value = override[key as keyof AuthConfig];\n    if (value !== undefined) {\n      if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n        const baseValue = result[key as keyof AuthConfig];\n        if (typeof baseValue === 'object' && baseValue !== null && !Array.isArray(baseValue)) {\n          result[key as keyof AuthConfig] = {\n            ...baseValue,\n            ...value\n          } as any;\n        } else {\n          result[key as keyof AuthConfig] = value as any;\n        }\n      } else {\n        result[key as keyof AuthConfig] = value as any;\n      }\n    }\n  });\n  \n  return result;\n}\n\n/**\n * Funci√≥n para imprimir la configuraci√≥n actual (sin secretos)\n */\nexport function printConfig(config: AuthConfig): void {\n  const safeConfig = { ...config };\n  \n  // Ocultar informaci√≥n sensible\n  if (safeConfig.jwtSecret) {\n    safeConfig.jwtSecret = '***HIDDEN***';\n  }\n  \n  console.log('üîß Configuraci√≥n de autenticaci√≥n:');\n  console.log(JSON.stringify(safeConfig, null, 2));\n}\n\n/**\n * Exportar configuraci√≥n por defecto\n */\nexport default getAuthConfig();",
    "// src/middleware/auth.ts\nimport { getJWTService } from '../services/jwt';\nimport { getAuthService } from '../services/auth';\nimport { getPermissionService } from '../services/permissions';\nimport type { \n  AuthRequest, \n  AuthResponse, \n  AuthContext, \n  PermissionOptions,\n  AuthError,\n  AuthErrorType \n} from '../types/auth';\n\n/**\n * Configuraci√≥n del middleware de autenticaci√≥n\n */\nexport interface AuthMiddlewareConfig {\n  required?: boolean; // Si la autenticaci√≥n es requerida\n  permissions?: string[]; // Permisos requeridos\n  permissionOptions?: PermissionOptions; // Opciones de verificaci√≥n de permisos\n  skipPaths?: string[]; // Rutas que se saltan la autenticaci√≥n\n  tokenHeader?: string; // Header del token (default: 'authorization')\n  extractToken?: (req: any) => string | null; // Custom token extraction function\n  userProperty?: string; // Property name to attach user to request (default: 'user')\n  contextProperty?: string; // Property name to attach auth context to request (default: 'authContext')\n  jwtSecret?: string; // JWT secret for testing\n  authService?: any; // Auth service instance for testing\n  jwtService?: any; // JWT service instance for testing\n  permissionService?: any; // Permission service instance for testing\n  onError?: (error: Error, req: any, res: any) => void; // Custom error handler\n  onSuccess?: (user: any, context: AuthContext, req: any) => void; // Custom success handler\n  config?: { // Nested config object for backward compatibility\n    tokenHeader?: string;\n    userProperty?: string;\n    contextProperty?: string;\n  };\n}\n\n/**\n * Funci√≥n de middleware agn√≥stica para autenticaci√≥n\n * Esta funci√≥n puede ser adaptada a cualquier framework\n */\nexport async function authenticateRequest(\n  request: AuthRequest,\n  config: AuthMiddlewareConfig = {}\n): Promise<{ success: boolean; context?: AuthContext; error?: string; statusCode?: number }> {\n  const {\n    required = true,\n    permissions = [],\n      permissionOptions = {},\n      tokenHeader = 'authorization',\n      extractToken\n    } = config;\n\n    let token: string | null = null;\n    \n    // Use custom token extraction if provided\n    if (extractToken) {\n      token = extractToken(request);\n    } else {\n      // Try multiple token extraction methods\n      token = extractTokenFromRequest(request, tokenHeader, config);\n    }\n    \n    if (!token) {\n      if (!required) {\n        return { success: true, context: { permissions: [], isAuthenticated: false } };\n      }\n      return {\n        success: false,\n        error: extractToken ? 'Token not found' : 'Authentication token required. Provide token via Authorization header (Bearer <token>) or query parameter.',\n        statusCode: 401\n      };\n    }\n\n    // Verificar token\n    const jwtService = config.jwtService || getJWTService();\n    const result = await jwtService.verifyToken(token)\n      .then((payload:any) => ({ success: true, payload }))\n      .catch((error: any) => ({ success: false, error: error.message }));\n    \n    if (!result.success) {\n      if (!required) {\n        return { success: true, context: { permissions: [], isAuthenticated: false } };\n      }\n      return {\n        success: false,\n        error: 'Invalid or expired token',\n        statusCode: 401\n      };\n    }\n    \n    const payload = result.payload;\n\n    // Obtener usuario completo\n    const authService = config.authService || getAuthService();\n    const user = await authService.findUserById(payload.userId, {\n      includeRoles: true,\n      includePermissions: true,\n      activeOnly: true\n    });\n\n    if (!user) {\n      return {\n        success: false,\n        error: 'User not found or inactive',\n        statusCode: 401\n      };\n    }\n\n    // Obtener permisos del usuario\n    const permissionService = config.permissionService || getPermissionService();\n    const userPermissions = await permissionService.getUserPermissions(user.id);\n    const permissionNames = userPermissions.map((p:any) => p.name);\n\n    // Crear contexto de autenticaci√≥n\n    const authContext: AuthContext = {\n      user,\n      token,\n      permissions: permissionNames,\n      isAuthenticated: true\n    };\n\n    // Verificar permisos si se requieren\n    if (permissions.length > 0) {\n      const hasPermissions = await permissionService.userHasPermissions(\n        user.id,\n        permissions,\n        permissionOptions\n      );\n\n      if (!hasPermissions) {\n        return {\n          success: false,\n          error: `Insufficient permissions. Required: ${permissions.join(', ')}`,\n          statusCode: 403\n        };\n      }\n    }\n\n    return { success: true, context: authContext };\n}\n\n/**\n * Middleware para verificar solo permisos (asume que ya est√° autenticado)\n */\nexport async function authorizeRequest(\n  authContext: AuthContext,\n  requiredPermissions: string[],\n  options: PermissionOptions = {}\n): Promise<{ success: boolean; error?: string; statusCode?: number }> {\n  try {\n    if (!authContext.user) {\n      return {\n        success: false,\n        error: 'User not authenticated',\n        statusCode: 401\n      };\n    }\n\n    if (requiredPermissions.length === 0) {\n      return { success: true };\n    }\n\n    const permissionService = getPermissionService();\n    const hasPermissions = await permissionService.userHasPermissions(\n      authContext.user.id,\n      requiredPermissions,\n      options\n    );\n\n    if (!hasPermissions) {\n      return {\n        success: false,\n        error: `Insufficient permissions. Required: ${requiredPermissions.join(', ')}`,\n        statusCode: 403\n      };\n    }\n\n    return { success: true };\n  } catch (error:any) {\n    console.error('Authorization error:', error);\n    return {\n      success: false,\n      error: 'Internal authorization error',\n      statusCode: 500\n    };\n  }\n}\n\n/**\n * Funci√≥n helper para verificar si una ruta debe ser saltada\n */\nexport function shouldSkipAuth(path: string, skipPaths: string[] = []): boolean {\n  return skipPaths.some(skipPath => {\n    // Soporte para wildcards simples\n    if (skipPath.endsWith('*')) {\n      const basePath = skipPath.slice(0, -1);\n      return path.startsWith(basePath);\n    }\n    return path === skipPath;\n  });\n}\n\n/**\n * Funci√≥n helper para extraer informaci√≥n del usuario del contexto\n */\nexport function getCurrentUser(authContext?: AuthContext) {\n  return authContext?.user || null;\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene un rol espec√≠fico\n */\nexport function userHasRole(authContext: AuthContext, roleName: string): boolean {\n  // Check roles in authContext.roles (Role objects or string array)\n  if (authContext.roles) {\n    // Handle both Role objects and string arrays\n    const hasRole = authContext.roles.some(role => \n      typeof role === 'string' ? role === roleName : role.name === roleName\n    );\n    if (hasRole) {\n      return true;\n    }\n  }\n  \n  // Check roles in authContext.user.roles (Role objects)\n  if (authContext.user && authContext.user.roles) {\n    return authContext.user.roles.some(role => role.name === roleName);\n  }\n  \n  return false;\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene alguno de los roles especificados\n */\nexport function userHasAnyRole(authContext: AuthContext, roleNames: string[]): boolean {\n  if (!authContext.user) {\n    return false;\n  }\n  return authContext.user.roles.some(role => roleNames.includes(role.name));\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene todos los roles especificados\n */\nexport function userHasAllRoles(authContext: AuthContext, roleNames: string[]): boolean {\n  if (!authContext.user) {\n    return false;\n  }\n  return roleNames.every(roleName => \n    authContext.user!.roles.some(role => role.name === roleName)\n  );\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene un permiso espec√≠fico\n */\nexport function userHasPermission(authContext: AuthContext, permissionName: string): boolean {\n  if (!authContext.permissions) {\n    return false;\n  }\n  return authContext.permissions.includes(permissionName);\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene alguno de los permisos especificados\n */\nexport function userHasAnyPermission(authContext: AuthContext, permissionNames: string[]): boolean {\n  if (!authContext.permissions) {\n    return false;\n  }\n  return permissionNames.some(permission => authContext.permissions!.includes(permission));\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario tiene todos los permisos especificados\n */\nexport function userHasAllPermissions(authContext: AuthContext, permissionNames: string[]): boolean {\n  if (!authContext.permissions) {\n    return false;\n  }\n  return permissionNames.every(permission => authContext.permissions!.includes(permission));\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario es el propietario de un recurso\n */\nexport function isResourceOwner(authContext: AuthContext, resourceUserId: string): boolean {\n  if (!authContext.user) {\n    return false;\n  }\n  return authContext.user.id === resourceUserId;\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario es admin\n */\nexport function isAdmin(authContext: AuthContext): boolean {\n  return userHasRole(authContext, 'admin') || userHasRole(authContext, 'administrator');\n}\n\n/**\n * Funci√≥n helper para verificar si el usuario es moderador\n */\nexport function isModerator(authContext: AuthContext): boolean {\n  return userHasRole(authContext, 'moderator') || isAdmin(authContext);\n}\n\n/**\n * Funci√≥n helper para crear un contexto de autenticaci√≥n vac√≠o\n */\nexport function createEmptyAuthContext(): AuthContext {\n  return {\n    permissions: [],\n    isAuthenticated: false\n  };\n}\n\n/**\n * Funci√≥n helper para refrescar el token si est√° pr√≥ximo a expirar\n */\nexport async function refreshTokenIfNeeded(authContext: AuthContext): Promise<string | null> {\n  try {\n    if (!authContext.user || !authContext.token) {\n      return null;\n    }\n\n    const jwtService = getJWTService();\n    const newToken = await jwtService.refreshTokenIfNeeded(\n      authContext.token,\n      authContext.user,\n      3600 // 1 hora antes de expirar\n    );\n\n    return newToken !== authContext.token ? newToken : null;\n  } catch (error:any) {\n    console.error('Error refreshing token:', error);\n    return null;\n  }\n}\n\n/**\n * Funci√≥n helper para validar permisos de recursos espec√≠ficos\n */\nexport async function validateResourcePermission(\n  authContext: AuthContext,\n  resource: string,\n  action: string,\n  resourceUserId?: string\n): Promise<{ success: boolean; error?: string }> {\n  try {\n    // Verificar si es el propietario del recurso\n    if (resourceUserId && isResourceOwner(authContext, resourceUserId)) {\n      return { success: true };\n    }\n\n    // Verificar si es admin (puede hacer todo)\n    if (isAdmin(authContext)) {\n      return { success: true };\n    }\n\n    // Verificar permiso espec√≠fico\n    const permissionName = `${resource}.${action}`;\n    if (userHasPermission(authContext, permissionName)) {\n      return { success: true };\n    }\n\n    // Verificar permiso gen√©rico\n    const genericPermission = `${resource}.*`;\n    if (userHasPermission(authContext, genericPermission)) {\n      return { success: true };\n    }\n\n    return {\n      success: false,\n      error: `Insufficient permissions for ${resource}.${action}`\n    };\n  } catch (error:any) {\n    console.error('Error validating resource permission:', error);\n    return {\n      success: false,\n      error: 'Internal error validating permissions'\n    };\n  }\n}\n\n/**\n * Funci√≥n helper para crear respuestas de error estandarizadas\n */\nexport function createAuthErrorResponse(\n  error: string,\n  statusCode: number = 401,\n  type: AuthErrorType = 'INVALID_CREDENTIALS' as AuthErrorType\n) {\n  return {\n    success: false,\n    error: {\n      type,\n      message: error,\n      statusCode,\n      timestamp: new Date().toISOString()\n    }\n  };\n}\n\n/**\n * Funci√≥n helper para logging de eventos de autenticaci√≥n\n */\nexport function logAuthEvent(\n  event: string,\n  userId?: string,\n  metadata?: Record<string, any>\n): void {\n  const logData = {\n    event,\n    userId,\n    timestamp: new Date().toISOString(),\n    metadata\n  };\n  \n  console.log(`üîê Auth Event: ${JSON.stringify(logData)}`);\n}\n\n/**\n * Funci√≥n helper para extraer IP del request (framework agn√≥stico)\n */\nexport function extractClientIP(headers: Record<string, string>): string {\n  return (\n    headers['x-forwarded-for'] ||\n    headers['x-real-ip'] ||\n    headers['x-client-ip'] ||\n    headers['cf-connecting-ip'] ||\n    'unknown'\n  );\n}\n\n/**\n * Funci√≥n helper para extraer User-Agent del request\n */\nexport function extractUserAgent(headers: Record<string, string>): string {\n  return headers['user-agent'] || headers['User-Agent'] || 'Unknown';\n}\n\n/**\n * Funci√≥n helper para extraer token de diferentes fuentes del request\n * @param request Request object\n * @param tokenHeader Header name for token\n * @param config Auth middleware config\n * @returns Token string or null\n */\nfunction extractTokenFromRequest(\n  request: AuthRequest,\n  tokenHeader: string,\n  config: AuthMiddlewareConfig\n): string | null {\n  const jwtService = config.jwtService || getJWTService();\n  \n  // 1. Try to extract from headers (case-insensitive)\n  const authHeader = request.headers[tokenHeader] || \n                    request.headers[tokenHeader.toLowerCase()] ||\n                    request.headers[tokenHeader.toUpperCase()];\n  \n  if (authHeader) {\n    // For authorization header, extract from Bearer format\n    if (tokenHeader.toLowerCase() === 'authorization') {\n      const token = jwtService.extractTokenFromHeader(authHeader);\n      if (token) return token;\n    } else {\n      // For custom headers, use token directly\n      return authHeader;\n    }\n  }\n  \n  // 2. Try to extract from query parameters (useful for GET requests)\n  if (request.query) {\n    const queryToken = request.query.token || request.query.access_token || request.query.auth_token;\n    if (queryToken) {\n      return Array.isArray(queryToken) ? queryToken[0] : queryToken;\n    }\n  }\n  \n  // 3. Try to extract from URL parameters (for WebSocket or other protocols)\n  if (request.url) {\n    try {\n      const url = new URL(request.url, 'http://localhost');\n      const urlToken = url.searchParams.get('token') || \n                      url.searchParams.get('access_token') || \n                      url.searchParams.get('auth_token');\n      if (urlToken) return urlToken;\n    } catch (error) {\n      // Ignore URL parsing errors\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Crea un middleware de autenticaci√≥n para frameworks espec√≠ficos\n */\nexport function createAuthMiddleware(config: AuthMiddlewareConfig = {}) {\n  return async (req: any, res: any, next: any) => {\n    try {\n      // Handle nested config for backward compatibility\n      const finalConfig = {\n        ...config,\n        tokenHeader: config.config?.tokenHeader || config.tokenHeader || 'authorization',\n        userProperty: config.config?.userProperty || config.userProperty || 'user',\n        contextProperty: config.config?.contextProperty || config.contextProperty || 'authContext'\n      };\n\n      const authRequest: AuthRequest = {\n        headers: req.headers || {},\n        url: req.url || '',\n        method: req.method || 'GET',\n        query: req.query\n      };\n\n      const result = await authenticateRequest(authRequest, finalConfig);\n      \n      if (!result.success) {\n        if (config.onError) {\n          const error = new Error(result.error || 'Authentication failed');\n          return config.onError(error, req, res);\n        }\n        return res.status(result.statusCode || 401).json({\n          success: false,\n          error: result.error\n        });\n      }\n\n      // Agregar contexto de autenticaci√≥n al request usando propiedades configurables\n      req[finalConfig.contextProperty] = result.context;\n      req[finalConfig.userProperty] = result.context?.user;\n      \n      // Call success callback if provided\n      if (config.onSuccess && result.context) {\n        config.onSuccess(result.context.user, result.context, req);\n      }\n      \n      next();\n    } catch (error: any) {\n      // Only catch unexpected errors, not authentication errors\n      console.error('Unexpected error in auth middleware:', error);\n      res.status(500).json({\n        success: false,\n        error: 'Internal server error'\n      });\n    }\n  };\n}\n\n/**\n * Crea un middleware de autenticaci√≥n opcional\n */\nexport function createOptionalAuthMiddleware(config: AuthMiddlewareConfig = {}) {\n  return createAuthMiddleware({ ...config, required: false });\n}\n\n/**\n * Crea un middleware de verificaci√≥n de permisos\n */\nexport function createPermissionMiddleware(config: { permissions: string[], permissionService?: any, options?: PermissionOptions }) {\n  return async (req: any, res: any, next: any) => {\n    try {\n      const authContext = req.authContext;\n      if (!authContext) {\n        return res.status(401).json({\n          success: false,\n          error: 'Authentication required'\n        });\n      }\n\n      const result = await authorizeRequest(authContext, config.permissions, config.options || {});\n      \n      if (!result.success) {\n        return res.status(result.statusCode || 403).json({\n          success: false,\n          error: result.error\n        });\n      }\n\n      next();\n    } catch (error: any) {\n      res.status(500).json({\n        success: false,\n        error: 'Internal server error'\n      });\n    }\n  };\n}\n\n/**\n * Crea un middleware de verificaci√≥n de roles\n */\nexport function createRoleMiddleware(config: { roles: string[], requireAll?: boolean, permissionService?: any }) {\n  return async (req: any, res: any, next: any) => {\n    try {\n      const authContext = req.authContext;\n      if (!authContext) {\n        return res.status(401).json({\n          success: false,\n          error: 'Authentication required'\n        });\n      }\n\n      const { roles, requireAll = false } = config;\n      let hasRole: boolean;\n      \n      if (requireAll) {\n        hasRole = roles.every(role => userHasRole(authContext, role));\n      } else {\n        hasRole = roles.some(role => userHasRole(authContext, role));\n      }\n      \n      if (!hasRole) {\n        return res.status(403).json({\n          success: false,\n          error: 'Insufficient permissions'\n        });\n      }\n\n      next();\n    } catch (error: any) {\n      res.status(500).json({\n        success: false,\n        error: 'Internal server error'\n      });\n    }\n  };\n}\n\n/**\n * Crea un middleware de verificaci√≥n de propiedad de recursos\n */\nexport function createOwnershipMiddleware(config: {\n  getResourceOwnerId: (req: any) => number | string | Promise<number | string>;\n  allowAdmin?: boolean;\n  adminRoles?: string[];\n}) {\n  return async (req: any, res: any, next: any) => {\n    try {\n      const authContext = req.authContext;\n      if (!authContext) {\n        return res.status(401).json({\n          success: false,\n          error: 'Authentication required'\n        });\n      }\n\n      // Get the resource owner ID using the provided function\n      const resourceOwnerId = await config.getResourceOwnerId(req);\n      \n      // Check if user is the resource owner\n      const isOwner = authContext.user && authContext.user.id.toString() === resourceOwnerId.toString();\n      \n      // Check if user is admin (if admin access is allowed)\n      let isAdminUser = false;\n      if (config.allowAdmin) {\n        const adminRoles = config.adminRoles || ['admin'];\n        isAdminUser = adminRoles.some(role => userHasRole(authContext, role));\n      }\n      \n      if (!isOwner && !isAdminUser) {\n        return res.status(403).json({\n          success: false,\n          error: 'Access denied'\n        });\n      }\n\n      next();\n    } catch (error: any) {\n      res.status(500).json({\n        success: false,\n        error: 'Internal server error'\n      });\n    }\n  };\n}\n\n/**\n * Crea un middleware de rate limiting (implementaci√≥n b√°sica)\n */\nexport function createRateLimitMiddleware(config: {\n  windowMs: number;\n  maxRequests: number;\n  keyGenerator?: (req: any) => string;\n}) {\n  const { windowMs, maxRequests, keyGenerator } = config;\n  const requests = new Map<string, { count: number; resetTime: number }>();\n\n  return async (req: any, res: any, next: any) => {\n    try {\n      const key = keyGenerator ? keyGenerator(req) : extractClientIP(req.headers);\n      const now = Date.now();\n      \n      const clientData = requests.get(key) || { count: 0, resetTime: now + windowMs };\n      \n      if (now > clientData.resetTime) {\n        clientData.count = 0;\n        clientData.resetTime = now + windowMs;\n      }\n      \n      clientData.count++;\n      requests.set(key, clientData);\n      \n      if (clientData.count > maxRequests) {\n        return res.status(429).json({\n          success: false,\n          error: 'Too many requests'\n        });\n      }\n      \n      next();\n    } catch (error: any) {\n      res.status(500).json({\n        success: false,\n        error: 'Internal server error'\n      });\n    }\n  };\n}",
    "// src/adapters/websocket.ts\n// Type-safe conditional imports for WebSocket\n\n// Define WebSocket-compatible interface\nexport interface WSWebSocket {\n  send(data: string | Buffer): void;\n  close(code?: number, reason?: string): void;\n  on(event: string, listener: (...args: any[]) => void): void;\n  off(event: string, listener: (...args: any[]) => void): void;\n  ping(data?: Buffer): void;\n  readyState: number;\n  CONNECTING: number;\n  OPEN: number;\n  CLOSING: number;\n  CLOSED: number;\n}\n\n// Use our interface as the WebSocket type\ntype WebSocket = WSWebSocket;\nimport { \n  authenticateRequest, \n  AuthMiddlewareConfig, \n  getCurrentUser,\n  createEmptyAuthContext,\n  logAuthEvent,\n  extractClientIP,\n  extractUserAgent\n} from '../middleware/auth';\nimport type { AuthContext, AuthRequest, User } from '../types/auth';\n\n/**\n * Interfaz para WebSocket con autenticaci√≥n\n */\nexport interface AuthenticatedWebSocket extends WSWebSocket {\n  auth?: AuthContext;\n  userId?: string;\n  sessionId?: string;\n  lastActivity?: Date;\n}\n\n/**\n * Configuraci√≥n para el servidor WebSocket con autenticaci√≥n\n */\nexport interface WebSocketAuthConfig extends AuthMiddlewareConfig {\n  heartbeatInterval?: number; // Intervalo de heartbeat en ms\n  sessionTimeout?: number; // Timeout de sesi√≥n en ms\n  maxConnections?: number; // M√°ximo de conexiones por usuario\n}\n\n/**\n * Mapa de conexiones activas por usuario\n */\nconst activeConnections = new Map<string, Set<AuthenticatedWebSocket>>();\nconst connectionsBySession = new Map<string, AuthenticatedWebSocket>();\n\n/**\n * Middleware de autenticaci√≥n para WebSockets\n * @param ws WebSocket connection\n * @param request Request inicial\n * @param config Configuraci√≥n de autenticaci√≥n\n * @returns Promise<boolean> true si la autenticaci√≥n es exitosa\n */\nexport async function authenticateWebSocket(\n  ws: AuthenticatedWebSocket,\n  request: any,\n  config: WebSocketAuthConfig = {}\n): Promise<boolean> {\n  try {\n    // Extraer token de la query string o headers\n    const url = new URL(request.url, 'http://localhost');\n    let token = url.searchParams.get('token');\n    \n    if (!token && request.headers.authorization) {\n      const authHeader = request.headers.authorization;\n      if (authHeader.startsWith('Bearer ')) {\n        token = authHeader.replace('Bearer ', '');\n      }\n    }\n\n    if (!token && config.required !== false) {\n      const errorDetails = getWebSocketAuthErrorDetails('No token provided', 401);\n      ws.close(errorDetails.closeCode, errorDetails.reason);\n      return false;\n    }\n\n    // Convertir request a formato agn√≥stico\n    const authRequest: AuthRequest = {\n      headers: {\n        ...request.headers,\n        ...(token && { authorization: `Bearer ${token}` })\n      }\n    };\n\n    // Ejecutar autenticaci√≥n\n    const result = await authenticateRequest(authRequest, config);\n\n    if (!result.success) {\n      logAuthEvent('websocket.auth.failed', undefined, {\n        ip: extractClientIP(authRequest.headers),\n        userAgent: extractUserAgent(authRequest.headers),\n        error: result.error\n      });\n\n      const errorDetails = getWebSocketAuthErrorDetails(result.error, result.statusCode);\n      ws.close(errorDetails.closeCode, errorDetails.reason);\n      return false;\n    }\n\n    // Establecer contexto de autenticaci√≥n\n    ws.auth = result.context!;\n    ws.userId = result.context?.user?.id;\n    ws.sessionId = generateSessionId();\n    ws.lastActivity = new Date();\n\n    // Verificar l√≠mite de conexiones por usuario\n    if (ws.userId && config.maxConnections) {\n      const userConnections = activeConnections.get(ws.userId) || new Set();\n      if (userConnections.size >= config.maxConnections) {\n        const errorDetails = getWebSocketAuthErrorDetails('Maximum connections exceeded', 429);\n        ws.close(errorDetails.closeCode, errorDetails.reason);\n        return false;\n      }\n    }\n\n    // Registrar conexi√≥n\n    if (ws.userId) {\n      registerConnection(ws);\n      \n      logAuthEvent('websocket.connected', ws.userId, {\n        sessionId: ws.sessionId,\n        ip: extractClientIP(authRequest.headers),\n        userAgent: extractUserAgent(authRequest.headers)\n      });\n    }\n\n    // Configurar heartbeat si est√° habilitado\n    if (config.heartbeatInterval) {\n      setupHeartbeat(ws, config.heartbeatInterval);\n    }\n\n    // Configurar timeout de sesi√≥n\n    if (config.sessionTimeout) {\n      setupSessionTimeout(ws, config.sessionTimeout);\n    }\n\n    return true;\n  } catch (error:any) {\n    console.error('WebSocket authentication error:', error);\n    const errorDetails = getWebSocketAuthErrorDetails('Internal authentication error', 500);\n    ws.close(errorDetails.closeCode, errorDetails.reason);\n    return false;\n  }\n}\n\n/**\n * Middleware para verificar permisos en mensajes WebSocket\n * @param ws WebSocket autenticado\n * @param permissions Permisos requeridos\n * @param requireAll Si se requieren todos los permisos\n * @returns boolean\n */\nexport function checkWebSocketPermissions(\n  ws: AuthenticatedWebSocket,\n  permissions: string[],\n  requireAll: boolean = false\n): boolean {\n  if (!ws.auth?.user) {\n    return false;\n  }\n\n  const userPermissions = ws.auth.user.roles.flatMap(role => role.permissions.map(p => p.name));\n  \n  if (requireAll) {\n    return permissions.every(permission => userPermissions.includes(permission));\n  } else {\n    return permissions.some(permission => userPermissions.includes(permission));\n  }\n}\n\n/**\n * Verificar si el usuario tiene roles espec√≠ficos\n * @param ws WebSocket autenticado\n * @param roles Roles requeridos\n * @returns boolean\n */\nexport function checkWebSocketRoles(\n  ws: AuthenticatedWebSocket,\n  roles: string[]\n): boolean {\n  if (!ws.auth?.user) {\n    return false;\n  }\n\n  const userRoles = ws.auth.user.roles.map(role => role.name);\n  return roles.some(role => userRoles.includes(role));\n}\n\n/**\n * Obtener el usuario actual del WebSocket\n * @param ws WebSocket autenticado\n * @returns Usuario actual o null\n */\nexport function getWebSocketCurrentUser(ws: AuthenticatedWebSocket): User | null {\n  return getCurrentUser(ws.auth);\n}\n\n/**\n * Verificar si el WebSocket est√° autenticado\n * @param ws WebSocket\n * @returns boolean\n */\nexport function isWebSocketAuthenticated(ws: AuthenticatedWebSocket): boolean {\n  return !!ws.auth?.user;\n}\n\n/**\n * Obtener el contexto de autenticaci√≥n del WebSocket\n * @param ws WebSocket\n * @returns Contexto de autenticaci√≥n\n */\nexport function getWebSocketAuthContext(ws: AuthenticatedWebSocket): AuthContext {\n  return ws.auth || createEmptyAuthContext();\n}\n\n/**\n * Enviar mensaje a un usuario espec√≠fico\n * @param userId ID del usuario\n * @param message Mensaje a enviar\n * @param excludeSession Sesi√≥n a excluir (opcional)\n */\nexport function sendToUser(\n  userId: string,\n  message: any,\n  excludeSession?: string\n): void {\n  const userConnections = activeConnections.get(userId);\n  if (!userConnections) return;\n\n  const messageStr = typeof message === 'string' ? message : JSON.stringify(message);\n  \n  userConnections.forEach(ws => {\n    if (excludeSession && ws.sessionId === excludeSession) return;\n    \n    if (ws.readyState === WebSocket.OPEN) {\n      ws.send(messageStr);\n    }\n  });\n}\n\n/**\n * Enviar mensaje a usuarios con permisos espec√≠ficos\n * @param permissions Permisos requeridos\n * @param message Mensaje a enviar\n * @param requireAll Si se requieren todos los permisos\n */\nexport function sendToUsersWithPermissions(\n  permissions: string[],\n  message: any,\n  requireAll: boolean = false\n): void {\n  const messageStr = typeof message === 'string' ? message : JSON.stringify(message);\n  \n  activeConnections.forEach((connections, userId) => {\n    connections.forEach(ws => {\n      if (ws.readyState === WebSocket.OPEN && \n          checkWebSocketPermissions(ws, permissions, requireAll)) {\n        ws.send(messageStr);\n      }\n    });\n  });\n}\n\n/**\n * Enviar mensaje a usuarios con roles espec√≠ficos\n * @param roles Roles requeridos\n * @param message Mensaje a enviar\n */\nexport function sendToUsersWithRoles(\n  roles: string[],\n  message: any\n): void {\n  const messageStr = typeof message === 'string' ? message : JSON.stringify(message);\n  \n  activeConnections.forEach((connections, userId) => {\n    connections.forEach(ws => {\n      if (ws.readyState === WebSocket.OPEN && \n          checkWebSocketRoles(ws, roles)) {\n        ws.send(messageStr);\n      }\n    });\n  });\n}\n\n/**\n * Broadcast a todas las conexiones autenticadas\n * @param message Mensaje a enviar\n * @param excludeUser Usuario a excluir (opcional)\n */\nexport function broadcastToAuthenticated(\n  message: any,\n  excludeUser?: string\n): void {\n  const messageStr = typeof message === 'string' ? message : JSON.stringify(message);\n  \n  activeConnections.forEach((connections, userId) => {\n    if (excludeUser && userId === excludeUser) return;\n    \n    connections.forEach(ws => {\n      if (ws.readyState === WebSocket.OPEN) {\n        ws.send(messageStr);\n      }\n    });\n  });\n}\n\n/**\n * Obtener estad√≠sticas de conexiones\n * @returns Estad√≠sticas de conexiones\n */\nexport function getConnectionStats() {\n  let totalConnections = 0;\n  const userStats: Record<string, number> = {};\n  \n  activeConnections.forEach((connections, userId) => {\n    const activeCount = Array.from(connections).filter(\n      ws => ws.readyState === WebSocket.OPEN\n    ).length;\n    \n    totalConnections += activeCount;\n    userStats[userId] = activeCount;\n  });\n  \n  return {\n    totalConnections,\n    uniqueUsers: activeConnections.size,\n    userStats\n  };\n}\n\n/**\n * Desconectar todas las sesiones de un usuario\n * @param userId ID del usuario\n * @param reason Raz√≥n de la desconexi√≥n\n */\nexport function disconnectUser(userId: string, reason: string = 'User disconnected'): void {\n  const userConnections = activeConnections.get(userId);\n  if (!userConnections) return;\n  \n  userConnections.forEach(ws => {\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.close(1000, reason);\n    }\n  });\n  \n  logAuthEvent('websocket.user_disconnected', userId, { reason });\n}\n\n/**\n * Limpiar conexiones inactivas\n */\nexport function cleanupInactiveConnections(): void {\n  const now = new Date();\n  const inactiveThreshold = 30 * 60 * 1000; // 30 minutos\n  \n  activeConnections.forEach((connections, userId) => {\n    connections.forEach(ws => {\n      if (ws.readyState !== WebSocket.OPEN || \n          (ws.lastActivity && now.getTime() - ws.lastActivity.getTime() > inactiveThreshold)) {\n        unregisterConnection(ws);\n      }\n    });\n  });\n}\n\n/**\n * Registrar una nueva conexi√≥n\n * @param ws WebSocket autenticado\n */\nfunction registerConnection(ws: AuthenticatedWebSocket): void {\n  if (!ws.userId || !ws.sessionId) return;\n  \n  // Agregar a conexiones por usuario\n  if (!activeConnections.has(ws.userId)) {\n    activeConnections.set(ws.userId, new Set());\n  }\n  activeConnections.get(ws.userId)!.add(ws);\n  \n  // Agregar a conexiones por sesi√≥n\n  connectionsBySession.set(ws.sessionId, ws);\n  \n  // Configurar cleanup al cerrar\n  ws.on('close', () => unregisterConnection(ws));\n  ws.on('error', () => unregisterConnection(ws));\n}\n\n/**\n * Desregistrar una conexi√≥n\n * @param ws WebSocket autenticado\n */\nfunction unregisterConnection(ws: AuthenticatedWebSocket): void {\n  if (ws.userId) {\n    const userConnections = activeConnections.get(ws.userId);\n    if (userConnections) {\n      userConnections.delete(ws);\n      if (userConnections.size === 0) {\n        activeConnections.delete(ws.userId);\n      }\n    }\n    \n    logAuthEvent('websocket.disconnected', ws.userId, {\n      sessionId: ws.sessionId\n    });\n  }\n  \n  if (ws.sessionId) {\n    connectionsBySession.delete(ws.sessionId);\n  }\n}\n\n/**\n * Configurar heartbeat para mantener la conexi√≥n viva\n * @param ws WebSocket\n * @param interval Intervalo en milisegundos\n */\nfunction setupHeartbeat(ws: AuthenticatedWebSocket, interval: number): void {\n  const heartbeatTimer = setInterval(() => {\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.ping();\n      ws.lastActivity = new Date();\n    } else {\n      clearInterval(heartbeatTimer);\n    }\n  }, interval);\n  \n  ws.on('pong', () => {\n    ws.lastActivity = new Date();\n  });\n  \n  ws.on('close', () => {\n    clearInterval(heartbeatTimer);\n  });\n}\n\n/**\n * Configurar timeout de sesi√≥n\n * @param ws WebSocket\n * @param timeout Timeout en milisegundos\n */\nfunction setupSessionTimeout(ws: AuthenticatedWebSocket, timeout: number): void {\n  const timeoutTimer = setTimeout(() => {\n    if (ws.readyState === WebSocket.OPEN) {\n      ws.close(1000, 'Session timeout');\n    }\n  }, timeout);\n  \n  ws.on('message', () => {\n    ws.lastActivity = new Date();\n  });\n  \n  ws.on('close', () => {\n    clearTimeout(timeoutTimer);\n  });\n}\n\n/**\n * Generar ID de sesi√≥n √∫nico\n * @returns String √∫nico para la sesi√≥n\n */\nfunction generateSessionId(): string {\n  return `ws_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Middleware para manejar mensajes WebSocket con autenticaci√≥n\n * @param ws WebSocket autenticado\n * @param message Mensaje recibido\n * @param permissions Permisos requeridos para procesar el mensaje\n * @returns boolean true si el mensaje puede ser procesado\n */\nexport function handleAuthenticatedMessage(\n  ws: AuthenticatedWebSocket,\n  message: any,\n  permissions?: string[]\n): boolean {\n  // Actualizar √∫ltima actividad\n  ws.lastActivity = new Date();\n  \n  // Verificar autenticaci√≥n\n  if (!isWebSocketAuthenticated(ws)) {\n    ws.send(JSON.stringify(createWebSocketAuthErrorResponse('Authentication required', 401)));\n    return false;\n  }\n  \n  // Verificar permisos si se especifican\n  if (permissions && !checkWebSocketPermissions(ws, permissions)) {\n    ws.send(JSON.stringify(createWebSocketAuthErrorResponse('Insufficient permissions', 403, {\n      requiredPermissions: permissions\n    })));\n    \n    logAuthEvent('websocket.insufficient_permissions', ws.userId, {\n      requiredPermissions: permissions,\n      sessionId: ws.sessionId\n    });\n    \n    return false;\n  }\n  \n  return true;\n}\n\n/**\n * Crear respuesta estandarizada para WebSocket\n * @param type Tipo de respuesta\n * @param data Datos de respuesta\n * @param message Mensaje opcional\n * @returns Objeto de respuesta\n */\nexport function createWebSocketResponse(\n  type: 'success' | 'error' | 'info',\n  data?: any,\n  message?: string\n) {\n  return {\n    type,\n    data,\n    message,\n    timestamp: new Date().toISOString()\n  };\n}\n\n/**\n * Crear respuesta de error de autenticaci√≥n espec√≠fica para WebSocket\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @param additionalData Datos adicionales\n * @returns Objeto de respuesta de error\n */\nexport function createWebSocketAuthErrorResponse(\n  error: string = 'Authentication failed',\n  statusCode: number = 401,\n  additionalData?: any\n) {\n  const errorResponse: any = {\n    type: 'auth_error',\n    success: false,\n    error: getDetailedWebSocketAuthError(error, statusCode),\n    code: getWebSocketAuthErrorCode(error, statusCode),\n    statusCode,\n    timestamp: new Date().toISOString()\n  };\n\n  if (additionalData) {\n    Object.assign(errorResponse, additionalData);\n  }\n\n  return errorResponse;\n}\n\n/**\n * Obtener detalles de error para cierre de conexi√≥n WebSocket\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @returns Detalles del error con c√≥digo de cierre y raz√≥n\n */\nexport function getWebSocketAuthErrorDetails(\n  error: string = 'Authentication failed',\n  statusCode?: number\n): { closeCode: number; reason: string } {\n  const detailedError = getDetailedWebSocketAuthError(error, statusCode || 401);\n  \n  // Mapear c√≥digos de estado HTTP a c√≥digos de cierre WebSocket\n  let closeCode: number;\n  switch (statusCode) {\n    case 400:\n      closeCode = 1002; // Protocol error\n      break;\n    case 401:\n      closeCode = 1008; // Policy violation (unauthorized)\n      break;\n    case 403:\n      closeCode = 1008; // Policy violation (forbidden)\n      break;\n    case 429:\n      closeCode = 1008; // Policy violation (rate limited)\n      break;\n    case 500:\n      closeCode = 1011; // Internal error\n      break;\n    default:\n      closeCode = 1008; // Policy violation (general auth error)\n  }\n\n  return {\n    closeCode,\n    reason: detailedError.length > 123 ? detailedError.substring(0, 120) + '...' : detailedError\n  };\n}\n\n/**\n * Obtener mensaje de error detallado para WebSocket\n * @param error Mensaje de error original\n * @param statusCode C√≥digo de estado HTTP\n * @returns Mensaje de error detallado\n */\nfunction getDetailedWebSocketAuthError(error: string, statusCode: number): string {\n  // Mapear errores comunes a mensajes m√°s descriptivos\n  const errorMappings: Record<string, string> = {\n    'Invalid token': 'The provided authentication token is invalid or malformed. Please reconnect with a valid token.',\n    'Token expired': 'Your authentication token has expired. Please reconnect with a new token.',\n    'No token provided': 'Authentication token is required. Please provide a valid token in the connection URL or headers.',\n    'Insufficient permissions': 'You do not have the required permissions for this WebSocket operation.',\n    'User not found': 'The user associated with this token could not be found or has been deactivated.',\n    'Token revoked': 'This authentication token has been revoked. Please obtain a new token and reconnect.',\n    'Invalid signature': 'The token signature is invalid. This may indicate a compromised or tampered token.',\n    'Malformed token': 'The authentication token format is incorrect. Please ensure you are using a valid JWT token.',\n    'Authentication required': 'This WebSocket connection requires authentication. Please provide a valid token.',\n    'Session expired': 'Your session has expired. Please reconnect with a new authentication token.',\n    'Account locked': 'Your account has been temporarily locked. Please contact support.',\n    'Invalid credentials': 'The provided credentials are incorrect.',\n    'Maximum connections exceeded': 'You have reached the maximum number of allowed concurrent connections.',\n    'Internal authentication error': 'An internal error occurred during authentication. Please try reconnecting.'\n  };\n\n  // Buscar coincidencia exacta primero\n  if (errorMappings[error]) {\n    return errorMappings[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorMappings)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // Mensajes por c√≥digo de estado si no hay coincidencia espec√≠fica\n  switch (statusCode) {\n    case 401:\n      return error.includes('token') \n        ? 'WebSocket authentication failed: Invalid or missing token. Please provide a valid token and reconnect.'\n        : 'WebSocket authentication required. Please provide valid credentials and reconnect.';\n    case 403:\n      return 'WebSocket access forbidden: You do not have sufficient permissions for this connection.';\n    case 429:\n      return 'WebSocket rate limit exceeded: Too many connection attempts. Please wait before reconnecting.';\n    case 500:\n      return 'WebSocket internal error: An unexpected error occurred. Please try reconnecting.';\n    default:\n      return error || 'WebSocket authentication error occurred.';\n  }\n}\n\n/**\n * Obtener c√≥digo de error espec√≠fico para WebSocket\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @returns C√≥digo de error para APIs\n */\nfunction getWebSocketAuthErrorCode(error: string, statusCode: number): string {\n  const errorCodes: Record<string, string> = {\n    'Invalid token': 'WS_AUTH_INVALID_TOKEN',\n    'Token expired': 'WS_AUTH_TOKEN_EXPIRED',\n    'No token provided': 'WS_AUTH_TOKEN_MISSING',\n    'Insufficient permissions': 'WS_AUTH_INSUFFICIENT_PERMISSIONS',\n    'User not found': 'WS_AUTH_USER_NOT_FOUND',\n    'Token revoked': 'WS_AUTH_TOKEN_REVOKED',\n    'Invalid signature': 'WS_AUTH_INVALID_SIGNATURE',\n    'Malformed token': 'WS_AUTH_MALFORMED_TOKEN',\n    'Authentication required': 'WS_AUTH_REQUIRED',\n    'Session expired': 'WS_AUTH_SESSION_EXPIRED',\n    'Account locked': 'WS_AUTH_ACCOUNT_LOCKED',\n    'Invalid credentials': 'WS_AUTH_INVALID_CREDENTIALS',\n    'Maximum connections exceeded': 'WS_AUTH_MAX_CONNECTIONS',\n    'Internal authentication error': 'WS_AUTH_INTERNAL_ERROR'\n  };\n\n  // Buscar coincidencia exacta\n  if (errorCodes[error]) {\n    return errorCodes[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorCodes)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // C√≥digos por estado HTTP\n  switch (statusCode) {\n    case 401:\n      return 'WS_AUTH_UNAUTHORIZED';\n    case 403:\n      return 'WS_AUTH_FORBIDDEN';\n    case 429:\n      return 'WS_AUTH_RATE_LIMITED';\n    case 500:\n      return 'WS_AUTH_INTERNAL_ERROR';\n    default:\n      return 'WS_AUTH_ERROR';\n  }\n}\n\n/**\n * Inicializar limpieza autom√°tica de conexiones\n * @param interval Intervalo de limpieza en milisegundos\n */\nexport function initializeConnectionCleanup(interval: number = 5 * 60 * 1000): void {\n  setInterval(() => {\n    cleanupInactiveConnections();\n  }, interval);\n}",
    "// src/db/migrations.ts\nimport { getDatabase } from './connection';\nimport type { Database } from 'bun:sqlite';\n\n/**\n * Interface para definir una migraci√≥n\n */\nexport interface Migration {\n  version: number;\n  name: string;\n  up: (db: Database) => Promise<void>;\n  down: (db: Database) => Promise<void>;\n}\n\n/**\n * Lista de todas las migraciones en orden\n */\nconst migrations: Migration[] = [\n  {\n    version: 1,\n    name: 'create_users_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS users (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          email TEXT UNIQUE NOT NULL,\n          password_hash TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          is_active BOOLEAN DEFAULT 1\n        )\n      `);\n      \n      // √çndices para optimizar consultas\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_active ON users(is_active)\");\n      \n      console.log('‚úÖ Tabla users creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS users\");\n      console.log('‚úÖ Tabla users eliminada');\n    }\n  },\n  \n  {\n    version: 2,\n    name: 'create_roles_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS roles (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          name TEXT UNIQUE NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        )\n      `);\n      \n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_roles_name ON roles(name)\");\n      \n      console.log('‚úÖ Tabla roles creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS roles\");\n      console.log('‚úÖ Tabla roles eliminada');\n    }\n  },\n  \n  {\n    version: 3,\n    name: 'create_permissions_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS permissions (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          name TEXT UNIQUE NOT NULL,\n          resource TEXT NOT NULL,\n          action TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        )\n      `);\n      \n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_permissions_name ON permissions(name)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_permissions_resource ON permissions(resource)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_permissions_action ON permissions(action)\");\n      \n      console.log('‚úÖ Tabla permissions creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS permissions\");\n      console.log('‚úÖ Tabla permissions eliminada');\n    }\n  },\n  \n  {\n    version: 4,\n    name: 'create_user_roles_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS user_roles (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          user_id TEXT NOT NULL,\n          role_id TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n          FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n          UNIQUE(user_id, role_id)\n        )\n      `);\n      \n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_user_roles_user_id ON user_roles(user_id)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_user_roles_role_id ON user_roles(role_id)\");\n      \n      console.log('‚úÖ Tabla user_roles creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS user_roles\");\n      console.log('‚úÖ Tabla user_roles eliminada');\n    }\n  },\n  \n  {\n    version: 5,\n    name: 'create_role_permissions_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS role_permissions (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          role_id TEXT NOT NULL,\n          permission_id TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n          FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,\n          UNIQUE(role_id, permission_id)\n        )\n      `);\n      \n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_role_permissions_role_id ON role_permissions(role_id)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_role_permissions_permission_id ON role_permissions(permission_id)\");\n      \n      console.log('‚úÖ Tabla role_permissions creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS role_permissions\");\n      console.log('‚úÖ Tabla role_permissions eliminada');\n    }\n  },\n  \n  {\n    version: 6,\n    name: 'create_sessions_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS sessions (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          user_id TEXT NOT NULL,\n          token TEXT UNIQUE NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          expires_at DATETIME NOT NULL,\n          last_activity DATETIME DEFAULT CURRENT_TIMESTAMP,\n          ip_address TEXT,\n          user_agent TEXT,\n          is_active BOOLEAN DEFAULT 1,\n          FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE\n        )\n      `);\n      \n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_sessions_user_id ON sessions(user_id)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_sessions_token ON sessions(token)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_sessions_expires_at ON sessions(expires_at)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_sessions_active ON sessions(is_active)\");\n      \n      console.log('‚úÖ Tabla sessions creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS sessions\");\n      console.log('‚úÖ Tabla sessions eliminada');\n    }\n  },\n  \n  {\n    version: 7,\n    name: 'create_migration_history_table',\n    up: async (db: Database) => {\n      db.exec(`\n        CREATE TABLE IF NOT EXISTS migration_history (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          version INTEGER UNIQUE NOT NULL,\n          name TEXT NOT NULL,\n          executed_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        )\n      `);\n      \n      console.log('‚úÖ Tabla migration_history creada');\n    },\n    down: async (db: Database) => {\n      db.exec(\"DROP TABLE IF EXISTS migration_history\");\n      console.log('‚úÖ Tabla migration_history eliminada');\n    }\n  },\n  \n  {\n    version: 8,\n    name: 'add_description_fields',\n    up: async (db: Database) => {\n      // Agregar campo description a la tabla roles\n      db.exec(`\n        ALTER TABLE roles ADD COLUMN description TEXT\n      `);\n      \n      // Agregar campo description a la tabla permissions\n      db.exec(`\n        ALTER TABLE permissions ADD COLUMN description TEXT\n      `);\n      \n      console.log('‚úÖ Campos description agregados a roles y permissions');\n    },\n    down: async (db: Database) => {\n      // SQLite no soporta DROP COLUMN, necesitamos recrear las tablas\n      db.exec(`\n        CREATE TABLE roles_backup AS SELECT id, name, created_at FROM roles;\n        DROP TABLE roles;\n        CREATE TABLE roles (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          name TEXT UNIQUE NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        );\n        INSERT INTO roles SELECT * FROM roles_backup;\n        DROP TABLE roles_backup;\n      `);\n      \n      db.exec(`\n        CREATE TABLE permissions_backup AS SELECT id, name, resource, action, created_at FROM permissions;\n        DROP TABLE permissions;\n        CREATE TABLE permissions (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          name TEXT UNIQUE NOT NULL,\n          resource TEXT NOT NULL,\n          action TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        );\n        INSERT INTO permissions SELECT * FROM permissions_backup;\n        DROP TABLE permissions_backup;\n      `);\n      \n      console.log('‚úÖ Campos description removidos de roles y permissions');\n    }\n  },\n\n  {\n    version: 9,\n    name: 'add_user_name_fields',\n    up: async (db: Database) => {\n      // Agregar campos firstName y lastName a la tabla users\n      db.exec(`\n        ALTER TABLE users ADD COLUMN first_name TEXT\n      `);\n      \n      db.exec(`\n        ALTER TABLE users ADD COLUMN last_name TEXT\n      `);\n      \n      console.log('‚úÖ Campos first_name y last_name agregados a users');\n    },\n    down: async (db: Database) => {\n      // SQLite no soporta DROP COLUMN, necesitamos recrear la tabla\n      db.exec(`\n        CREATE TABLE users_backup AS SELECT id, email, password_hash, created_at, updated_at, is_active FROM users;\n        DROP TABLE users;\n        CREATE TABLE users (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          email TEXT UNIQUE NOT NULL,\n          password_hash TEXT NOT NULL,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          is_active BOOLEAN DEFAULT 1\n        );\n        INSERT INTO users SELECT * FROM users_backup;\n        DROP TABLE users_backup;\n      `);\n      \n      // Recrear √≠ndices\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_active ON users(is_active)\");\n      \n      console.log('‚úÖ Campos first_name y last_name removidos de users');\n    }\n  },\n\n  {\n    version: 10,\n    name: 'add_last_login_at_field',\n    up: async (db: Database) => {\n      // Agregar campo last_login_at a la tabla users\n      db.exec(`\n        ALTER TABLE users ADD COLUMN last_login_at DATETIME\n      `);\n      \n      console.log('‚úÖ Campo last_login_at agregado a users');\n    },\n    down: async (db: Database) => {\n      // SQLite no soporta DROP COLUMN, necesitamos recrear la tabla\n      db.exec(`\n        CREATE TABLE users_backup AS SELECT id, email, password_hash, first_name, last_name, created_at, updated_at, is_active FROM users;\n        DROP TABLE users;\n        CREATE TABLE users (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          email TEXT UNIQUE NOT NULL,\n          password_hash TEXT NOT NULL,\n          first_name TEXT,\n          last_name TEXT,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n          is_active BOOLEAN DEFAULT 1\n        );\n        INSERT INTO users SELECT * FROM users_backup;\n        DROP TABLE users_backup;\n      `);\n      \n      // Recrear √≠ndices\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)\");\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_users_active ON users(is_active)\");\n      \n      console.log('‚úÖ Campo last_login_at removido de users');\n    }\n  },\n\n  {\n    version: 11,\n    name: 'add_roles_is_active_field',\n    up: async (db: Database) => {\n      // Agregar campo is_active a la tabla roles\n      db.exec(`\n        ALTER TABLE roles ADD COLUMN is_active BOOLEAN DEFAULT 1\n      `);\n      \n      console.log('‚úÖ Campo is_active agregado a roles');\n    },\n    down: async (db: Database) => {\n      // SQLite no soporta DROP COLUMN, necesitamos recrear la tabla\n      db.exec(`\n        CREATE TABLE roles_backup AS SELECT id, name, description, created_at FROM roles;\n        DROP TABLE roles;\n        CREATE TABLE roles (\n          id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n          name TEXT UNIQUE NOT NULL,\n          description TEXT,\n          created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n        );\n        INSERT INTO roles SELECT * FROM roles_backup;\n        DROP TABLE roles_backup;\n      `);\n      \n      // Recrear √≠ndices\n      db.exec(\"CREATE INDEX IF NOT EXISTS idx_roles_name ON roles(name)\");\n      \n      console.log('‚úÖ Campo is_active removido de roles');\n    }\n  }\n];\n\n/**\n * Obtiene la versi√≥n actual de la base de datos\n */\nasync function getCurrentVersion(): Promise<number> {\n  try {\n    const db = getDatabase();\n    const result = db.query(\n      \"SELECT MAX(version) as version FROM migration_history\"\n    ).get() as { version: number } | undefined;\n    return result?.version || 0;\n  } catch (error:any) {\n    // Si la tabla no existe, estamos en versi√≥n 0\n    return 0;\n  }\n}\n\n/**\n * Registra una migraci√≥n ejecutada\n */\nasync function recordMigration(version: number, name: string): Promise<void> {\n  const db = getDatabase();\n  db.query(\n    \"INSERT INTO migration_history (version, name) VALUES (?, ?)\"\n  ).run(version, name);\n}\n\n/**\n * Ejecuta todas las migraciones pendientes\n */\nexport async function runMigrations(): Promise<void> {\n  console.log('üîÑ Iniciando migraciones...');\n  \n  const db = getDatabase();\n  \n  // Crear tabla migration_history si no existe\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS migration_history (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      version INTEGER UNIQUE NOT NULL,\n      name TEXT NOT NULL,\n      executed_at DATETIME DEFAULT CURRENT_TIMESTAMP\n    )\n  `);\n  \n  const currentVersion = await getCurrentVersion();\n  \n  console.log(`üìä Versi√≥n actual de la base de datos: ${currentVersion}`);\n  \n  // Filtrar migraciones pendientes\n  const pendingMigrations = migrations.filter(m => m.version > currentVersion);\n  \n  if (pendingMigrations.length === 0) {\n    console.log('‚úÖ No hay migraciones pendientes');\n    return;\n  }\n  \n  console.log(`üìã ${pendingMigrations.length} migraciones pendientes`);\n  \n  // Ejecutar migraciones en transacci√≥n\n  try {\n    db.exec(\"BEGIN TRANSACTION\");\n    \n    for (const migration of pendingMigrations) {\n      console.log(`‚ö° Ejecutando migraci√≥n ${migration.version}: ${migration.name}`);\n      \n      await migration.up(db);\n      \n      // Solo registrar la migraci√≥n si no es la de migration_history\n      if (migration.name !== 'create_migration_history_table') {\n        await recordMigration(migration.version, migration.name);\n      }\n      \n      console.log(`‚úÖ Migraci√≥n ${migration.version} completada`);\n    }\n    \n    db.exec(\"COMMIT\");\n    console.log('üéâ Todas las migraciones completadas exitosamente');\n    \n  } catch (error:any) {\n    db.exec(\"ROLLBACK\");\n    console.error('‚ùå Error durante las migraciones:', error);\n    throw error;\n  }\n}\n\n/**\n * Revierte migraciones hasta una versi√≥n espec√≠fica\n */\nexport async function rollbackMigrations(targetVersion: number): Promise<void> {\n  console.log(`üîÑ Revirtiendo migraciones hasta la versi√≥n ${targetVersion}...`);\n  \n  const db = getDatabase();\n  const currentVersion = await getCurrentVersion();\n  \n  if (targetVersion >= currentVersion) {\n    console.log('‚úÖ No hay migraciones para revertir');\n    return;\n  }\n  \n  // Filtrar migraciones a revertir (en orden descendente)\n  const migrationsToRollback = migrations\n    .filter(m => m.version > targetVersion && m.version <= currentVersion)\n    .sort((a, b) => b.version - a.version);\n  \n  console.log(`üìã ${migrationsToRollback.length} migraciones a revertir`);\n  \n  try {\n    db.exec(\"BEGIN TRANSACTION\");\n    \n    for (const migration of migrationsToRollback) {\n      console.log(`‚ö° Revirtiendo migraci√≥n ${migration.version}: ${migration.name}`);\n      \n      await migration.down(db);\n      db.query(\"DELETE FROM migration_history WHERE version = ?\").run(migration.version);\n      \n      console.log(`‚úÖ Migraci√≥n ${migration.version} revertida`);\n    }\n    \n    db.exec(\"COMMIT\");\n    console.log('üéâ Rollback completado exitosamente');\n    \n  } catch (error:any) {\n    db.exec(\"ROLLBACK\");\n    console.error('‚ùå Error durante el rollback:', error);\n    throw error;\n  }\n}\n\n/**\n * Obtiene el estado de las migraciones\n */\nexport async function getMigrationStatus(): Promise<{\n  currentVersion: number;\n  availableVersion: number;\n  pendingMigrations: number;\n  executedMigrations: Migration[];\n}> {\n  const currentVersion = await getCurrentVersion();\n  const availableVersion = Math.max(...migrations.map(m => m.version));\n  const pendingMigrations = migrations.filter(m => m.version > currentVersion).length;\n  const executedMigrations = migrations.filter(m => m.version <= currentVersion);\n  \n  return {\n    currentVersion,\n    availableVersion,\n    pendingMigrations,\n    executedMigrations\n  };\n}\n\n/**\n * Resetea completamente la base de datos\n */\nexport async function resetDatabase(): Promise<void> {\n  console.log('üîÑ Reseteando base de datos...');\n  \n  const db = getDatabase();\n  \n  try {\n    db.exec(\"BEGIN TRANSACTION\");\n    \n    // Revertir todas las migraciones\n    const allMigrations = [...migrations].reverse();\n    for (const migration of allMigrations) {\n      try {\n        await migration.down(db);\n      } catch (error:any) {\n        // Ignorar errores si la tabla no existe\n        console.warn(`‚ö†Ô∏è Error al revertir ${migration.name}:`, error);\n      }\n    }\n    \n    // Limpiar historial de migraciones\n    db.exec(\"DROP TABLE IF EXISTS migration_history\");\n    \n    db.exec(\"COMMIT\");\n    console.log('‚úÖ Base de datos reseteada');\n    \n    // Ejecutar migraciones nuevamente\n    await runMigrations();\n    \n  } catch (error:any) {\n    db.exec(\"ROLLBACK\");\n    console.error('‚ùå Error al resetear la base de datos:', error);\n    throw error;\n  }\n}",
    "// src/scripts/seed.ts\n// Example usage:\n// const customUsers = generateInitialUsers({\n//   includeAdmin: true,\n//   includeUser: false,\n//   customUsers: [\n//     {\n//       email: 'custom@example.com',\n//       password: 'Custom123!',\n//       firstName: 'Custom',\n//       lastName: 'User',\n//       roles: ['editor']\n//     }\n//   ]\n// });\n\nimport { getDatabase, isDatabaseInitialized, initDatabase, forceReinitDatabase } from '../db/connection';\nimport { runMigrations } from '../db/migrations';\nimport { AuthService } from '../services/auth';\nimport { PermissionService } from '../services/permissions';\nimport type { CreatePermissionData, CreateRoleData } from '../types/auth';\n\n/**\n * Datos iniciales para permisos\n */\nconst initialPermissions: CreatePermissionData[] = [\n  // Permisos de usuarios\n  { name: 'users.read', resource: 'users', action: 'read' },\n  { name: 'users.create', resource: 'users', action: 'create' },\n  { name: 'users.update', resource: 'users', action: 'update' },\n  { name: 'users.delete', resource: 'users', action: 'delete' },\n  { name: 'users.manage', resource: 'users', action: 'manage' },\n  \n  // Permisos de roles\n  { name: 'roles.read', resource: 'roles', action: 'read' },\n  { name: 'roles.create', resource: 'roles', action: 'create' },\n  { name: 'roles.update', resource: 'roles', action: 'update' },\n  { name: 'roles.delete', resource: 'roles', action: 'delete' },\n  { name: 'roles.manage', resource: 'roles', action: 'manage' },\n  \n  // Permisos de permisos\n  { name: 'permissions.read', resource: 'permissions', action: 'read' },\n  { name: 'permissions.create', resource: 'permissions', action: 'create' },\n  { name: 'permissions.update', resource: 'permissions', action: 'update' },\n  { name: 'permissions.delete', resource: 'permissions', action: 'delete' },\n  { name: 'permissions.manage', resource: 'permissions', action: 'manage' },\n  \n  // Permisos de contenido\n  { name: 'content.read', resource: 'content', action: 'read' },\n  { name: 'content.create', resource: 'content', action: 'create' },\n  { name: 'content.update', resource: 'content', action: 'update' },\n  { name: 'content.delete', resource: 'content', action: 'delete' },\n  { name: 'content.publish', resource: 'content', action: 'publish' },\n  { name: 'content.moderate', resource: 'content', action: 'moderate' },\n  \n  // Permisos de sistema\n  { name: 'system.admin', resource: 'system', action: 'admin' },\n  { name: 'system.settings', resource: 'system', action: 'settings' },\n  { name: 'system.logs', resource: 'system', action: 'logs' },\n  { name: 'system.backup', resource: 'system', action: 'backup' },\n  { name: 'system.maintenance', resource: 'system', action: 'maintenance' },\n  \n  // Permisos de reportes\n  { name: 'reports.view', resource: 'reports', action: 'view' },\n  { name: 'reports.create', resource: 'reports', action: 'create' },\n  { name: 'reports.export', resource: 'reports', action: 'export' },\n  \n  // Permisos de API\n  { name: 'api.read', resource: 'api', action: 'read' },\n  { name: 'api.write', resource: 'api', action: 'write' },\n  { name: 'api.admin', resource: 'api', action: 'admin' }\n];\n\n/**\n * Datos iniciales para roles\n */\nconst initialRoles: CreateRoleData[] = [\n  {\n    name: 'admin',\n    description: 'Administrador del sistema con acceso completo',\n    permissions: [\n      'users.manage', 'roles.manage', 'permissions.manage',\n      'content.read', 'content.create', 'content.update', 'content.delete', 'content.publish', 'content.moderate',\n      'system.admin', 'system.settings', 'system.logs', 'system.backup', 'system.maintenance',\n      'reports.view', 'reports.create', 'reports.export',\n      'api.admin'\n    ]\n  },\n  {\n    name: 'moderator',\n    description: 'Moderador con permisos de gesti√≥n de contenido',\n    permissions: [\n      'users.read', 'users.update',\n      'content.read', 'content.create', 'content.update', 'content.delete', 'content.moderate',\n      'reports.view',\n      'api.read', 'api.write'\n    ]\n  },\n  {\n    name: 'editor',\n    description: 'Editor con permisos de creaci√≥n y edici√≥n de contenido',\n    permissions: [\n      'content.read', 'content.create', 'content.update', 'content.publish',\n      'api.read', 'api.write'\n    ]\n  },\n  {\n    name: 'author',\n    description: 'Autor con permisos b√°sicos de creaci√≥n de contenido',\n    permissions: [\n      'content.read', 'content.create', 'content.update',\n      'api.read'\n    ]\n  },\n  {\n    name: 'user',\n    description: 'Usuario b√°sico con permisos de lectura',\n    permissions: [\n      'content.read',\n      'api.read'\n    ]\n  },\n  {\n    name: 'guest',\n    description: 'Invitado con acceso muy limitado',\n    permissions: [\n      'content.read'\n    ]\n  }\n];\n\n/**\n * Configuraci√≥n de seeding personalizable\n */\ninterface SeedConfig {\n  createTestUsers: boolean;\n  createDemoContent: boolean;\n  userCount: number;\n  skipExistingUsers: boolean;\n  defaultPassword: string;\n}\n\nconst seedConfig: SeedConfig = {\n  createTestUsers: process.env.NODE_ENV === 'development',\n  createDemoContent: true,\n  userCount: process.env.SEED_USER_COUNT ? parseInt(process.env.SEED_USER_COUNT) : 15,\n  skipExistingUsers: true,\n  defaultPassword: process.env.DEFAULT_SEED_PASSWORD || 'DevPassword123!'\n};\n\n/**\n * Generate initial users with customizable options\n */\nfunction generateInitialUsers(options: {\n  includeAdmin?: boolean;\n  includeModerator?: boolean;\n  includeEditor?: boolean;\n  includeAuthor?: boolean;\n  includeUser?: boolean;\n  includeGuest?: boolean;\n  customUsers?: Array<{\n    email: string;\n    password: string;\n    firstName: string;\n    lastName: string;\n    roles: string[];\n  }>;\n} = {}) {\n  const {\n    includeAdmin = true,\n    includeModerator = true,\n    includeEditor = true,\n    includeAuthor = true,\n    includeUser = true,\n    includeGuest = true,\n    customUsers = []\n  } = options;\n\n  const users = [];\n\n  if (includeAdmin) {\n    users.push({\n      email: 'admin@blogapi.com',\n      password: 'Admin123!@#',\n      firstName: 'Admin',\n      lastName: 'User',\n      roles: ['admin']\n    });\n  }\n\n  if (includeModerator) {\n    users.push({\n      email: 'moderator@blogapi.com',\n      password: 'Moderator123!',\n      firstName: 'Moderator',\n      lastName: 'User',\n      roles: ['moderator']\n    });\n  }\n\n  if (includeEditor) {\n    users.push({\n      email: 'editor@blogapi.com',\n      password: 'Editor123!',\n      firstName: 'Editor',\n      lastName: 'User',\n      roles: ['editor']\n    });\n  }\n\n  if (includeAuthor) {\n    users.push({\n      email: 'author@blogapi.com',\n      password: 'Author123!',\n      firstName: 'Author',\n      lastName: 'User',\n      roles: ['author']\n    });\n  }\n\n  if (includeUser) {\n    users.push({\n      email: 'user@blogapi.com',\n      password: 'User123!',\n      firstName: 'Regular',\n      lastName: 'User',\n      roles: ['user']\n    });\n  }\n\n  if (includeGuest) {\n    users.push({\n      email: 'guest@blogapi.com',\n      password: 'Guest123!',\n      firstName: 'Guest',\n      lastName: 'User',\n      roles: ['guest']\n    });\n  }\n\n  // Add custom users\n  users.push(...customUsers);\n\n  return users;\n}\n\n/**\n * Default initial users\n */\nconst initialUsers = generateInitialUsers();\n\n/**\n * Genera usuarios adicionales para testing\n */\nfunction generateTestUsers(count: number): typeof initialUsers {\n  const testUsers = [];\n  const firstNames = ['Alice', 'Bob', 'Charlie', 'Diana', 'Eve', 'Frank', 'Grace', 'Henry', 'Ivy', 'Jack'];\n  const lastNames = ['Adams', 'Baker', 'Clark', 'Davis', 'Evans', 'Fisher', 'Green', 'Harris', 'Jones', 'King'];\n  const roles = ['user', 'author', 'editor'];\n  \n  for (let i = 0; i < count; i++) {\n    const firstName = firstNames[i % firstNames.length];\n    const lastName = lastNames[Math.floor(i / firstNames.length) % lastNames.length];\n    const role = roles[i % roles.length];\n    \n    testUsers.push({\n      email: `test.user${i + 1}@blogapi.com`,\n      password: seedConfig.defaultPassword,\n      firstName,\n      lastName,\n      roles: [role]\n    });\n  }\n  \n  return testUsers;\n}\n\n/**\n * Obtiene la lista completa de usuarios seg√∫n la configuraci√≥n\n */\nfunction getAllUsers(): typeof initialUsers {\n  let allUsers = [...initialUsers];\n  \n  if (seedConfig.createTestUsers && process.env.NODE_ENV === 'development') {\n    const testUsers = generateTestUsers(seedConfig.userCount - initialUsers.length);\n    allUsers = [...allUsers, ...testUsers];\n  }\n  \n  return allUsers;\n}\n\n/**\n * Funci√≥n principal de seeding\n */\nexport async function seedDatabase(dbPath?: string,\n  allUsers = getAllUsers()\n): Promise<void> {\n  try {\n    console.log('üå± Starting database seeding...');\n    \n    // Initialize database and run migrations\n    initDatabase(dbPath);\n    await runMigrations();\n    \n    const permissionService = new PermissionService();\n    const authService = new AuthService();\n    \n    // Create permissions\n    const createdPermissions = new Map<string, string>();\n    for (const permission of initialPermissions) {\n      try {\n        const result = await permissionService.createPermission(permission);\n        if (result && result.role) {\n          createdPermissions.set(permission.name, result.role.id);\n        }\n      } catch (error:any) {\n        // Permission already exists\n      }\n    }\n    \n    // Create roles\n    const createdRoles = new Map<string, string>();\n    for (const role of initialRoles) {\n      try {\n        const result = await permissionService.createRole({\n          name: role.name,\n          description: role.description\n        });\n        \n        if (result && result.role) {\n          createdRoles.set(role.name, result.role?.id);\n          \n          // Assign permissions to role\n          for (const permissionName of role.permissions || []) {\n            const permissionId = createdPermissions.get(permissionName);\n            if (permissionId) {\n              await permissionService.assignPermissionsToRole(result.role?.id, [permissionId]);\n            }\n          }\n        }\n      } catch (error:any) {\n        // Role already exists\n      }\n    }\n        \n    // Create users\n    let createdCount = 0;\n    let skippedCount = 0;\n    \n    for (const user of allUsers) {\n      try {\n        const result = await authService.register({\n          email: user.email,\n          password: user.password,\n        });\n        \n        if (result) {\n          createdCount++;\n          \n          // Assign roles to user\n          for (const roleName of user.roles) {\n            if (result.user) {\n              await authService.assignRole(result.user.id, roleName);\n            }\n          }\n        }\n      } catch (error:any) {\n        if (seedConfig.skipExistingUsers) {\n          skippedCount++;\n        }\n      }\n    }\n    \n    console.log('‚ú® Seeding completed successfully!');\n    console.log(`üìä Summary: ${createdCount} users created, ${skippedCount} skipped`);\n    \n  } catch (error:any) {\n    console.error('‚ùå Error during seeding:', error);\n    if (process.env.NODE_ENV !== 'test') {\n      throw error;\n    }\n  }\n}\n\n/**\n * Funci√≥n para limpiar la base de datos\n */\nexport async function cleanDatabase(dbPath?: string): Promise<void> {\n  console.log('üßπ Cleaning database...');\n  \n  try {\n    // Check if database is initialized\n    if (!isDatabaseInitialized()) {\n      initDatabase(dbPath);\n    }\n    \n    let db = getDatabase();\n\n    // Temporarily disable foreign keys\n    try {\n        db.exec('PRAGMA foreign_keys = OFF');\n    } catch (error:any) {\n        if (error instanceof Error && (error.message.includes('Database has closed') || error.message.includes('Cannot use a closed database'))) {\n            db = forceReinitDatabase();\n            db.exec('PRAGMA foreign_keys = OFF');\n        } else {\n            throw error;\n        }\n    }\n    \n    // Clean tables in correct order (respecting foreign keys)\n    const tables = [\n      'user_roles',\n      'role_permissions', \n      'sessions',\n      'users',\n      'roles',\n      'permissions'\n    ];\n    \n    for (const table of tables) {\n      try {\n        db.exec(`DELETE FROM ${table}`);\n      } catch (error:any) {\n        // Table cleanup error\n      }\n    }\n    \n    // Re-enable foreign keys\n    db.exec('PRAGMA foreign_keys = ON');\n    \n    console.log('‚úÖ Database cleaned successfully');\n    \n  } catch (error:any) {\n    console.error('‚ùå Error during cleanup:', error);\n    if (process.env.NODE_ENV !== 'test') {\n      throw error;\n    }\n  }\n}\n\n/**\n * Function to completely reset the database\n */\nexport async function resetDatabase(): Promise<void> {\n  try {\n    console.log('üîÑ Resetting database...');\n    \n    await cleanDatabase();\n    await seedDatabase();\n    \n    console.log('‚ú® Database reset successfully!');\n    \n  } catch (error:any) {\n    console.error('‚ùå Error during reset:', error);\n    throw error;\n  }\n}\n\n/**\n * Funci√≥n para verificar el estado de la base de datos\n */\nexport async function checkDatabaseStatus(): Promise<void> {\n  try {\n    console.log('üîç Verificando estado de la base de datos...');\n    \n    const db = getDatabase();\n    \n    // Contar registros en cada tabla\n    const tables = ['users', 'roles', 'permissions', 'user_roles', 'role_permissions', 'sessions'];\n    \n    console.log('\\nüìä Estado actual:');\n    for (const table of tables) {\n      try {\n        const result = db.query(`SELECT COUNT(*) as count FROM ${table}`).get() as { count: number };\n        console.log(`  ${table}: ${result.count} registros`);\n      } catch (error:any) {\n        console.log(`  ${table}: Tabla no existe`);\n      }\n    }\n    \n    // Verificar usuarios con roles\n    try {\n      const usersWithRoles = db.query(`\n        SELECT u.email, GROUP_CONCAT(r.name) as roles\n        FROM users u\n        LEFT JOIN user_roles ur ON u.id = ur.user_id\n        LEFT JOIN roles r ON ur.role_id = r.id\n        GROUP BY u.id, u.email\n        ORDER BY u.email\n      `).all();\n      \n      if (usersWithRoles.length > 0) {\n        console.log('\\nüë• Usuarios y sus roles:');\n        usersWithRoles.forEach((user: any) => {\n          console.log(`  ${user.email}: ${user.roles || 'Sin roles'}`);\n        });\n      }\n    } catch (error:any) {\n      console.log('  ‚ö†Ô∏è  No se pudieron obtener usuarios con roles');\n    }\n    \n  } catch (error:any) {\n    console.error('‚ùå Error verificando estado:', error);\n    throw error;\n  }\n}\n\n/**\n * Funci√≥n para crear solo usuarios de prueba\n */\nexport async function seedTestUsersOnly(count?: number): Promise<void> {\n  try {\n    console.log('üß™ Creando solo usuarios de prueba...');\n    \n    const userCount = count || 10;\n    const testUsers = generateTestUsers(userCount);\n    \n    initDatabase();\n    await runMigrations();\n    \n    const authService = new AuthService();\n    \n    let createdCount = 0;\n    for (const user of testUsers) {\n      try {\n        const result = await authService.register({\n          email: user.email,\n          password: user.password,\n        });\n        \n        if (result && result.user) {\n          createdCount++;\n          console.log(`  ‚úÖ Usuario de prueba creado: ${user.email}`);\n          \n          // Asignar roles\n          for (const roleName of user.roles) {\n            await authService.assignRole(result.user.id, roleName);\n          }\n        }\n      } catch (error: any) {\n        console.log(`  ‚ö†Ô∏è  Usuario ya existe: ${user.email}`);\n      }\n    }\n    \n    console.log(`\\n‚ú® ${createdCount} usuarios de prueba creados exitosamente!`);\n    \n  } catch (error: any) {\n    console.error('‚ùå Error creando usuarios de prueba:', error);\n    throw error;\n  }\n}\n\n// Ejecutar seeding si el script se ejecuta directamente\nexport async function mainSeed() {\n  const command = process.argv[2];\n  const param = process.argv[3];\n  \n  switch (command) {\n    case 'seed':\n      await seedDatabase();\n      break;\n    case 'clean':\n      await cleanDatabase();\n      break;\n    case 'reset':\n      await resetDatabase();\n      break;\n    case 'status':\n      await checkDatabaseStatus();\n      break;\n    case 'test-users':\n      const count = param ? parseInt(param) : undefined;\n      await seedTestUsersOnly(count);\n      break;\n    default:\n      console.log('Uso: bun run src/scripts/seed.ts [comando] [par√°metros]');\n      console.log('\\nComandos disponibles:');\n      console.log('  seed        - Poblar base de datos con datos iniciales');\n      console.log('  clean       - Limpiar todos los datos');\n      console.log('  reset       - Limpiar y volver a poblar');\n      console.log('  status      - Verificar estado actual');\n      console.log('  config      - Mostrar configuraci√≥n actual');\n      console.log('  test-users  - Crear solo usuarios de prueba [cantidad]');\n      console.log('\\nEjemplos:');\n      console.log('  bun run src/scripts/seed.ts seed');\n      console.log('  bun run src/scripts/seed.ts test-users 20');\n      console.log('  NODE_ENV=development SEED_USER_COUNT=25 bun run src/scripts/seed.ts seed');\n      console.log('  DEFAULT_SEED_PASSWORD=\"MyCustomPass123!\" bun run src/scripts/seed.ts test-users 5');\n  }\n}\n\n// Check if this script is being run directly\nif (process.argv[1] && process.argv[1].endsWith('seed.ts') && process.env.NODE_ENV !== 'test') {\n  mainSeed().catch(console.error);\n}",
    "// src/adapters/hono.ts\nimport { Context, Next } from 'hono';\nimport { \n  authenticateRequest, \n  AuthMiddlewareConfig, \n  getCurrentUser,\n  createEmptyAuthContext,\n  logAuthEvent,\n  extractClientIP,\n  extractUserAgent\n} from '../middleware/auth';\nimport type { AuthContext, AuthRequest } from '../types/auth';\n\n/**\n * Extiende el contexto de Hono para incluir autenticaci√≥n\n */\ndeclare module 'hono' {\n  interface ContextVariableMap {\n    auth: AuthContext;\n  }\n}\n\n/**\n * Adaptador de middleware de autenticaci√≥n para Hono\n * @param config Configuraci√≥n del middleware\n * @returns Middleware de Hono\n */\nexport function honoAuthMiddleware(config: AuthMiddlewareConfig = {}) {\n  return async (c: Context, next: Next) => {\n    try {\n      // Verificar si la ruta debe ser saltada\n      if (config.skipPaths && config.skipPaths.includes(c.req.path)) {\n        c.set('auth', createEmptyAuthContext());\n        await next();\n        return;\n      }\n\n      // Convertir request de Hono a formato agn√≥stico\n      const headers: Record<string, string> = {};\n      c.req.raw.headers.forEach((value, key) => {\n        headers[key] = value;\n      });\n      \n      // Extraer query parameters para soporte de tokens en GET requests\n      const query: Record<string, string | string[]> = {};\n      const url = new URL(c.req.url);\n      url.searchParams.forEach((value, key) => {\n        if (query[key]) {\n          // Handle multiple values for the same parameter\n          if (Array.isArray(query[key])) {\n            (query[key] as string[]).push(value);\n          } else {\n            query[key] = [query[key] as string, value];\n          }\n        } else {\n          query[key] = value;\n        }\n      });\n      \n      const authRequest: AuthRequest = {\n        headers,\n        query,\n        url: c.req.url\n      };\n\n      // Ejecutar autenticaci√≥n\n      const result = await authenticateRequest(authRequest, config);\n\n      if (!result.success) {\n        // Log del evento de fallo de autenticaci√≥n\n        logAuthEvent('auth.failed', undefined, {\n          path: c.req.path,\n          method: c.req.method,\n          ip: extractClientIP(authRequest.headers),\n          userAgent: extractUserAgent(authRequest.headers),\n          error: result.error\n        });\n\n        return createHonoAuthErrorResponse(c, result.error, result.statusCode);\n      }\n\n      // Establecer contexto de autenticaci√≥n en Hono\n      c.set('auth', result.context!);\n\n      // Log del evento de autenticaci√≥n exitosa\n      if (result.context?.user) {\n        logAuthEvent('auth.success', result.context.user.id, {\n          path: c.req.path,\n          method: c.req.method,\n          ip: extractClientIP(authRequest.headers),\n          userAgent: extractUserAgent(authRequest.headers)\n        });\n      }\n\n      await next();\n    } catch (error:any) {\n      console.error('Hono auth middleware error:', error);\n      return createHonoAuthErrorResponse(c, 'Internal authentication error', 500, {\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      });\n    }\n  };\n}\n\n/**\n * Middleware de autenticaci√≥n opcional para Hono\n * No falla si no hay token, pero lo procesa si est√° presente\n */\nexport function honoOptionalAuth() {\n  return honoAuthMiddleware({ required: false });\n}\n\n/**\n * Middleware que requiere autenticaci√≥n para Hono\n */\nexport function honoRequireAuth() {\n  return honoAuthMiddleware({ required: true });\n}\n\n/**\n * Middleware que requiere permisos espec√≠ficos para Hono\n * @param permissions Array de permisos requeridos\n * @param requireAll Si se requieren todos los permisos (default: false)\n */\nexport function honoRequirePermissions(\n  permissions: string[],\n  requireAll: boolean = false\n) {\n  return honoAuthMiddleware({\n    required: true,\n    permissions,\n    permissionOptions: { requireAll }\n  });\n}\n\n/**\n * Middleware que requiere roles espec√≠ficos para Hono\n * @param roles Array de roles requeridos\n */\nexport function honoRequireRoles(roles: string[]) {\n  return async (c: Context, next: Next) => {\n    const authContext = c.get('auth');\n    \n    if (!authContext?.user) {\n      return c.json(\n        {\n          error: 'Authentication required',\n          timestamp: new Date().toISOString()\n        },\n        401\n      );\n    }\n\n    const userRoles = authContext.user.roles.map(role => role.name);\n    const hasRequiredRole = roles.some(role => userRoles.includes(role));\n\n    if (!hasRequiredRole) {\n      logAuthEvent('auth.insufficient_roles', authContext.user.id, {\n        requiredRoles: roles,\n        userRoles,\n        path: c.req.path\n      });\n\n      return c.json(\n        {\n          error: `Insufficient roles. Required: ${roles.join(', ')}`,\n          timestamp: new Date().toISOString()\n        },\n        403\n      );\n    }\n\n    await next();\n  };\n}\n\n/**\n * Middleware que requiere ser admin para Hono\n */\nexport function honoRequireAdmin() {\n  return honoRequireRoles(['admin', 'administrator']);\n}\n\n/**\n * Middleware que requiere ser moderador o admin para Hono\n */\nexport function honoRequireModerator() {\n  return honoRequireRoles(['moderator', 'admin', 'administrator']);\n}\n\n/**\n * Helper para obtener el usuario actual del contexto de Hono\n * @param c Contexto de Hono\n * @returns Usuario actual o null\n */\nexport function getHonoCurrentUser(c: Context) {\n  const authContext = c.get('auth');\n  return getCurrentUser(authContext);\n}\n\n/**\n * Helper para verificar si el usuario est√° autenticado en Hono\n * @param c Contexto de Hono\n * @returns true si est√° autenticado\n */\nexport function isHonoAuthenticated(c: Context): boolean {\n  const authContext = c.get('auth');\n  return !!authContext?.user;\n}\n\n/**\n * Helper para obtener el contexto de autenticaci√≥n completo en Hono\n * @param c Contexto de Hono\n * @returns Contexto de autenticaci√≥n\n */\nexport function getHonoAuthContext(c: Context): AuthContext {\n  return c.get('auth') || createEmptyAuthContext();\n}\n\n/**\n * Middleware para validar ownership de recursos en Hono\n * @param getUserIdFromParams Funci√≥n para extraer el ID del usuario del recurso\n */\nexport function honoRequireOwnership(\n  getUserIdFromParams: (c: Context) => string\n) {\n  return async (c: Context, next: Next) => {\n    const authContext = c.get('auth');\n    \n    if (!authContext?.user) {\n      return c.json(\n        {\n          error: 'Authentication required',\n          timestamp: new Date().toISOString()\n        },\n        401\n      );\n    }\n\n    const resourceUserId = getUserIdFromParams(c);\n    const isOwner = authContext.user.id === resourceUserId;\n    const isAdmin = authContext.user.roles.some(role => \n      ['admin', 'administrator'].includes(role.name)\n    );\n\n    if (!isOwner && !isAdmin) {\n      logAuthEvent('auth.insufficient_ownership', authContext.user.id, {\n        resourceUserId,\n        path: c.req.path\n      });\n\n      return c.json(\n        {\n          error: 'Insufficient permissions. You can only access your own resources.',\n          timestamp: new Date().toISOString()\n        },\n        403\n      );\n    }\n\n    await next();\n  };\n}\n\n/**\n * Middleware para rate limiting b√°sico en Hono\n * @param maxRequests M√°ximo n√∫mero de requests\n * @param windowMs Ventana de tiempo en milisegundos\n */\nexport function honoRateLimit(\n  maxRequests: number = 100,\n  windowMs: number = 15 * 60 * 1000 // 15 minutos\n) {\n  const requests = new Map<string, { count: number; resetTime: number }>();\n\n  return async (c: Context, next: Next) => {\n    const authContext = c.get('auth');\n    const headers: Record<string, string> = {};\n    c.req.raw.headers.forEach((value, key) => {\n      headers[key] = value;\n    });\n    const clientId = authContext?.user?.id || extractClientIP(headers);\n    const now = Date.now();\n    \n    const clientData = requests.get(clientId);\n    \n    if (!clientData || now > clientData.resetTime) {\n      requests.set(clientId, {\n        count: 1,\n        resetTime: now + windowMs\n      });\n    } else {\n      clientData.count++;\n      \n      if (clientData.count > maxRequests) {\n        return c.json(\n          {\n            error: 'Rate limit exceeded',\n            retryAfter: Math.ceil((clientData.resetTime - now) / 1000),\n            timestamp: new Date().toISOString()\n          },\n          429\n        );\n      }\n    }\n\n    await next();\n  };\n}\n\n/**\n * Middleware para CORS en Hono con autenticaci√≥n\n * @param origins Or√≠genes permitidos\n */\nexport function honoCorsAuth(origins: string[] = ['*']) {\n  return async (c: Context, next: Next) => {\n    const origin = c.req.header('origin');\n    \n    if (origins.includes('*') || (origin && origins.includes(origin))) {\n      c.header('Access-Control-Allow-Origin', origin || '*');\n      c.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n      c.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n      c.header('Access-Control-Allow-Credentials', 'true');\n    }\n\n    if (c.req.method === 'OPTIONS') {\n      return c.text('', 204 as any);\n    }\n\n    await next();\n  };\n}\n\n/**\n * Helper para crear respuestas de error estandarizadas en Hono\n * @param c Contexto de Hono\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n */\nexport function honoErrorResponse(\n  c: Context,\n  error: string,\n  statusCode: number = 400\n) {\n  return c.json(\n    {\n      error,\n      timestamp: new Date().toISOString(),\n      path: c.req.path,\n      method: c.req.method\n    },\n    statusCode as any\n  );\n}\n\n/**\n * Helper para crear respuestas de error de autenticaci√≥n espec√≠ficas en Hono\n * @param c Contexto de Hono\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @param additionalData Datos adicionales para incluir en la respuesta\n */\nexport function createHonoAuthErrorResponse(\n  c: Context,\n  error: string = 'Authentication failed',\n  statusCode: number = 401,\n  additionalData?: any\n) {\n  const errorResponse: any = {\n    success: false,\n    error: getDetailedAuthError(error, statusCode),\n    code: getAuthErrorCode(error, statusCode),\n    timestamp: new Date().toISOString(),\n    path: c.req.path,\n    method: c.req.method\n  };\n\n  if (additionalData) {\n    Object.assign(errorResponse, additionalData);\n  }\n\n  // Agregar headers de autenticaci√≥n seg√∫n el tipo de error\n  if (statusCode === 401) {\n    c.header('WWW-Authenticate', 'Bearer realm=\"API\"');\n  }\n\n  return c.json(errorResponse, statusCode as any);\n}\n\n/**\n * Obtener mensaje de error detallado basado en el error y c√≥digo de estado\n * @param error Mensaje de error original\n * @param statusCode C√≥digo de estado HTTP\n * @returns Mensaje de error detallado\n */\nfunction getDetailedAuthError(error: string, statusCode: number): string {\n  // Mapear errores comunes a mensajes m√°s descriptivos\n  const errorMappings: Record<string, string> = {\n    'Invalid token': 'The provided authentication token is invalid or malformed. Please check your token and try again.',\n    'Token expired': 'Your authentication token has expired. Please obtain a new token and try again.',\n    'No token provided': 'Authentication token is required. Please provide a valid Bearer token in the Authorization header.',\n    'Insufficient permissions': 'You do not have the required permissions to access this resource.',\n    'User not found': 'The user associated with this token could not be found or has been deactivated.',\n    'Token revoked': 'This authentication token has been revoked. Please obtain a new token.',\n    'Invalid signature': 'The token signature is invalid. This may indicate a compromised or tampered token.',\n    'Malformed token': 'The authentication token format is incorrect. Please ensure you are using a valid JWT token.',\n    'Authentication required': 'This endpoint requires authentication. Please provide a valid Bearer token.',\n    'Session expired': 'Your session has expired. Please log in again to continue.',\n    'Account locked': 'Your account has been temporarily locked due to security reasons. Please contact support.',\n    'Invalid credentials': 'The provided credentials are incorrect. Please check your username and password.'\n  };\n\n  // Buscar coincidencia exacta primero\n  if (errorMappings[error]) {\n    return errorMappings[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorMappings)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // Mensajes por c√≥digo de estado si no hay coincidencia espec√≠fica\n  switch (statusCode) {\n    case 401:\n      return error.includes('token') \n        ? 'Authentication failed: Invalid or missing token. Please provide a valid Bearer token in the Authorization header.'\n        : 'Authentication required. Please provide valid credentials to access this resource.';\n    case 403:\n      return 'Access forbidden: You do not have sufficient permissions to perform this action.';\n    case 429:\n      return 'Rate limit exceeded: Too many requests. Please wait before trying again.';\n    default:\n      return error || 'Authentication error occurred.';\n  }\n}\n\n/**\n * Obtener c√≥digo de error espec√≠fico para APIs\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @returns C√≥digo de error para APIs\n */\nfunction getAuthErrorCode(error: string, statusCode: number): string {\n  const errorCodes: Record<string, string> = {\n    'Invalid token': 'AUTH_INVALID_TOKEN',\n    'Token expired': 'AUTH_TOKEN_EXPIRED',\n    'No token provided': 'AUTH_TOKEN_MISSING',\n    'Insufficient permissions': 'AUTH_INSUFFICIENT_PERMISSIONS',\n    'User not found': 'AUTH_USER_NOT_FOUND',\n    'Token revoked': 'AUTH_TOKEN_REVOKED',\n    'Invalid signature': 'AUTH_INVALID_SIGNATURE',\n    'Malformed token': 'AUTH_MALFORMED_TOKEN',\n    'Authentication required': 'AUTH_REQUIRED',\n    'Session expired': 'AUTH_SESSION_EXPIRED',\n    'Account locked': 'AUTH_ACCOUNT_LOCKED',\n    'Invalid credentials': 'AUTH_INVALID_CREDENTIALS'\n  };\n\n  // Buscar coincidencia exacta\n  if (errorCodes[error]) {\n    return errorCodes[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorCodes)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // C√≥digos por estado HTTP\n  switch (statusCode) {\n    case 401:\n      return 'AUTH_UNAUTHORIZED';\n    case 403:\n      return 'AUTH_FORBIDDEN';\n    case 429:\n      return 'AUTH_RATE_LIMITED';\n    default:\n      return 'AUTH_ERROR';\n  }\n}\n\n/**\n * Helper para crear respuestas de √©xito estandarizadas en Hono\n * @param c Contexto de Hono\n * @param data Datos de respuesta\n * @param message Mensaje opcional\n * @param statusCode C√≥digo de estado HTTP\n */\nexport function honoSuccessResponse(\n  c: Context,\n  data: any,\n  message?: string,\n  statusCode: number = 200\n) {\n  const response: any = {\n    success: true,\n    data,\n    timestamp: new Date().toISOString()\n  };\n\n  if (message) {\n    response.message = message;\n  }\n\n  return c.json(response, statusCode as any);\n}\n\n/**\n * Middleware para logging de requests autenticados en Hono\n */\nexport function honoAuthLogger() {\n  return async (c: Context, next: Next) => {\n    const start = Date.now();\n    const authContext = c.get('auth');\n    \n    await next();\n    \n    const duration = Date.now() - start;\n    const headers: Record<string, string> = {};\n    c.req.raw.headers.forEach((value, key) => {\n      headers[key] = value;\n    });\n    const logData = {\n      method: c.req.method,\n      path: c.req.path,\n      status: c.res.status,\n      duration: `${duration}ms`,\n      userId: authContext?.user?.id,\n      ip: extractClientIP(headers),\n      userAgent: extractUserAgent(headers)\n    };\n    \n    console.log(`üìù Request: ${JSON.stringify(logData)}`);\n  };\n}",
    "// src/adapters/express.ts\n// Type-safe conditional imports for Express\n\n// Define Express-compatible interfaces\nexport interface ExpressRequest {\n  headers: Record<string, string | string[] | undefined>;\n  path: string;\n  method: string;\n  body?: any;\n  query?: any;\n  params?: any;\n  auth?: any;\n}\n\nexport interface ExpressResponse {\n  status(code: number): ExpressResponse;\n  json(data: any): ExpressResponse;\n  send(data: any): ExpressResponse;\n  setHeader(name: string, value: string): ExpressResponse;\n  header(name: string, value: string): ExpressResponse;\n  sendStatus(code: number): ExpressResponse;\n  end(): void;\n  on(event: string, listener: (...args: any[]) => void): ExpressResponse;\n  statusCode: number;\n}\n\nexport interface ExpressNextFunction {\n  (error?: any): void;\n}\n\n// Try to use actual Express types if available, otherwise use our interfaces\ntype Request = ExpressRequest;\ntype Response = ExpressResponse;\ntype NextFunction = ExpressNextFunction;\n\nimport { \n  authenticateRequest, \n  AuthMiddlewareConfig, \n  getCurrentUser,\n  createEmptyAuthContext,\n  logAuthEvent,\n  extractClientIP,\n  extractUserAgent\n} from '../middleware/auth';\nimport type { AuthContext, AuthRequest } from '../types/auth';\n\n/**\n * Extiende el tipo Request de Express para incluir autenticaci√≥n\n */\ndeclare global {\n  namespace Express {\n    interface Request {\n      auth?: AuthContext;\n    }\n  }\n}\n\n/**\n * Adaptador de middleware de autenticaci√≥n para Express\n * @param config Configuraci√≥n del middleware\n * @returns Middleware de Express\n */\nexport function expressAuthMiddleware(config: AuthMiddlewareConfig = {}) {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // Verificar si la ruta debe ser saltada\n      if (config.skipPaths && config.skipPaths.includes(req.path)) {\n        req.auth = createEmptyAuthContext();\n        return next();\n      }\n\n      // Convertir request de Express a formato agn√≥stico\n      const authRequest: AuthRequest = {\n        headers: req.headers as Record<string, string>,\n        url: req.path,\n        method: req.method,\n        query: req.query || {},\n        params: req.params || {}\n      };\n\n      // Ejecutar autenticaci√≥n\n      const result = await authenticateRequest(authRequest, config);\n\n      if (!result.success) {\n        // Log del evento de fallo de autenticaci√≥n\n        logAuthEvent('auth.failed', undefined, {\n          path: req.path,\n          method: req.method,\n          ip: extractClientIP(authRequest.headers),\n          userAgent: extractUserAgent(authRequest.headers),\n          error: result.error\n        });\n\n        return createExpressAuthErrorResponse(res, req, result.error, result.statusCode);\n      }\n\n      // Establecer contexto de autenticaci√≥n en Express\n      req.auth = result.context!;\n\n      // Log del evento de autenticaci√≥n exitosa\n      if (result.context?.user) {\n        logAuthEvent('auth.success', result.context.user.id, {\n          path: req.path,\n          method: req.method,\n          ip: extractClientIP(authRequest.headers),\n          userAgent: extractUserAgent(authRequest.headers)\n        });\n      }\n\n      next();\n    } catch (error:any) {\n      console.error('Express auth middleware error:', error);\n      return createExpressAuthErrorResponse(res, req, 'Internal authentication error', 500, {\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      });\n    }\n  };\n}\n\n/**\n * Middleware de autenticaci√≥n opcional para Express\n * No falla si no hay token, pero lo procesa si est√° presente\n */\nexport function expressOptionalAuth() {\n  return expressAuthMiddleware({ required: false });\n}\n\n/**\n * Middleware que requiere autenticaci√≥n para Express\n */\nexport function expressRequireAuth() {\n  return expressAuthMiddleware({ required: true });\n}\n\n/**\n * Middleware que requiere permisos espec√≠ficos para Express\n * @param permissions Array de permisos requeridos\n * @param requireAll Si se requieren todos los permisos (default: false)\n */\nexport function expressRequirePermissions(\n  permissions: string[],\n  requireAll: boolean = false\n) {\n  return expressAuthMiddleware({\n    required: true,\n    permissions,\n    permissionOptions: { requireAll }\n  });\n}\n\n/**\n * Middleware que requiere roles espec√≠ficos para Express\n * @param roles Array de roles requeridos\n */\nexport function expressRequireRoles(roles: string[]) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const authContext = req.auth;\n    \n    if (!authContext?.user) {\n      return res.status(401).json({\n        error: 'Authentication required',\n        timestamp: new Date().toISOString()\n      });\n    }\n\n    const userRoles = authContext.user.roles.map((role: any) => role.name);\n    const hasRequiredRole = roles.some(role => userRoles.includes(role));\n\n    if (!hasRequiredRole) {\n      logAuthEvent('auth.insufficient_roles', authContext.user.id, {\n        requiredRoles: roles,\n        userRoles,\n        path: req.path\n      });\n\n      return res.status(403).json({\n        error: `Insufficient roles. Required: ${roles.join(', ')}`,\n        timestamp: new Date().toISOString()\n      });\n    }\n\n    next();\n  };\n}\n\n/**\n * Middleware que requiere ser admin para Express\n */\nexport function expressRequireAdmin() {\n  return expressRequireRoles(['admin', 'administrator']);\n}\n\n/**\n * Middleware que requiere ser moderador o admin para Express\n */\nexport function expressRequireModerator() {\n  return expressRequireRoles(['moderator', 'admin', 'administrator']);\n}\n\n/**\n * Helper para obtener el usuario actual del request de Express\n * @param req Request de Express\n * @returns Usuario actual o null\n */\nexport function getExpressCurrentUser(req: Request) {\n  return getCurrentUser(req.auth);\n}\n\n/**\n * Helper para verificar si el usuario est√° autenticado en Express\n * @param req Request de Express\n * @returns true si est√° autenticado\n */\nexport function isExpressAuthenticated(req: Request): boolean {\n  return !!req.auth?.user;\n}\n\n/**\n * Helper para obtener el contexto de autenticaci√≥n completo en Express\n * @param req Request de Express\n * @returns Contexto de autenticaci√≥n\n */\nexport function getExpressAuthContext(req: Request): AuthContext {\n  return req.auth || createEmptyAuthContext();\n}\n\n/**\n * Middleware para validar ownership de recursos en Express\n * @param getUserIdFromParams Funci√≥n para extraer el ID del usuario del recurso\n */\nexport function expressRequireOwnership(\n  getUserIdFromParams: (req: Request) => string\n) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const authContext = req.auth;\n    \n    if (!authContext?.user) {\n      return res.status(401).json({\n        error: 'Authentication required',\n        timestamp: new Date().toISOString()\n      });\n    }\n\n    const resourceUserId = getUserIdFromParams(req);\n    const isOwner = authContext.user.id === resourceUserId;\n    const isAdmin = authContext.user.roles.some((role: any) => \n      ['admin', 'administrator'].includes(role.name)\n    );\n\n    if (!isOwner && !isAdmin) {\n      logAuthEvent('auth.insufficient_ownership', authContext.user.id, {\n        resourceUserId,\n        path: req.path\n      });\n\n      return res.status(403).json({\n        error: 'Insufficient permissions. You can only access your own resources.',\n        timestamp: new Date().toISOString()\n      });\n    }\n\n    next();\n  };\n}\n\n/**\n * Middleware para rate limiting b√°sico en Express\n * @param maxRequests M√°ximo n√∫mero de requests\n * @param windowMs Ventana de tiempo en milisegundos\n */\nexport function expressRateLimit(\n  maxRequests: number = 100,\n  windowMs: number = 15 * 60 * 1000 // 15 minutos\n) {\n  const requests = new Map<string, { count: number; resetTime: number }>();\n\n  return (req: Request, res: Response, next: NextFunction) => {\n    const authContext = req.auth;\n    const clientId = authContext?.user?.id || extractClientIP(req.headers as Record<string, string>);\n    const now = Date.now();\n    \n    const clientData = requests.get(clientId);\n    \n    if (!clientData || now > clientData.resetTime) {\n      requests.set(clientId, {\n        count: 1,\n        resetTime: now + windowMs\n      });\n    } else {\n      clientData.count++;\n      \n      if (clientData.count > maxRequests) {\n        return res.status(429).json({\n          error: 'Rate limit exceeded',\n          retryAfter: Math.ceil((clientData.resetTime - now) / 1000),\n          timestamp: new Date().toISOString()\n        });\n      }\n    }\n\n    next();\n  };\n}\n\n/**\n * Middleware para CORS en Express con autenticaci√≥n\n * @param origins Or√≠genes permitidos\n */\nexport function expressCorsAuth(origins: string[] = ['*']) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const origin = req.headers.origin;\n    \n    const originStr = Array.isArray(origin) ? origin[0] : origin;\n    if (origins.includes('*') || (originStr && origins.includes(originStr))) {\n      res.header('Access-Control-Allow-Origin', originStr || '*');\n      res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n      res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization');\n      res.header('Access-Control-Allow-Credentials', 'true');\n    }\n\n    if (req.method === 'OPTIONS') {\n      return res.sendStatus(204);\n    }\n\n    next();\n  };\n}\n\n/**\n * Helper para crear respuestas de error estandarizadas en Express\n * @param res Response de Express\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n */\nexport function expressErrorResponse(\n  res: Response,\n  error: string,\n  statusCode: number = 400\n) {\n  return res.status(statusCode).json({\n    error,\n    timestamp: new Date().toISOString()\n  });\n}\n\n/**\n * Helper para crear respuestas de error de autenticaci√≥n espec√≠ficas en Express\n * @param res Response de Express\n * @param req Request de Express\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @param additionalData Datos adicionales para incluir en la respuesta\n */\nexport function createExpressAuthErrorResponse(\n  res: Response,\n  req: Request,\n  error: string = 'Authentication failed',\n  statusCode: number = 401,\n  additionalData?: any\n) {\n  const errorResponse: any = {\n    success: false,\n    error: getDetailedAuthError(error, statusCode),\n    code: getAuthErrorCode(error, statusCode),\n    timestamp: new Date().toISOString(),\n    path: req.path,\n    method: req.method\n  };\n\n  if (additionalData) {\n    Object.assign(errorResponse, additionalData);\n  }\n\n  // Agregar headers de autenticaci√≥n seg√∫n el tipo de error\n  if (statusCode === 401) {\n    res.setHeader('WWW-Authenticate', 'Bearer realm=\"API\"');\n  }\n\n  return res.status(statusCode).json(errorResponse);\n}\n\n/**\n * Obtener mensaje de error detallado basado en el error y c√≥digo de estado\n * @param error Mensaje de error original\n * @param statusCode C√≥digo de estado HTTP\n * @returns Mensaje de error detallado\n */\nfunction getDetailedAuthError(error: string, statusCode: number): string {\n  // Mapear errores comunes a mensajes m√°s descriptivos\n  const errorMappings: Record<string, string> = {\n    'Invalid token': 'The provided authentication token is invalid or malformed. Please check your token and try again.',\n    'Token expired': 'Your authentication token has expired. Please obtain a new token and try again.',\n    'No token provided': 'Authentication token is required. Please provide a valid Bearer token in the Authorization header.',\n    'Insufficient permissions': 'You do not have the required permissions to access this resource.',\n    'User not found': 'The user associated with this token could not be found or has been deactivated.',\n    'Token revoked': 'This authentication token has been revoked. Please obtain a new token.',\n    'Invalid signature': 'The token signature is invalid. This may indicate a compromised or tampered token.',\n    'Malformed token': 'The authentication token format is incorrect. Please ensure you are using a valid JWT token.',\n    'Authentication required': 'This endpoint requires authentication. Please provide a valid Bearer token.',\n    'Session expired': 'Your session has expired. Please log in again to continue.',\n    'Account locked': 'Your account has been temporarily locked due to security reasons. Please contact support.',\n    'Invalid credentials': 'The provided credentials are incorrect. Please check your username and password.'\n  };\n\n  // Buscar coincidencia exacta primero\n  if (errorMappings[error]) {\n    return errorMappings[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorMappings)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // Mensajes por c√≥digo de estado si no hay coincidencia espec√≠fica\n  switch (statusCode) {\n    case 401:\n      return error.includes('token') \n        ? 'Authentication failed: Invalid or missing token. Please provide a valid Bearer token in the Authorization header.'\n        : 'Authentication required. Please provide valid credentials to access this resource.';\n    case 403:\n      return 'Access forbidden: You do not have sufficient permissions to perform this action.';\n    case 429:\n      return 'Rate limit exceeded: Too many requests. Please wait before trying again.';\n    default:\n      return error || 'Authentication error occurred.';\n  }\n}\n\n/**\n * Obtener c√≥digo de error espec√≠fico para APIs\n * @param error Mensaje de error\n * @param statusCode C√≥digo de estado HTTP\n * @returns C√≥digo de error para APIs\n */\nfunction getAuthErrorCode(error: string, statusCode: number): string {\n  const errorCodes: Record<string, string> = {\n    'Invalid token': 'AUTH_INVALID_TOKEN',\n    'Token expired': 'AUTH_TOKEN_EXPIRED',\n    'No token provided': 'AUTH_TOKEN_MISSING',\n    'Insufficient permissions': 'AUTH_INSUFFICIENT_PERMISSIONS',\n    'User not found': 'AUTH_USER_NOT_FOUND',\n    'Token revoked': 'AUTH_TOKEN_REVOKED',\n    'Invalid signature': 'AUTH_INVALID_SIGNATURE',\n    'Malformed token': 'AUTH_MALFORMED_TOKEN',\n    'Authentication required': 'AUTH_REQUIRED',\n    'Session expired': 'AUTH_SESSION_EXPIRED',\n    'Account locked': 'AUTH_ACCOUNT_LOCKED',\n    'Invalid credentials': 'AUTH_INVALID_CREDENTIALS'\n  };\n\n  // Buscar coincidencia exacta\n  if (errorCodes[error]) {\n    return errorCodes[error];\n  }\n\n  // Buscar coincidencias parciales\n  for (const [key, value] of Object.entries(errorCodes)) {\n    if (error.toLowerCase().includes(key.toLowerCase())) {\n      return value;\n    }\n  }\n\n  // C√≥digos por estado HTTP\n  switch (statusCode) {\n    case 401:\n      return 'AUTH_UNAUTHORIZED';\n    case 403:\n      return 'AUTH_FORBIDDEN';\n    case 429:\n      return 'AUTH_RATE_LIMITED';\n    default:\n      return 'AUTH_ERROR';\n  }\n}\n\n/**\n * Helper para crear respuestas de √©xito estandarizadas en Express\n * @param res Response de Express\n * @param data Datos de respuesta\n * @param message Mensaje opcional\n * @param statusCode C√≥digo de estado HTTP\n */\nexport function expressSuccessResponse(\n  res: Response,\n  data: any,\n  message?: string,\n  statusCode: number = 200\n) {\n  const response: any = {\n    success: true,\n    data,\n    timestamp: new Date().toISOString()\n  };\n\n  if (message) {\n    response.message = message;\n  }\n\n  return res.status(statusCode).json(response);\n}\n\n/**\n * Middleware para logging de requests autenticados en Express\n */\nexport function expressAuthLogger() {\n  return (req: Request, res: Response, next: NextFunction) => {\n    const start = Date.now();\n    const authContext = req.auth;\n    \n    res.on('finish', () => {\n      const duration = Date.now() - start;\n      const logData = {\n        method: req.method,\n        path: req.path,\n        status: res.statusCode,\n        duration: `${duration}ms`,\n        userId: authContext?.user?.id,\n        ip: extractClientIP(req.headers as Record<string, string>),\n        userAgent: extractUserAgent(req.headers as Record<string, string>)\n      };\n      \n      console.log(`üìù Request: ${JSON.stringify(logData)}`);\n    });\n    \n    next();\n  };\n}\n\n/**\n * Middleware de manejo de errores para Express con autenticaci√≥n\n */\nexport function expressAuthErrorHandler() {\n  return (error: any, req: Request, res: Response, next: NextFunction) => {\n    console.error('Express auth error:', error);\n    \n    // Log del error con contexto de autenticaci√≥n\n    const authContext = req.auth;\n    logAuthEvent('auth.error', authContext?.user?.id, {\n      error: error.message,\n      stack: error.stack,\n      path: req.path,\n      method: req.method\n    });\n\n    // Determinar c√≥digo de estado basado en el tipo de error\n    let statusCode = 500;\n    let message = 'Internal server error';\n\n    if (error.name === 'ValidationError') {\n      statusCode = 400;\n      message = 'Validation error';\n    } else if (error.name === 'UnauthorizedError') {\n      statusCode = 401;\n      message = 'Unauthorized';\n    } else if (error.name === 'ForbiddenError') {\n      statusCode = 403;\n      message = 'Forbidden';\n    }\n\n    res.status(statusCode).json({\n      error: message,\n      timestamp: new Date().toISOString(),\n      ...(process.env.NODE_ENV === 'development' && { details: error.message })\n    });\n  };\n}\n\n/**\n * Middleware para validaci√≥n de JSON en Express\n */\nexport function expressJsonValidator() {\n  return (req: Request, res: Response, next: NextFunction) => {\n    if (req.headers['content-type']?.includes('application/json')) {\n      try {\n        if (req.body && typeof req.body === 'string') {\n          req.body = JSON.parse(req.body);\n        }\n      } catch (error:any) {\n        return res.status(400).json({\n          error: 'Invalid JSON format',\n          timestamp: new Date().toISOString()\n        });\n      }\n    }\n    next();\n  };\n}\n\n/**\n * Middleware para sanitizaci√≥n de datos en Express\n */\nexport function expressSanitizer() {\n  return (req: Request, res: Response, next: NextFunction) => {\n    // Sanitizar query parameters\n    if (req.query) {\n      for (const key in req.query) {\n        if (typeof req.query[key] === 'string') {\n          req.query[key] = (req.query[key] as string)\n            .replace(/<script[^>]*>.*?<\\/script>/gi, '')\n            .replace(/<[^>]*>/g, '')\n            .trim();\n        }\n      }\n    }\n\n    // Sanitizar body\n    if (req.body && typeof req.body === 'object') {\n      sanitizeObject(req.body);\n    }\n\n    next();\n  };\n}\n\n/**\n * Funci√≥n helper para sanitizar objetos recursivamente\n */\nfunction sanitizeObject(obj: any): void {\n  for (const key in obj) {\n    if (typeof obj[key] === 'string') {\n      obj[key] = obj[key]\n        .replace(/<script[^>]*>.*?<\\/script>/gi, '')\n        .replace(/<[^>]*>/g, '')\n        .trim();\n    } else if (typeof obj[key] === 'object' && obj[key] !== null) {\n      sanitizeObject(obj[key]);\n    }\n  }\n}",
    "// src/scripts/dev.ts\nimport { seedDatabase, cleanDatabase, resetDatabase, checkDatabaseStatus } from './seed';\nimport { runMigrations, rollbackMigrations, getMigrationStatus,type Migration } from '../db/migrations';\nimport { getDatabase, initDatabase, closeDatabase } from '../db/connection';\nimport { AuthService } from '../services/auth';\nimport { PermissionService } from '../services/permissions';\nimport { JWTService } from '../services/jwt';\n\n/**\n * Configuraci√≥n de desarrollo\n */\nconst DEV_CONFIG = {\n  jwtSecret: 'dev-secret-key-change-in-production',\n  jwtExpiration: '1h',\n  refreshTokenExpiration: '7d'\n};\n\n/**\n * Comandos disponibles para desarrollo\n */\nconst COMMANDS = {\n  // Base de datos\n  'db:init': 'Inicializar base de datos',\n  'db:migrate': 'Ejecutar migraciones',\n  'db:rollback': 'Revertir migraciones',\n  'db:status': 'Estado de migraciones',\n  'db:seed': 'Poblar con datos iniciales',\n  'db:clean': 'Limpiar datos',\n  'db:reset': 'Resetear completamente',\n  'db:check': 'Verificar estado',\n  \n  // Usuarios\n  'user:create': 'Crear usuario',\n  'user:list': 'Listar usuarios',\n  'user:roles': 'Asignar roles a usuario',\n  'user:delete': 'Eliminar usuario',\n  \n  // Roles y permisos\n  'role:create': 'Crear rol',\n  'role:list': 'Listar roles',\n  'role:get': 'Obtener rol por nombre',\n  'permission:create': 'Crear permiso',\n  'permission:list': 'Listar permisos',\n  \n  // JWT\n  'jwt:generate': 'Generar token JWT',\n  'jwt:verify': 'Verificar token JWT',\n  \n  // Utilidades\n  'help': 'Mostrar ayuda',\n  'test:auth': 'Probar autenticaci√≥n',\n  'test:permissions': 'Probar permisos'\n};\n\n/**\n * Funci√≥n principal del CLI de desarrollo\n */\nexport async function runDevCommand(command: string, ...args: string[]): Promise<void> {\n  try {\n    console.log(`üöÄ Ejecutando comando: ${command}`);\n    \n    switch (command) {\n      // Comandos de base de datos\n      case 'db:init':\n        initDatabase();\n        console.log('‚úÖ Base de datos inicializada');\n        break;\n        \n      case 'db:migrate':\n        await runMigrations();\n        console.log('‚úÖ Migraciones ejecutadas');\n        break;\n        \n      case 'db:rollback':\n        const version = args[0] ? parseInt(args[0]) : 0;\n        await rollbackMigrations(version);\n        console.log('‚úÖ Migraciones revertidas');\n        break;\n        \n      case 'db:status':\n        const data = await getMigrationStatus();\n        console.log('üìä Estado de migraciones:');\n        data.executedMigrations.forEach(migration => {\n          const status = migration ? '‚úÖ' : '‚è≥';\n          console.log(`  ${status} ${migration.version}: ${migration.name}`);\n        });\n        break;\n        \n      case 'db:seed':\n        await seedDatabase();\n        break;\n        \n      case 'db:clean':\n        await cleanDatabase();\n        break;\n        \n      case 'db:reset':\n        await resetDatabase();\n        break;\n        \n      case 'db:check':\n        await checkDatabaseStatus();\n        break;\n        \n      // Comandos de usuarios\n      case 'user:create':\n        await createUser(args);\n        break;\n        \n      case 'user:list':\n        await listUsers();\n        break;\n        \n      case 'user:roles':\n        await assignUserRoles(args);\n        break;\n        \n      case 'user:delete':\n        await deleteUser(args[0]);\n        break;\n        \n      // Comandos de roles\n      case 'role:create':\n        await createRole(args);\n        break;\n        \n      case 'role:list':\n        await listRoles();\n        break;\n        \n      case 'role:get':\n        await getRoleByName(args);\n        break;\n        \n      // Comandos de permisos\n      case 'permission:create':\n        await createPermission(args);\n        break;\n        \n      case 'permission:list':\n        await listPermissions();\n        break;\n        \n      // Comandos JWT\n      case 'jwt:generate':\n        await generateJWT(args);\n        break;\n        \n      case 'jwt:verify':\n        await verifyJWT(args[0]);\n        break;\n        \n      // Comandos de prueba\n      case 'test:auth':\n        await testAuthentication();\n        break;\n        \n      case 'test:permissions':\n        await testPermissions();\n        break;\n        \n      case 'help':\n      default:\n        showHelp();\n        break;\n    }\n    \n  } catch (error:any) {\n    console.error(`‚ùå Error ejecutando comando ${command}:`, error);\n  }\n}\n\n/**\n * Crear un nuevo usuario\n */\nasync function createUser(args: string[]): Promise<void> {\n  if (args.length < 4) {\n    console.log('Uso: user:create <email> <password> <firstName> <lastName> [roles...]');\n    return;\n  }\n  \n  const [email, password, firstName, lastName, ...roles] = args;\n  \n  const authService = new AuthService();\n  const permissionService = new PermissionService();\n  \n  const result = await authService.register({\n    email,\n    password,\n    firstName,\n    lastName\n  });\n  \n  if (!result  || !result.user) {\n    console.error('‚ùå Error creando usuario:', result);\n    return;\n  }\n  \n  console.log(`‚úÖ Usuario creado: ${email} (ID: ${result.user.id})`);\n  \n  // Asignar roles si se especificaron\n  if (roles.length > 0) {\n    for (const roleName of roles) {\n      try {\n        const role = await permissionService.findRoleByName(roleName);\n        if (role) {\n          await permissionService.assignRoleToUser({userId: result.user.id, roleId: role.id});\n          console.log(`  üé≠ Rol asignado: ${roleName}`);\n        }\n      } catch (error:any) {\n        console.log(`  ‚ö†Ô∏è  No se pudo asignar rol: ${roleName}`);\n      }\n    }\n  }\n}\n\n/**\n * Listar todos los usuarios\n */\nasync function listUsers(): Promise<void> {\n  const db = getDatabase();\n  \n  const users = db.query(`\n    SELECT \n      u.id,\n      u.email,\n      u.first_name,\n      u.last_name,\n      u.is_active,\n      u.created_at,\n      GROUP_CONCAT(r.name) as roles\n    FROM users u\n    LEFT JOIN user_roles ur ON u.id = ur.user_id\n    LEFT JOIN roles r ON ur.role_id = r.id\n    GROUP BY u.id\n    ORDER BY u.created_at DESC\n  `).all();\n  \n  if (users.length === 0) {\n    console.log('üì≠ No hay usuarios registrados');\n    return;\n  }\n  \n  console.log('üë• Usuarios registrados:');\n  users.forEach((user: any) => {\n    const status = user.is_active ? 'üü¢' : 'üî¥';\n    console.log(`  ${status} ${user.email} (${user.first_name} ${user.last_name})`);\n    console.log(`    ID: ${user.id}`);\n    console.log(`    Roles: ${user.roles || 'Sin roles'}`);\n    console.log(`    Creado: ${new Date(user.created_at).toLocaleString()}`);\n    console.log('');\n  });\n}\n\n/**\n * Asignar roles a un usuario\n */\nasync function assignUserRoles(args: string[]): Promise<void> {\n  if (args.length < 2) {\n    console.log('Uso: user:roles <email> <role1> [role2] [role3]...');\n    return;\n  }\n  \n  const [email, ...roles] = args;\n  \n  const authService = new AuthService();\n  const permissionService = new PermissionService();\n  \n  const user = await authService.findUserByEmail(email);\n  if (!user) {\n    console.error(`‚ùå Usuario no encontrado: ${email}`);\n    return;\n  }\n  \n  console.log(`üë§ Asignando roles al usuario: ${email}`);\n  \n  for (const roleName of roles) {\n    try {\n      const role = await permissionService.findRoleByName(roleName);\n      if (role) {\n        await permissionService.assignRoleToUser({userId: user.id, roleId: role.id});\n        console.log(`  ‚úÖ Rol asignado: ${roleName}`);\n      } else {\n        console.log(`  ‚ùå Rol no encontrado: ${roleName}`);\n      }\n    } catch (error:any) {\n      console.log(`  ‚ö†Ô∏è  Error asignando rol ${roleName}:`, error);\n    }\n  }\n}\n\n/**\n * Eliminar un usuario\n */\nasync function deleteUser(email: string): Promise<void> {\n  if (!email) {\n    console.log('Uso: user:delete <email>');\n    return;\n  }\n  \n  const authService = new AuthService();\n  const user = await authService.findUserByEmail(email);\n  \n  if (!user) {\n    console.error(`‚ùå Usuario no encontrado: ${email}`);\n    return;\n  }\n  \n  const db = getDatabase();\n  \n  // Eliminar relaciones primero\n  db.run('DELETE FROM user_roles WHERE user_id = ?', [user.id]);\n  db.run('DELETE FROM sessions WHERE user_id = ?', [user.id]);\n  \n  // Eliminar usuario\n  db.run('DELETE FROM users WHERE id = ?', [user.id]);\n  \n  console.log(`‚úÖ Usuario eliminado: ${email}`);\n}\n\n/**\n * Crear un nuevo rol\n */\nasync function createRole(args: string[]): Promise<void> {\n  if (args.length < 2) {\n    console.log('Uso: role:create <name> <description> [permission1] [permission2]...');\n    return;\n  }\n  \n  const [name, description, ...permissions] = args;\n  \n  const permissionService = new PermissionService();\n  \n  const result = await permissionService.createRole({ name, description });\n  \n  if (!result.success || !result) {\n    console.error('‚ùå Error creando rol:', result.error);\n    return;\n  }  \n  // Asignar permisos si se especificaron\n  if (permissions.length > 0) {\n    for (const permissionName of permissions) {\n      try {\n        const permission = await permissionService.findPermissionByName(permissionName);\n        if (permission) {\n          await permissionService.assignPermissionToRole(result.role!.id, permission.id);\n          console.log(`  üìã Permiso asignado: ${permissionName}`);\n        }\n      } catch (error:any) {\n        console.log(`  ‚ö†Ô∏è  No se pudo asignar permiso: ${permissionName}`);\n      }\n    }\n  }\n}\n\n/**\n * Obtener un rol por nombre\n */\nasync function getRoleByName(args: string[]): Promise<void> {\n  if (args.length < 1) {\n    console.log('Uso: role:get <name>');\n    return;\n  }\n  \n  const [name] = args;\n  \n  const permissionService = new PermissionService();\n  \n  try {\n    const role = await permissionService.findRoleByName(name, true);\n    \n    if (!role) {\n      console.error(`‚ùå Rol no encontrado: ${name}`);\n      return;\n    }\n    \n    console.log('üé≠ Informaci√≥n del rol:');\n    console.log(`  üìã Nombre: ${role.name}`);\n    console.log(`  üÜî ID: ${role.id}`);\n    console.log(`  üìÖ Creado: ${new Date(role.created_at).toLocaleString()}`);\n    \n    if (role.permissions && role.permissions.length > 0) {\n      console.log('  üîê Permisos:');\n      role.permissions.forEach(permission => {\n        console.log(`    - ${permission.name} (${permission.resource}:${permission.action})`);\n      });\n    } else {\n      console.log('  üîê Permisos: Sin permisos asignados');\n    }\n    \n  } catch (error:any) {\n    console.error(`‚ùå Error obteniendo rol: ${error}`);\n  }\n}\n\n/**\n * Listar todos los roles\n */\nasync function listRoles(): Promise<void> {\n  const db = getDatabase();\n  \n  const roles = db.query(`\n    SELECT \n      r.id,\n      r.name,\n      r.description,\n      r.created_at,\n      GROUP_CONCAT(p.name) as permissions\n    FROM roles r\n    LEFT JOIN role_permissions rp ON r.id = rp.role_id\n    LEFT JOIN permissions p ON rp.permission_id = p.id\n    GROUP BY r.id\n    ORDER BY r.name\n  `).all();\n  \n  if (roles.length === 0) {\n    console.log('üì≠ No hay roles registrados');\n    return;\n  }\n  \n  console.log('üé≠ Roles registrados:');\n  roles.forEach((role: any) => {\n    console.log(`  üìã ${role.name}`);\n    console.log(`    Descripci√≥n: ${role.description}`);\n    console.log(`    Permisos: ${role.permissions || 'Sin permisos'}`);\n    console.log(`    Creado: ${new Date(role.created_at).toLocaleString()}`);\n    console.log('');\n  });\n}\n\n/**\n * Crear un nuevo permiso\n */\nasync function createPermission(args: string[]): Promise<void> {\n  if (args.length < 2) {\n    console.log('Uso: permission:create <name> <description>');\n    return;\n  }\n  \n  const [name, description] = args;\n  \n  const permissionService = new PermissionService();\n  \n  const result = await permissionService.createPermission({ name, description });\n  \n  if (!result.success || !result) {\n    console.error('‚ùå Error creando permiso:', result.error);\n    return;\n  }\n  \n}\n\n/**\n * Listar todos los permisos\n */\nasync function listPermissions(): Promise<void> {\n  const db = getDatabase();\n  \n  const permissions = db.query(`\n    SELECT id, name, description, created_at\n    FROM permissions\n    ORDER BY name\n  `).all();\n  \n  if (permissions.length === 0) {\n    console.log('üì≠ No hay permisos registrados');\n    return;\n  }\n  \n  console.log('üîê Permisos registrados:');\n  permissions.forEach((permission: any) => {\n    console.log(`  üìù ${permission.name}`);\n    console.log(`    Descripci√≥n: ${permission.description}`);\n    console.log(`    Creado: ${new Date(permission.created_at).toLocaleString()}`);\n    console.log('');\n  });\n}\n\n/**\n * Generar un token JWT\n */\nasync function generateJWT(args: string[]): Promise<void> {\n  if (args.length < 1) {\n    console.log('Uso: jwt:generate <email>');\n    return;\n  }\n  \n  const email = args[0];\n  \n  const authService = new AuthService();\n  const user = await authService.findUserByEmail(email, { includeRoles: true });\n  \n  if (!user) {\n    console.error(`‚ùå Usuario no encontrado: ${email}`);\n    return;\n  }\n  \n  const jwtService = new JWTService(DEV_CONFIG.jwtSecret);\n  \n  const token = await jwtService.generateToken(user);\n  const refreshToken = await jwtService.generateRefreshToken(Number(user.id));\n  \n  const payload = {\n    userId: user.id,\n    email: user.email,\n    roles: user.roles?.map(r => r.name) || []\n  };\n  \n  console.log('üé´ Tokens generados:');\n  console.log(`Access Token: ${token}`);\n  console.log(`Refresh Token: ${refreshToken}`);\n  console.log(`\\nPayload: ${JSON.stringify(payload, null, 2)}`);\n}\n\n/**\n * Verificar un token JWT\n */\nasync function verifyJWT(token: string): Promise<void> {\n  if (!token) {\n    console.log('Uso: jwt:verify <token>');\n    return;\n  }\n  \n  const jwtService = new JWTService(DEV_CONFIG.jwtSecret);\n  \n  try {\n    const payload = jwtService.verifyToken(token);\n    console.log('‚úÖ Token v√°lido');\n    console.log(`Payload: ${JSON.stringify(payload, null, 2)}`);\n  } catch (error:any) {\n    console.error('‚ùå Token inv√°lido:', error);\n  }\n}\n\n/**\n * Probar el sistema de autenticaci√≥n\n */\nasync function testAuthentication(): Promise<void> {\n  console.log('üß™ Probando sistema de autenticaci√≥n...');\n  \n  const authService = new AuthService();\n  \n  // Probar registro\n  console.log('\\n1. Probando registro...');\n  const registerResult = await authService.register({\n    email: 'test@example.com',\n    password: 'Test123!',\n    firstName: 'Test',\n    lastName: 'User'\n  });\n  \n  if (registerResult.success) {\n    console.log('‚úÖ Registro exitoso');\n  } else {\n    console.log('‚ö†Ô∏è  Usuario ya existe o error en registro');\n  }\n  \n  // Probar login\n  console.log('\\n2. Probando login...');\n  const loginResult = await authService.login({\n    email: 'test@example.com',\n    password: 'Test123!'\n  });\n  \n  if (loginResult.success && loginResult.token) {\n    console.log('‚úÖ Login exitoso');\n    console.log(`Token: ${loginResult.token.substring(0, 50)}...`);\n  } else {\n    console.log('‚ùå Error en login:', loginResult.error);\n  }\n  \n  // Probar login con credenciales incorrectas\n  console.log('\\n3. Probando login con credenciales incorrectas...');\n  const badLoginResult = await authService.login({\n    email: 'test@example.com',\n    password: 'WrongPassword'\n  });\n  \n  if (!badLoginResult.success) {\n    console.log('‚úÖ Login rechazado correctamente');\n  } else {\n    console.log('‚ùå Error: login deber√≠a haber fallado');\n  }\n}\n\n/**\n * Probar el sistema de permisos\n */\nasync function testPermissions(): Promise<void> {\n  console.log('üß™ Probando sistema de permisos...');\n  \n  const permissionService = new PermissionService();\n  \n  // Crear permiso de prueba\n  console.log('\\n1. Creando permiso de prueba...');\n  const permResult = await permissionService.createPermission({\n    name: 'test.permission',\n    description: 'Permiso de prueba'\n  });\n  \n  if (permResult.success) {\n    console.log('‚úÖ Permiso creado');\n  } else {\n    console.log('‚ö†Ô∏è  Permiso ya existe');\n  }\n  \n  // Crear rol de prueba\n  console.log('\\n2. Creando rol de prueba...');\n  const roleResult = await permissionService.createRole({\n    name: 'test.role',\n    description: 'Rol de prueba'\n  });\n  \n  if (roleResult.success) {\n    console.log('‚úÖ Rol creado');\n  } else {\n    console.log('‚ö†Ô∏è  Rol ya existe');\n  }\n  \n  console.log('\\n‚úÖ Pruebas de permisos completadas');\n}\n\n/**\n * Mostrar ayuda\n */\nfunction showHelp(): void {\n  console.log('üõ†Ô∏è  CLI de Desarrollo - Auth Library');\n  console.log('\\nComandos disponibles:');\n  \n  Object.entries(COMMANDS).forEach(([command, description]) => {\n    console.log(`  ${command.padEnd(20)} - ${description}`);\n  });\n  \n  console.log('\\nEjemplos:');\n  console.log('  bun run src/scripts/dev.ts db:reset');\n  console.log('  bun run src/scripts/dev.ts user:create admin@test.com Admin123! Admin User admin');\n  console.log('  bun run src/scripts/dev.ts jwt:generate admin@test.com');\n}\n\n// Ejecutar comando si el script se ejecuta directamente\nif (import.meta.main) {\n  const command = process.argv[2] || 'help';\n  const args = process.argv.slice(3);\n  \n  await runDevCommand(command, ...args);\n  \n  // Cerrar conexi√≥n a la base de datos\n  closeDatabase();\n  \n}",
    "// src/index.ts\n// Punto de entrada principal de la librer√≠a de autenticaci√≥n\n\n// Servicios principales\nexport { AuthService, initAuthService, getAuthService } from './services/auth';\nexport { JWTService,initJWTService } from './services/jwt';\nexport { PermissionService,initPermissionService } from './services/permissions';\n\n// Importaciones para uso interno\nimport { AuthService } from './services/auth';\nimport { JWTService } from './services/jwt';\nimport { PermissionService } from './services/permissions';\nimport { \n  getAuthConfig, \n  validateAuthConfig\n} from './config/auth';\nimport { type AuthConfig } from './types/auth';\nimport {\n  authenticateWebSocket,\n  checkWebSocketPermissions,\n  checkWebSocketRoles,\n  getWebSocketCurrentUser,\n  isWebSocketAuthenticated,\n  getWebSocketAuthContext,\n  sendToUser,\n  sendToUsersWithPermissions,\n  sendToUsersWithRoles,\n  broadcastToAuthenticated,\n  getConnectionStats,\n  disconnectUser,\n  cleanupInactiveConnections,\n  handleAuthenticatedMessage,\n  createWebSocketResponse,\n  initializeConnectionCleanup\n} from './adapters/websocket';\nimport { \n  initDatabase, \n  closeDatabase \n} from './db/connection';\nimport { runMigrations } from './db/migrations';\nimport { \n  seedDatabase, \n  cleanDatabase, \n  resetDatabase, \n  checkDatabaseStatus \n} from './scripts/seed';\nimport {\n  honoAuthMiddleware,\n  honoOptionalAuth,\n  honoRequireAuth,\n  honoRequirePermissions,\n  honoRequireRoles,\n  honoRequireAdmin,\n  honoRequireModerator,\n  honoRequireOwnership,\n  honoRateLimit,\n  honoCorsAuth,\n  honoErrorResponse,\n  honoSuccessResponse,\n  honoAuthLogger\n} from './adapters/hono';\nimport {\n  expressAuthMiddleware,\n  expressOptionalAuth,\n  expressRequireAuth,\n  expressRequirePermissions,\n  expressRequireRoles,\n  expressRequireAdmin,\n  expressRequireModerator,\n  expressRequireOwnership,\n  expressRateLimit,\n  expressCorsAuth,\n  expressErrorResponse,\n  expressSuccessResponse,\n  expressAuthLogger,\n  expressAuthErrorHandler,\n  expressJsonValidator,\n  expressSanitizer\n} from './adapters/express';\n\n// Middleware agn√≥stico\nexport {\n  authenticateRequest,\n  authorizeRequest,\n  getCurrentUser,\n  createEmptyAuthContext,\n  logAuthEvent,\n  extractClientIP,\n  extractUserAgent,\n  type AuthMiddlewareConfig\n} from './middleware/auth';\n\n// Adaptadores para frameworks\nexport {\n  honoAuthMiddleware,\n  honoOptionalAuth,\n  honoRequireAuth,\n  honoRequirePermissions,\n  honoRequireRoles,\n  honoRequireAdmin,\n  honoRequireModerator,\n  getHonoCurrentUser,\n  isHonoAuthenticated,\n  getHonoAuthContext,\n  honoRequireOwnership,\n  honoRateLimit,\n  honoCorsAuth,\n  honoErrorResponse,\n  honoSuccessResponse,\n  honoAuthLogger\n} from './adapters/hono';\n\nexport {\n  expressAuthMiddleware,\n  expressOptionalAuth,\n  expressRequireAuth,\n  expressRequirePermissions,\n  expressRequireRoles,\n  expressRequireAdmin,\n  expressRequireModerator,\n  getExpressCurrentUser,\n  isExpressAuthenticated,\n  getExpressAuthContext,\n  expressRequireOwnership,\n  expressRateLimit,\n  expressCorsAuth,\n  expressErrorResponse,\n  expressSuccessResponse,\n  expressAuthLogger,\n  expressAuthErrorHandler,\n  expressJsonValidator,\n  expressSanitizer\n} from './adapters/express';\n\nexport {\n  authenticateWebSocket,\n  checkWebSocketPermissions,\n  checkWebSocketRoles,\n  getWebSocketCurrentUser,\n  isWebSocketAuthenticated,\n  getWebSocketAuthContext,\n  sendToUser,\n  sendToUsersWithPermissions,\n  sendToUsersWithRoles,\n  broadcastToAuthenticated,\n  getConnectionStats,\n  disconnectUser,\n  cleanupInactiveConnections,\n  handleAuthenticatedMessage,\n  createWebSocketResponse,\n  initializeConnectionCleanup,\n  type AuthenticatedWebSocket,\n  type WebSocketAuthConfig\n} from './adapters/websocket';\n\n// Base de datos\nexport {\n  getDatabase,\n  initDatabase,\n  closeDatabase,\n  testConnection,\n  getDatabaseInfo\n} from './db/connection';\n\nexport {\n  runMigrations,\n  rollbackMigrations,\n  getMigrationStatus,\n  resetDatabase as resetDatabaseMigrations\n} from './db/migrations';\n\n// Configuraci√≥n\nexport {\n  DEFAULT_AUTH_CONFIG,\n  SECURITY_CONFIG,\n  DEV_CONFIG,\n  PROD_CONFIG,\n  getAuthConfig,\n  validateAuthConfig,\n  getRequiredEnvVars,\n  generateEnvExample,\n  printConfig\n} from './config/auth';\n\n// Scripts de utilidad\nexport * from './scripts/seed';\n\nexport {\n  runDevCommand\n} from './scripts/dev';\n\n// Tipos TypeScript\nexport type {\n  User,\n  Role,\n  Permission,\n  AuthContext,\n  AuthConfig,\n  AuthRequest,\n  AuthResponse,\n  RegisterData,\n  LoginData,\n  AuthResult,\n  JWTPayload,\n  PermissionOptions,\n  CreatePermissionData,\n  CreateRoleData,\n  AssignRoleData,\n  AdapterConfig,\n  DatabaseResult,\n  UserQueryOptions,\n  AuthStats,\n  AuthEvent,\n  AuthEventData,\n  SecurityConfig,\n  SessionInfo,\n  AuthErrorType,\n  AuthError\n} from './types/auth';\n\n// Clase principal de la librer√≠a\nexport class AuthLibrary {\n  private authService: AuthService;\n  private jwtService: JWTService;\n  private permissionService: PermissionService;\n  private config: AuthConfig;\n\n  constructor(config?: Partial<AuthConfig>) {\n    this.config = getAuthConfig();\n    \n    // Mergear configuraci√≥n personalizada\n    if (config) {\n      this.config = { ...this.config, ...config };\n    }\n\n    // Validar configuraci√≥n\n    const validation = validateAuthConfig(this.config);\n    if (!validation.valid) {\n      throw new Error(`Configuraci√≥n inv√°lida: ${validation.errors.join(', ')}`);\n    }\n\n    // Inicializar servicios\n    this.jwtService = new JWTService(this.config.jwtSecret);\n    this.authService = new AuthService();\n    this.permissionService = new PermissionService();\n  }\n\n  /**\n   * Inicializar la librer√≠a\n   */\n  async initialize(): Promise<void> {\n    try {\n      initDatabase();\n      await runMigrations();\n      console.log('‚úÖ Auth Library inicializada correctamente');\n    } catch (error:any) {\n      console.error('‚ùå Error inicializando Auth Library:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Obtener el servicio de autenticaci√≥n\n   */\n  getAuthService(): AuthService {\n    return this.authService;\n  }\n\n  /**\n   * Obtener el servicio JWT\n   */\n  getJWTService(): JWTService {\n    return this.jwtService;\n  }\n\n  /**\n   * Obtener el servicio de permisos\n   */\n  getPermissionService(): PermissionService {\n    return this.permissionService;\n  }\n\n  /**\n   * Obtener la configuraci√≥n actual\n   */\n  getConfig(): AuthConfig {\n    return { ...this.config };\n  }\n\n  /**\n   * Actualizar configuraci√≥n\n   */\n  updateConfig(newConfig: Partial<AuthConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    \n    const validation = validateAuthConfig(this.config);\n    if (!validation.valid) {\n      throw new Error(`Configuraci√≥n inv√°lida: ${validation.errors.join(', ')}`);\n    }\n\n    // Reinicializar servicios si es necesario\n    if (newConfig.jwtSecret) {\n      this.jwtService = new JWTService(this.config.jwtSecret);\n    }\n  }\n\n  /**\n   * Poblar base de datos con datos iniciales\n   */\n  async seed(): Promise<void> {\n    await seedDatabase();\n  }\n\n  /**\n   * Limpiar base de datos\n   */\n  async clean(): Promise<void> {\n    await cleanDatabase();\n  }\n\n  /**\n   * Resetear base de datos\n   */\n  async reset(): Promise<void> {\n    await resetDatabase();\n  }\n\n  /**\n   * Verificar estado de la base de datos\n   */\n  async checkStatus(): Promise<void> {\n    await checkDatabaseStatus();\n  }\n\n  /**\n   * Cerrar conexiones y limpiar recursos\n   */\n  async close(): Promise<void> {\n    closeDatabase();\n    console.log('‚úÖ Auth Library cerrada correctamente');\n  }\n}\n\n// Instancia por defecto\nlet defaultInstance: AuthLibrary | null = null;\n\n/**\n * Obtener instancia por defecto de la librer√≠a\n */\nexport function getAuthLibrary(config?: Partial<AuthConfig>): AuthLibrary {\n  if (!defaultInstance) {\n    defaultInstance = new AuthLibrary(config);\n  }\n  return defaultInstance;\n}\n\n/**\n * Inicializar la librer√≠a con configuraci√≥n por defecto\n */\nexport async function initializeAuth(config?: Partial<AuthConfig>): Promise<AuthLibrary> {\n  const library = getAuthLibrary(config);\n  await library.initialize();\n  return library;\n}\n\n/**\n * Funci√≥n de conveniencia para crear middleware de Hono\n */\nexport function createHonoAuth(config?: Partial<AuthConfig>) {\n  const library = getAuthLibrary(config);\n  return {\n    middleware: honoAuthMiddleware,\n    optional: honoOptionalAuth,\n    required: honoRequireAuth,\n    permissions: honoRequirePermissions,\n    roles: honoRequireRoles,\n    admin: honoRequireAdmin,\n    moderator: honoRequireModerator,\n    ownership: honoRequireOwnership,\n    rateLimit: honoRateLimit,\n    cors: honoCorsAuth,\n    logger: honoAuthLogger,\n    library\n  };\n}\n\n/**\n * Funci√≥n de conveniencia para crear middleware de Express\n */\nexport function createExpressAuth(config?: Partial<AuthConfig>) {\n  const library = getAuthLibrary(config);\n  return {\n    middleware: expressAuthMiddleware,\n    optional: expressOptionalAuth,\n    required: expressRequireAuth,\n    permissions: expressRequirePermissions,\n    roles: expressRequireRoles,\n    admin: expressRequireAdmin,\n    moderator: expressRequireModerator,\n    ownership: expressRequireOwnership,\n    rateLimit: expressRateLimit,\n    cors: expressCorsAuth,\n    logger: expressAuthLogger,\n    errorHandler: expressAuthErrorHandler,\n    jsonValidator: expressJsonValidator,\n    sanitizer: expressSanitizer,\n    library\n  };\n}\n\n/**\n * Funci√≥n de conveniencia para WebSocket\n */\nexport function createWebSocketAuth(config?: Partial<AuthConfig>) {\n  const library = getAuthLibrary(config);\n  return {\n    authenticate: authenticateWebSocket,\n    checkPermissions: checkWebSocketPermissions,\n    checkRoles: checkWebSocketRoles,\n    getCurrentUser: getWebSocketCurrentUser,\n    isAuthenticated: isWebSocketAuthenticated,\n    getAuthContext: getWebSocketAuthContext,\n    sendToUser,\n    sendToUsersWithPermissions,\n    sendToUsersWithRoles,\n    broadcast: broadcastToAuthenticated,\n    getStats: getConnectionStats,\n    disconnect: disconnectUser,\n    cleanup: cleanupInactiveConnections,\n    handleMessage: handleAuthenticatedMessage,\n    createResponse: createWebSocketResponse,\n    initCleanup: initializeConnectionCleanup,\n    library\n  };\n}\n\n// Exportar por defecto la clase principal\nexport default AuthLibrary;\n\n/**\n * Informaci√≥n de la librer√≠a\n */\nexport const AUTH_LIBRARY_INFO = {\n  name: 'Framework-Agnostic Auth Library',\n  version: '1.0.0',\n  description: 'Librer√≠a de autenticaci√≥n y permisos agn√≥stica de framework con TypeScript, Bun y SQLite',\n  author: 'Auth Library Team',\n  frameworks: ['Hono', 'Express', 'WebSockets', 'Socket.IO', 'Fastify'],\n  features: [\n    'Framework-agnostic',\n    'TypeScript nativo',\n    'SQLite con Bun',\n    'JWT + Bun.password',\n    'RBAC (Role-Based Access Control)',\n    'Middlewares reutilizables',\n    'Migraciones autom√°ticas',\n    'Scripts de utilidad',\n    'Configuraci√≥n flexible',\n    'Logging integrado',\n    'Rate limiting',\n    'CORS configurado',\n    'Validaci√≥n de entrada',\n    'Sanitizaci√≥n de datos'\n  ]\n};\n\nconsole.log(`üìö ${AUTH_LIBRARY_INFO.name} v${AUTH_LIBRARY_INFO.version} cargada`);\n"
  ],
  "mappings": "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",
  "debugId": "B794F85F18E8CD9E64756E2164756E21",
  "names": []
}